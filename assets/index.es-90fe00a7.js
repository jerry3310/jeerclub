import{i as Y1,e as Z1,f as X1,h as ev,j as tv,k as rv,m as iv,o as nv,p as sv,q as av,s as Ca,r as Ra,t as $a,u as ov,v as ns,w as ne,x as Qr,y as cv,z as xf,A as Fa,B as Pf,H as uv,C as Da,D as Of,E as Nf,F as Ua,G as hv,I as da,J as lv,K as Qc,L as fv,_ as dv}from"./index-d7870e89.js";import{s as ss,a as ja,d as pv,i as ll,c as gv,b as mv,f as Jc,p as yv,J as li,e as Yc,g as Zc,h as Xc,j as Si,k as hi,l as es,m as vv,n as wv,H as Oi}from"./http-e43609f9.js";function eu(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function Af(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?eu(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Dc(s,t){t||(t=s.reduce((o,l)=>o+l.length,0));const r=Af(t);let n=0;for(const o of s)r.set(o,n),n+=o.length;return eu(r)}const fl={...Y1,...Z1,...X1,...ev,...tv,...rv,...iv,...nv,...sv,...av};function Tf(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const dl=Tf("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),pc=Tf("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=Af(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Cf={utf8:dl,"utf-8":dl,hex:fl.base16,latin1:pc,ascii:pc,binary:pc,...fl};function nr(s,t="utf8"){const r=Cf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?eu(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function Jt(s,t="utf8"){const r=Cf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}const bv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var _v={},Ev=s=>encodeURIComponent(s).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`);(function(s){const t=Ev,r=$a,n=Ca,o=Ra,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function D(u){return Array.isArray(u)?u.sort():typeof u=="object"?D(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function q(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=D(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=q(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(_v);function Iv(s,t=[]){const r=[];return Object.keys(s).forEach(n=>{if(t.length&&!t.includes(n))return;const o=s[n];r.push(...o.accounts)}),r}const Sv={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function xv(s,t){const{message:r,code:n}=Sv[s];return{message:t?`${r} ${t}`:r,code:n}}function Uc(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}const Pv=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ov=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Nv=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Av(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Tv(s);return}return t}function Tv(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function pa(s,t={}){if(typeof s!="string")return s;const r=s.trim();if(s[0]==='"'&&s.at(-1)==='"'&&!s.includes("\\"))return r.slice(1,-1);if(r.length<=9){const n=r.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!Nv.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(Pv.test(s)||Ov.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Av)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Cv(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Mt(s,...t){try{return Cv(s(...t))}catch(r){return Promise.reject(r)}}function Rv(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function $v(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function ba(s){if(Rv(s))return String(s);if($v(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return ba(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Rf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const jc="base64:";function Fv(s){if(typeof s=="string")return s;Rf();const t=Buffer.from(s).toString("base64");return jc+t}function Dv(s){return typeof s!="string"||!s.startsWith(jc)?s:(Rf(),Buffer.from(s.slice(jc.length),"base64"))}function dr(s){return s?s.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Uv(...s){return dr(s.join(":"))}function ga(s){return s=dr(s),s?s+":":""}const jv="memory",Lv=()=>{const s=new Map;return{name:jv,options:{},hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return Array.from(s.keys())},clear(){s.clear()},dispose(){s.clear()}}};function qv(s={}){const t={mounts:{"":s.driver||Lv()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=_=>{for(const E of t.mountpoints)if(_.startsWith(E))return{base:E,relativeKey:_.slice(E.length),driver:t.mounts[E]};return{base:"",relativeKey:_,driver:t.mounts[""]}},n=(_,E)=>t.mountpoints.filter(O=>O.startsWith(_)||E&&_.startsWith(O)).map(O=>({relativeBase:_.length>O.length?_.slice(O.length):void 0,mountpoint:O,driver:t.mounts[O]})),o=(_,E)=>{if(t.watching){E=dr(E);for(const O of t.watchListeners)O(_,E)}},l=async()=>{if(!t.watching){t.watching=!0;for(const _ in t.mounts)t.unwatch[_]=await pl(t.mounts[_],o,_)}},y=async()=>{if(t.watching){for(const _ in t.unwatch)await t.unwatch[_]();t.unwatch={},t.watching=!1}},b=(_,E,O)=>{const D=new Map,H=q=>{let W=D.get(q.base);return W||(W={driver:q.driver,base:q.base,items:[]},D.set(q.base,W)),W};for(const q of _){const W=typeof q=="string",ie=dr(W?q:q.key),ce=W?void 0:q.value,u=W||!q.options?E:{...E,...q.options},d=r(ie);H(d).items.push({key:ie,value:ce,relativeKey:d.relativeKey,options:u})}return Promise.all([...D.values()].map(q=>O(q))).then(q=>q.flat())},P={hasItem(_,E={}){_=dr(_);const{relativeKey:O,driver:D}=r(_);return Mt(D.hasItem,O,E)},getItem(_,E={}){_=dr(_);const{relativeKey:O,driver:D}=r(_);return Mt(D.getItem,O,E).then(H=>pa(H))},getItems(_,E){return b(_,E,O=>O.driver.getItems?Mt(O.driver.getItems,O.items.map(D=>({key:D.relativeKey,options:D.options})),E).then(D=>D.map(H=>({key:Uv(O.base,H.key),value:pa(H.value)}))):Promise.all(O.items.map(D=>Mt(O.driver.getItem,D.relativeKey,D.options).then(H=>({key:D.key,value:pa(H)})))))},getItemRaw(_,E={}){_=dr(_);const{relativeKey:O,driver:D}=r(_);return D.getItemRaw?Mt(D.getItemRaw,O,E):Mt(D.getItem,O,E).then(H=>Dv(H))},async setItem(_,E,O={}){if(E===void 0)return P.removeItem(_);_=dr(_);const{relativeKey:D,driver:H}=r(_);H.setItem&&(await Mt(H.setItem,D,ba(E),O),H.watch||o("update",_))},async setItems(_,E){await b(_,E,async O=>{O.driver.setItems&&await Mt(O.driver.setItems,O.items.map(D=>({key:D.relativeKey,value:ba(D.value),options:D.options})),E),O.driver.setItem&&await Promise.all(O.items.map(D=>Mt(O.driver.setItem,D.relativeKey,ba(D.value),D.options)))})},async setItemRaw(_,E,O={}){if(E===void 0)return P.removeItem(_,O);_=dr(_);const{relativeKey:D,driver:H}=r(_);if(H.setItemRaw)await Mt(H.setItemRaw,D,E,O);else if(H.setItem)await Mt(H.setItem,D,Fv(E),O);else return;H.watch||o("update",_)},async removeItem(_,E={}){typeof E=="boolean"&&(E={removeMeta:E}),_=dr(_);const{relativeKey:O,driver:D}=r(_);D.removeItem&&(await Mt(D.removeItem,O,E),(E.removeMeta||E.removeMata)&&await Mt(D.removeItem,O+"$",E),D.watch||o("remove",_))},async getMeta(_,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),_=dr(_);const{relativeKey:O,driver:D}=r(_),H=Object.create(null);if(D.getMeta&&Object.assign(H,await Mt(D.getMeta,O,E)),!E.nativeOnly){const q=await Mt(D.getItem,O+"$",E).then(W=>pa(W));q&&typeof q=="object"&&(typeof q.atime=="string"&&(q.atime=new Date(q.atime)),typeof q.mtime=="string"&&(q.mtime=new Date(q.mtime)),Object.assign(H,q))}return H},setMeta(_,E,O={}){return this.setItem(_+"$",E,O)},removeMeta(_,E={}){return this.removeItem(_+"$",E)},async getKeys(_,E={}){_=ga(_);const O=n(_,!0);let D=[];const H=[];for(const q of O){const ie=(await Mt(q.driver.getKeys,q.relativeBase,E)).map(ce=>q.mountpoint+dr(ce)).filter(ce=>!D.some(u=>ce.startsWith(u)));H.push(...ie),D=[q.mountpoint,...D.filter(ce=>!ce.startsWith(q.mountpoint))]}return _?H.filter(q=>q.startsWith(_)&&!q.endsWith("$")):H.filter(q=>!q.endsWith("$"))},async clear(_,E={}){_=ga(_),await Promise.all(n(_,!1).map(async O=>{if(O.driver.clear)return Mt(O.driver.clear,O.relativeBase,E);if(O.driver.removeItem){const D=await O.driver.getKeys(O.relativeBase||"",E);return Promise.all(D.map(H=>O.driver.removeItem(H,E)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(_=>gl(_)))},async watch(_){return await l(),t.watchListeners.push(_),async()=>{t.watchListeners=t.watchListeners.filter(E=>E!==_),t.watchListeners.length===0&&await y()}},async unwatch(){t.watchListeners=[],await y()},mount(_,E){if(_=ga(_),_&&t.mounts[_])throw new Error(`already mounted at ${_}`);return _&&(t.mountpoints.push(_),t.mountpoints.sort((O,D)=>D.length-O.length)),t.mounts[_]=E,t.watching&&Promise.resolve(pl(E,o,_)).then(O=>{t.unwatch[_]=O}).catch(console.error),P},async unmount(_,E=!0){_=ga(_),!(!_||!t.mounts[_])&&(t.watching&&_ in t.unwatch&&(t.unwatch[_](),delete t.unwatch[_]),E&&await gl(t.mounts[_]),t.mountpoints=t.mountpoints.filter(O=>O!==_),delete t.mounts[_])},getMount(_=""){_=dr(_)+":";const E=r(_);return{driver:E.driver,base:E.base}},getMounts(_="",E={}){return _=dr(_),n(_,E.parents).map(D=>({driver:D.driver,base:D.mountpoint}))}};return P}function pl(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function gl(s){typeof s.dispose=="function"&&await Mt(s.dispose)}function Bi(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function $f(s,t){const r=indexedDB.open(s);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Bi(r);return(o,l)=>n.then(y=>l(y.transaction(t,o).objectStore(t)))}let gc;function as(){return gc||(gc=$f("keyval-store","keyval")),gc}function ml(s,t=as()){return t("readonly",r=>Bi(r.get(s)))}function Mv(s,t,r=as()){return r("readwrite",n=>(n.put(t,s),Bi(n.transaction)))}function zv(s,t=as()){return t("readwrite",r=>(r.delete(s),Bi(r.transaction)))}function Hv(s=as()){return s("readwrite",t=>(t.clear(),Bi(t.transaction)))}function kv(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Bi(s.transaction)}function Kv(s=as()){return s("readonly",t=>{if(t.getAllKeys)return Bi(t.getAllKeys());const r=[];return kv(t,n=>r.push(n.key)).then(()=>r)})}const Vv="idb-keyval";var Bv=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=$f(s.dbName,s.storeName)),{name:Vv,options:s,async hasItem(o){return!(typeof await ml(r(o),n)>"u")},async getItem(o){return await ml(r(o),n)??null},setItem(o,l){return Mv(r(o),l,n)},removeItem(o){return zv(r(o),n)},getKeys(){return Kv(n)},clear(){return Hv(n)}}};const Gv="WALLET_CONNECT_V2_INDEXED_DB",Wv="keyvaluestorage";let Qv=class{constructor(){this.indexedDb=qv({driver:Bv({dbName:Gv,storeName:Wv})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,ss(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var mc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_a={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mc<"u"&&mc.localStorage?_a.exports=mc.localStorage:typeof window<"u"&&window.localStorage?_a.exports=window.localStorage:_a.exports=new t})();function Jv(s){var t;return[s[0],ja((t=s[1])!=null?t:"")]}let Yv=class{constructor(){this.localStorage=_a.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Jv)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return ja(r)}async setItem(t,r){this.localStorage.setItem(t,ss(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Zv="wc_storage_version",yl=1,Xv=async(s,t,r)=>{const n=Zv,o=await t.getItem(n);if(o&&o>=yl){r(t);return}const l=await s.getKeys();if(!l.length){r(t);return}const y=[];for(;l.length;){const b=l.shift();if(!b)continue;const P=b.toLowerCase();if(P.includes("wc@")||P.includes("walletconnect")||P.includes("wc_")||P.includes("wallet_connect")){const _=await s.getItem(b);await t.setItem(b,_),y.push(b)}}await t.setItem(n,yl),r(t),ew(s,y)},ew=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let tw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Yv;this.storage=t;try{const r=new Qv;Xv(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var wn={},Hn={},yc={},kn={};class Gi{}const rw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gi},Symbol.toStringTag,{value:"Module"})),iw=ov(rw);var vl;function nw(){if(vl)return kn;vl=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.IHeartBeat=void 0;const s=iw;class t extends s.IEvents{constructor(n){super()}}return kn.IHeartBeat=t,kn}var wl;function Ff(){return wl||(wl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),ns.__exportStar(nw(),s)}(yc)),yc}var vc={},Hi={},bl;function sw(){if(bl)return Hi;bl=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.HEARTBEAT_EVENTS=Hi.HEARTBEAT_INTERVAL=void 0;const s=ne;return Hi.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Hi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Hi}var _l;function Df(){return _l||(_l=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),ns.__exportStar(sw(),s)}(vc)),vc}var El;function aw(){if(El)return Hn;El=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.HeartBeat=void 0;const s=ns,t=Qr,r=ne,n=Ff(),o=Df();class l extends n.IHeartBeat{constructor(b){super(b),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(b==null?void 0:b.interval)||o.HEARTBEAT_INTERVAL}static init(b){return s.__awaiter(this,void 0,void 0,function*(){const P=new l(b);return yield P.init(),P})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(b,P){this.events.on(b,P)}once(b,P){this.events.once(b,P)}off(b,P){this.events.off(b,P)}removeListener(b,P){this.events.removeListener(b,P)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Hn.HeartBeat=l,Hn}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=ns;t.__exportStar(aw(),s),t.__exportStar(Ff(),s),t.__exportStar(Df(),s)})(wn);var Ne={},wc,Il;function ow(){if(Il)return wc;Il=1;function s(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}wc=t;function t(r,n,o){var l=o&&o.stringify||s,y=1;if(typeof r=="object"&&r!==null){var b=n.length+y;if(b===1)return r;var P=new Array(b);P[0]=l(r);for(var _=1;_<b;_++)P[_]=l(n[_]);return P.join(" ")}if(typeof r!="string")return r;var E=n.length;if(E===0)return r;for(var O="",D=1-y,H=-1,q=r&&r.length||0,W=0;W<q;){if(r.charCodeAt(W)===37&&W+1<q){switch(H=H>-1?H:0,r.charCodeAt(W+1)){case 100:case 102:if(D>=E||n[D]==null)break;H<W&&(O+=r.slice(H,W)),O+=Number(n[D]),H=W+2,W++;break;case 105:if(D>=E||n[D]==null)break;H<W&&(O+=r.slice(H,W)),O+=Math.floor(Number(n[D])),H=W+2,W++;break;case 79:case 111:case 106:if(D>=E||n[D]===void 0)break;H<W&&(O+=r.slice(H,W));var ie=typeof n[D];if(ie==="string"){O+="'"+n[D]+"'",H=W+2,W++;break}if(ie==="function"){O+=n[D].name||"<anonymous>",H=W+2,W++;break}O+=l(n[D]),H=W+2,W++;break;case 115:if(D>=E)break;H<W&&(O+=r.slice(H,W)),O+=String(n[D]),H=W+2,W++;break;case 37:H<W&&(O+=r.slice(H,W)),O+="%",H=W+2,W++,D--;break}++D}++W}return H===-1?r:(H<q&&(O+=r.slice(H)),O)}return wc}var bc,Sl;function cw(){if(Sl)return bc;Sl=1;const s=ow();bc=o;const t=g().console||{},r={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:W,wrapResponseSerializer:W,wrapErrorSerializer:W,req:q,res:q,err:D};function n(p,N){return Array.isArray(p)?p.filter(function(Q){return Q!=="!stdSerializers.err"}):p===!0?Object.keys(N):!1}function o(p){p=p||{},p.browser=p.browser||{};const N=p.browser.transmit;if(N&&typeof N.send!="function")throw Error("pino: transmit option must have a send function");const x=p.browser.write||t;p.browser.write&&(p.browser.asObject=!0);const Q=p.serializers||{},se=n(p.browser.serialize,Q);let Ee=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof x=="function"&&(x.error=x.fatal=x.warn=x.info=x.debug=x.trace=x),p.enabled===!1&&(p.level="silent");const tt=p.level||"info",j=Object.create(x);j.log||(j.log=ie),Object.defineProperty(j,"levelVal",{get:qe}),Object.defineProperty(j,"level",{get:Te,set:ee});const V={transmit:N,serialize:se,asObject:p.browser.asObject,levels:Ae,timestamp:H(p)};j.levels=o.levels,j.level=tt,j.setMaxListeners=j.getMaxListeners=j.emit=j.addListener=j.on=j.prependListener=j.once=j.prependOnceListener=j.removeListener=j.removeAllListeners=j.listeners=j.listenerCount=j.eventNames=j.write=j.flush=ie,j.serializers=Q,j._serialize=se,j._stdErrSerialize=Ee,j.child=Y,N&&(j._logEvent=O());function qe(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function ee(J){if(J!=="silent"&&!this.levels.values[J])throw Error("unknown level "+J);this._level=J,l(V,j,"error","log"),l(V,j,"fatal","error"),l(V,j,"warn","error"),l(V,j,"info","log"),l(V,j,"debug","log"),l(V,j,"trace","log")}function Y(J,Z){if(!J)throw new Error("missing bindings for child Pino");Z=Z||{},se&&J.serializers&&(Z.serializers=J.serializers);const ht=Z.serializers;if(se&&ht){var ke=Object.assign({},Q,ht),zr=p.browser.serialize===!0?Object.keys(ke):se;delete J.serializers,P([J],zr,ke,this._stdErrSerialize)}function be(St){this._childLevel=(St._childLevel|0)+1,this.error=_(St,J,"error"),this.fatal=_(St,J,"fatal"),this.warn=_(St,J,"warn"),this.info=_(St,J,"info"),this.debug=_(St,J,"debug"),this.trace=_(St,J,"trace"),ke&&(this.serializers=ke,this._serialize=zr),N&&(this._logEvent=O([].concat(St._logEvent.bindings,J)))}return be.prototype=this,new be(this)}return j}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=r,o.stdTimeFunctions=Object.assign({},{nullTime:ce,epochTime:u,unixTime:d,isoTime:m});function l(p,N,x,Q){const se=Object.getPrototypeOf(N);N[x]=N.levelVal>N.levels.values[x]?ie:se[x]?se[x]:t[x]||t[Q]||ie,y(p,N,x)}function y(p,N,x){!p.transmit&&N[x]===ie||(N[x]=function(Q){return function(){const Ee=p.timestamp(),Ae=new Array(arguments.length),tt=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var j=0;j<Ae.length;j++)Ae[j]=arguments[j];if(p.serialize&&!p.asObject&&P(Ae,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?Q.call(tt,b(this,x,Ae,Ee)):Q.apply(tt,Ae),p.transmit){const V=p.transmit.level||N.level,qe=o.levels.values[V],Te=o.levels.values[x];if(Te<qe)return;E(this,{ts:Ee,methodLevel:x,methodValue:Te,transmitLevel:V,transmitValue:o.levels.values[p.transmit.level||N.level],send:p.transmit.send,val:N.levelVal},Ae)}}}(N[x]))}function b(p,N,x,Q){p._serialize&&P(x,p._serialize,p.serializers,p._stdErrSerialize);const se=x.slice();let Ee=se[0];const Ae={};Q&&(Ae.time=Q),Ae.level=o.levels.values[N];let tt=(p._childLevel|0)+1;if(tt<1&&(tt=1),Ee!==null&&typeof Ee=="object"){for(;tt--&&typeof se[0]=="object";)Object.assign(Ae,se.shift());Ee=se.length?s(se.shift(),se):void 0}else typeof Ee=="string"&&(Ee=s(se.shift(),se));return Ee!==void 0&&(Ae.msg=Ee),Ae}function P(p,N,x,Q){for(const se in p)if(Q&&p[se]instanceof Error)p[se]=o.stdSerializers.err(p[se]);else if(typeof p[se]=="object"&&!Array.isArray(p[se]))for(const Ee in p[se])N&&N.indexOf(Ee)>-1&&Ee in x&&(p[se][Ee]=x[Ee](p[se][Ee]))}function _(p,N,x){return function(){const Q=new Array(1+arguments.length);Q[0]=N;for(var se=1;se<Q.length;se++)Q[se]=arguments[se-1];return p[x].apply(this,Q)}}function E(p,N,x){const Q=N.send,se=N.ts,Ee=N.methodLevel,Ae=N.methodValue,tt=N.val,j=p._logEvent.bindings;P(x,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=se,p._logEvent.messages=x.filter(function(V){return j.indexOf(V)===-1}),p._logEvent.level.label=Ee,p._logEvent.level.value=Ae,Q(Ee,p._logEvent,tt),p._logEvent=O(j)}function O(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function D(p){const N={type:p.constructor.name,msg:p.message,stack:p.stack};for(const x in p)N[x]===void 0&&(N[x]=p[x]);return N}function H(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?ce:u}function q(){return{}}function W(p){return p}function ie(){}function ce(){return!1}function u(){return Date.now()}function d(){return Math.round(Date.now()/1e3)}function m(){return new Date(Date.now()).toISOString()}function g(){function p(N){return typeof N<"u"&&N}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return bc}var ki={},xl;function Uf(){return xl||(xl=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.PINO_CUSTOM_CONTEXT_KEY=ki.PINO_LOGGER_DEFAULTS=void 0,ki.PINO_LOGGER_DEFAULTS={level:"info"},ki.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ki}var ir={},Pl;function uw(){if(Pl)return ir;Pl=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.generateChildLogger=ir.formatChildLoggerContext=ir.getLoggerContext=ir.setBrowserLoggerContext=ir.getBrowserLoggerContext=ir.getDefaultLoggerOptions=void 0;const s=Uf();function t(b){return Object.assign(Object.assign({},b),{level:(b==null?void 0:b.level)||s.PINO_LOGGER_DEFAULTS.level})}ir.getDefaultLoggerOptions=t;function r(b,P=s.PINO_CUSTOM_CONTEXT_KEY){return b[P]||""}ir.getBrowserLoggerContext=r;function n(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){return b[_]=P,b}ir.setBrowserLoggerContext=n;function o(b,P=s.PINO_CUSTOM_CONTEXT_KEY){let _="";return typeof b.bindings>"u"?_=r(b,P):_=b.bindings().context||"",_}ir.getLoggerContext=o;function l(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){const E=o(b,_);return E.trim()?`${E}/${P}`:P}ir.formatChildLoggerContext=l;function y(b,P,_=s.PINO_CUSTOM_CONTEXT_KEY){const E=l(b,P,_),O=b.child({context:E});return n(O,E,_)}return ir.generateChildLogger=y,ir}(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.pino=void 0;const t=ns,r=t.__importDefault(cw());Object.defineProperty(s,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Uf(),s),t.__exportStar(uw(),s)})(Ne);class hw extends Gi{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let lw=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},fw=class{constructor(t,r){this.logger=t,this.core=r}},dw=class extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}},pw=class extends Gi{constructor(t){super()}},gw=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}};class mw extends Gi{constructor(t,r){super(),this.relayer=t,this.logger=r}}let yw=class extends Gi{constructor(t,r){super(),this.core=t,this.logger=r}},vw=class{constructor(t,r){this.projectId=t,this.logger=r}},ww=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},bw=class{constructor(t){this.client=t}};var tu={},jf={};(function(s){Object.defineProperty(s,"__esModule",{value:!0});var t=cv,r=xf;s.DIGEST_LENGTH=64,s.BLOCK_SIZE=128;var n=function(){function b(){this.digestLength=s.DIGEST_LENGTH,this.blockSize=s.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return b.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},b.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},b.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},b.prototype.update=function(P,_){if(_===void 0&&(_=P.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var E=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<s.BLOCK_SIZE&&_>0;)this._buffer[this._bufferLength++]=P[E++],_--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(E=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,P,E,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=P[E++],_--;return this},b.prototype.finish=function(P){if(!this._finished){var _=this._bytesHashed,E=this._bufferLength,O=_/536870912|0,D=_<<3,H=_%128<112?128:256;this._buffer[E]=128;for(var q=E+1;q<H-8;q++)this._buffer[q]=0;t.writeUint32BE(O,this._buffer,H-8),t.writeUint32BE(D,this._buffer,H-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,H),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)t.writeUint32BE(this._stateHi[q],P,q*8),t.writeUint32BE(this._stateLo[q],P,q*8+4);return this},b.prototype.digest=function(){var P=new Uint8Array(this.digestLength);return this.finish(P),P},b.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},b.prototype.restoreState=function(P){return this._stateHi.set(P.stateHi),this._stateLo.set(P.stateLo),this._bufferLength=P.bufferLength,P.buffer&&this._buffer.set(P.buffer),this._bytesHashed=P.bytesHashed,this._finished=!1,this},b.prototype.cleanSavedState=function(P){r.wipe(P.stateHi),r.wipe(P.stateLo),P.buffer&&r.wipe(P.buffer),P.bufferLength=0,P.bytesHashed=0},b}();s.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(b,P,_,E,O,D,H){for(var q=_[0],W=_[1],ie=_[2],ce=_[3],u=_[4],d=_[5],m=_[6],g=_[7],p=E[0],N=E[1],x=E[2],Q=E[3],se=E[4],Ee=E[5],Ae=E[6],tt=E[7],j,V,qe,Te,ee,Y,J,Z;H>=128;){for(var ht=0;ht<16;ht++){var ke=8*ht+D;b[ht]=t.readUint32BE(O,ke),P[ht]=t.readUint32BE(O,ke+4)}for(var ht=0;ht<80;ht++){var zr=q,be=W,St=ie,M=ce,L=u,F=d,h=m,T=g,ae=p,de=N,ve=x,Ce=Q,$e=se,Se=Ee,xt=Ae,wt=tt;if(j=g,V=tt,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=(u>>>14|se<<32-14)^(u>>>18|se<<32-18)^(se>>>41-32|u<<32-(41-32)),V=(se>>>14|u<<32-14)^(se>>>18|u<<32-18)^(u>>>41-32|se<<32-(41-32)),ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,j=u&d^~u&m,V=se&Ee^~se&Ae,ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,j=o[ht*2],V=o[ht*2+1],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,j=b[ht%16],V=P[ht%16],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,qe=J&65535|Z<<16,Te=ee&65535|Y<<16,j=qe,V=Te,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=(q>>>28|p<<32-28)^(p>>>34-32|q<<32-(34-32))^(p>>>39-32|q<<32-(39-32)),V=(p>>>28|q<<32-28)^(q>>>34-32|p<<32-(34-32))^(q>>>39-32|p<<32-(39-32)),ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,j=q&W^q&ie^W&ie,V=p&N^p&x^N&x,ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,T=J&65535|Z<<16,wt=ee&65535|Y<<16,j=M,V=Ce,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=qe,V=Te,ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,M=J&65535|Z<<16,Ce=ee&65535|Y<<16,W=zr,ie=be,ce=St,u=M,d=L,m=F,g=h,q=T,N=ae,x=de,Q=ve,se=Ce,Ee=$e,Ae=Se,tt=xt,p=wt,ht%16===15)for(var ke=0;ke<16;ke++)j=b[ke],V=P[ke],ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=b[(ke+9)%16],V=P[(ke+9)%16],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,qe=b[(ke+1)%16],Te=P[(ke+1)%16],j=(qe>>>1|Te<<32-1)^(qe>>>8|Te<<32-8)^qe>>>7,V=(Te>>>1|qe<<32-1)^(Te>>>8|qe<<32-8)^(Te>>>7|qe<<32-7),ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,qe=b[(ke+14)%16],Te=P[(ke+14)%16],j=(qe>>>19|Te<<32-19)^(Te>>>61-32|qe<<32-(61-32))^qe>>>6,V=(Te>>>19|qe<<32-19)^(qe>>>61-32|Te<<32-(61-32))^(Te>>>6|qe<<32-6),ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,b[ke]=J&65535|Z<<16,P[ke]=ee&65535|Y<<16}j=q,V=p,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[0],V=E[0],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[0]=q=J&65535|Z<<16,E[0]=p=ee&65535|Y<<16,j=W,V=N,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[1],V=E[1],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[1]=W=J&65535|Z<<16,E[1]=N=ee&65535|Y<<16,j=ie,V=x,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[2],V=E[2],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[2]=ie=J&65535|Z<<16,E[2]=x=ee&65535|Y<<16,j=ce,V=Q,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[3],V=E[3],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[3]=ce=J&65535|Z<<16,E[3]=Q=ee&65535|Y<<16,j=u,V=se,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[4],V=E[4],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[4]=u=J&65535|Z<<16,E[4]=se=ee&65535|Y<<16,j=d,V=Ee,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[5],V=E[5],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[5]=d=J&65535|Z<<16,E[5]=Ee=ee&65535|Y<<16,j=m,V=Ae,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[6],V=E[6],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[6]=m=J&65535|Z<<16,E[6]=Ae=ee&65535|Y<<16,j=g,V=tt,ee=V&65535,Y=V>>>16,J=j&65535,Z=j>>>16,j=_[7],V=E[7],ee+=V&65535,Y+=V>>>16,J+=j&65535,Z+=j>>>16,Y+=ee>>>16,J+=Y>>>16,Z+=J>>>16,_[7]=g=J&65535|Z<<16,E[7]=tt=ee&65535|Y<<16,D+=128,H-=128}return D}function y(b){var P=new n;P.update(b);var _=P.digest();return P.clean(),_}s.hash=y})(jf);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.convertSecretKeyToX25519=s.convertPublicKeyToX25519=s.verify=s.sign=s.extractPublicKeyFromSecretKey=s.generateKeyPair=s.generateKeyPairFromSeed=s.SEED_LENGTH=s.SECRET_KEY_LENGTH=s.PUBLIC_KEY_LENGTH=s.SIGNATURE_LENGTH=void 0;const t=Fa,r=jf,n=xf;s.SIGNATURE_LENGTH=64,s.PUBLIC_KEY_LENGTH=32,s.SECRET_KEY_LENGTH=64,s.SEED_LENGTH=32;function o(M){const L=new Float64Array(16);if(M)for(let F=0;F<M.length;F++)L[F]=M[F];return L}const l=new Uint8Array(32);l[0]=9;const y=o(),b=o([1]),P=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),_=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),E=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),D=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function H(M,L){for(let F=0;F<16;F++)M[F]=L[F]|0}function q(M){let L=1;for(let F=0;F<16;F++){let h=M[F]+L+65535;L=Math.floor(h/65536),M[F]=h-L*65536}M[0]+=L-1+37*(L-1)}function W(M,L,F){const h=~(F-1);for(let T=0;T<16;T++){const ae=h&(M[T]^L[T]);M[T]^=ae,L[T]^=ae}}function ie(M,L){const F=o(),h=o();for(let T=0;T<16;T++)h[T]=L[T];q(h),q(h),q(h);for(let T=0;T<2;T++){F[0]=h[0]-65517;for(let de=1;de<15;de++)F[de]=h[de]-65535-(F[de-1]>>16&1),F[de-1]&=65535;F[15]=h[15]-32767-(F[14]>>16&1);const ae=F[15]>>16&1;F[14]&=65535,W(h,F,1-ae)}for(let T=0;T<16;T++)M[2*T]=h[T]&255,M[2*T+1]=h[T]>>8}function ce(M,L){let F=0;for(let h=0;h<32;h++)F|=M[h]^L[h];return(1&F-1>>>8)-1}function u(M,L){const F=new Uint8Array(32),h=new Uint8Array(32);return ie(F,M),ie(h,L),ce(F,h)}function d(M){const L=new Uint8Array(32);return ie(L,M),L[0]&1}function m(M,L){for(let F=0;F<16;F++)M[F]=L[2*F]+(L[2*F+1]<<8);M[15]&=32767}function g(M,L,F){for(let h=0;h<16;h++)M[h]=L[h]+F[h]}function p(M,L,F){for(let h=0;h<16;h++)M[h]=L[h]-F[h]}function N(M,L,F){let h,T,ae=0,de=0,ve=0,Ce=0,$e=0,Se=0,xt=0,wt=0,at=0,De=0,Je=0,Ye=0,ot=0,Me=0,Ze=0,Re=0,Ke=0,lt=0,je=0,Pt=0,Ft=0,zt=0,Ht=0,jt=0,Yt=0,ar=0,Hr=0,Zt=0,Jr=0,di=0,Ni=0,ft=F[0],rt=F[1],dt=F[2],pt=F[3],ct=F[4],it=F[5],Ot=F[6],Nt=F[7],gt=F[8],At=F[9],mt=F[10],bt=F[11],yt=F[12],Qe=F[13],Tt=F[14],Ct=F[15];h=L[0],ae+=h*ft,de+=h*rt,ve+=h*dt,Ce+=h*pt,$e+=h*ct,Se+=h*it,xt+=h*Ot,wt+=h*Nt,at+=h*gt,De+=h*At,Je+=h*mt,Ye+=h*bt,ot+=h*yt,Me+=h*Qe,Ze+=h*Tt,Re+=h*Ct,h=L[1],de+=h*ft,ve+=h*rt,Ce+=h*dt,$e+=h*pt,Se+=h*ct,xt+=h*it,wt+=h*Ot,at+=h*Nt,De+=h*gt,Je+=h*At,Ye+=h*mt,ot+=h*bt,Me+=h*yt,Ze+=h*Qe,Re+=h*Tt,Ke+=h*Ct,h=L[2],ve+=h*ft,Ce+=h*rt,$e+=h*dt,Se+=h*pt,xt+=h*ct,wt+=h*it,at+=h*Ot,De+=h*Nt,Je+=h*gt,Ye+=h*At,ot+=h*mt,Me+=h*bt,Ze+=h*yt,Re+=h*Qe,Ke+=h*Tt,lt+=h*Ct,h=L[3],Ce+=h*ft,$e+=h*rt,Se+=h*dt,xt+=h*pt,wt+=h*ct,at+=h*it,De+=h*Ot,Je+=h*Nt,Ye+=h*gt,ot+=h*At,Me+=h*mt,Ze+=h*bt,Re+=h*yt,Ke+=h*Qe,lt+=h*Tt,je+=h*Ct,h=L[4],$e+=h*ft,Se+=h*rt,xt+=h*dt,wt+=h*pt,at+=h*ct,De+=h*it,Je+=h*Ot,Ye+=h*Nt,ot+=h*gt,Me+=h*At,Ze+=h*mt,Re+=h*bt,Ke+=h*yt,lt+=h*Qe,je+=h*Tt,Pt+=h*Ct,h=L[5],Se+=h*ft,xt+=h*rt,wt+=h*dt,at+=h*pt,De+=h*ct,Je+=h*it,Ye+=h*Ot,ot+=h*Nt,Me+=h*gt,Ze+=h*At,Re+=h*mt,Ke+=h*bt,lt+=h*yt,je+=h*Qe,Pt+=h*Tt,Ft+=h*Ct,h=L[6],xt+=h*ft,wt+=h*rt,at+=h*dt,De+=h*pt,Je+=h*ct,Ye+=h*it,ot+=h*Ot,Me+=h*Nt,Ze+=h*gt,Re+=h*At,Ke+=h*mt,lt+=h*bt,je+=h*yt,Pt+=h*Qe,Ft+=h*Tt,zt+=h*Ct,h=L[7],wt+=h*ft,at+=h*rt,De+=h*dt,Je+=h*pt,Ye+=h*ct,ot+=h*it,Me+=h*Ot,Ze+=h*Nt,Re+=h*gt,Ke+=h*At,lt+=h*mt,je+=h*bt,Pt+=h*yt,Ft+=h*Qe,zt+=h*Tt,Ht+=h*Ct,h=L[8],at+=h*ft,De+=h*rt,Je+=h*dt,Ye+=h*pt,ot+=h*ct,Me+=h*it,Ze+=h*Ot,Re+=h*Nt,Ke+=h*gt,lt+=h*At,je+=h*mt,Pt+=h*bt,Ft+=h*yt,zt+=h*Qe,Ht+=h*Tt,jt+=h*Ct,h=L[9],De+=h*ft,Je+=h*rt,Ye+=h*dt,ot+=h*pt,Me+=h*ct,Ze+=h*it,Re+=h*Ot,Ke+=h*Nt,lt+=h*gt,je+=h*At,Pt+=h*mt,Ft+=h*bt,zt+=h*yt,Ht+=h*Qe,jt+=h*Tt,Yt+=h*Ct,h=L[10],Je+=h*ft,Ye+=h*rt,ot+=h*dt,Me+=h*pt,Ze+=h*ct,Re+=h*it,Ke+=h*Ot,lt+=h*Nt,je+=h*gt,Pt+=h*At,Ft+=h*mt,zt+=h*bt,Ht+=h*yt,jt+=h*Qe,Yt+=h*Tt,ar+=h*Ct,h=L[11],Ye+=h*ft,ot+=h*rt,Me+=h*dt,Ze+=h*pt,Re+=h*ct,Ke+=h*it,lt+=h*Ot,je+=h*Nt,Pt+=h*gt,Ft+=h*At,zt+=h*mt,Ht+=h*bt,jt+=h*yt,Yt+=h*Qe,ar+=h*Tt,Hr+=h*Ct,h=L[12],ot+=h*ft,Me+=h*rt,Ze+=h*dt,Re+=h*pt,Ke+=h*ct,lt+=h*it,je+=h*Ot,Pt+=h*Nt,Ft+=h*gt,zt+=h*At,Ht+=h*mt,jt+=h*bt,Yt+=h*yt,ar+=h*Qe,Hr+=h*Tt,Zt+=h*Ct,h=L[13],Me+=h*ft,Ze+=h*rt,Re+=h*dt,Ke+=h*pt,lt+=h*ct,je+=h*it,Pt+=h*Ot,Ft+=h*Nt,zt+=h*gt,Ht+=h*At,jt+=h*mt,Yt+=h*bt,ar+=h*yt,Hr+=h*Qe,Zt+=h*Tt,Jr+=h*Ct,h=L[14],Ze+=h*ft,Re+=h*rt,Ke+=h*dt,lt+=h*pt,je+=h*ct,Pt+=h*it,Ft+=h*Ot,zt+=h*Nt,Ht+=h*gt,jt+=h*At,Yt+=h*mt,ar+=h*bt,Hr+=h*yt,Zt+=h*Qe,Jr+=h*Tt,di+=h*Ct,h=L[15],Re+=h*ft,Ke+=h*rt,lt+=h*dt,je+=h*pt,Pt+=h*ct,Ft+=h*it,zt+=h*Ot,Ht+=h*Nt,jt+=h*gt,Yt+=h*At,ar+=h*mt,Hr+=h*bt,Zt+=h*yt,Jr+=h*Qe,di+=h*Tt,Ni+=h*Ct,ae+=38*Ke,de+=38*lt,ve+=38*je,Ce+=38*Pt,$e+=38*Ft,Se+=38*zt,xt+=38*Ht,wt+=38*jt,at+=38*Yt,De+=38*ar,Je+=38*Hr,Ye+=38*Zt,ot+=38*Jr,Me+=38*di,Ze+=38*Ni,T=1,h=ae+T+65535,T=Math.floor(h/65536),ae=h-T*65536,h=de+T+65535,T=Math.floor(h/65536),de=h-T*65536,h=ve+T+65535,T=Math.floor(h/65536),ve=h-T*65536,h=Ce+T+65535,T=Math.floor(h/65536),Ce=h-T*65536,h=$e+T+65535,T=Math.floor(h/65536),$e=h-T*65536,h=Se+T+65535,T=Math.floor(h/65536),Se=h-T*65536,h=xt+T+65535,T=Math.floor(h/65536),xt=h-T*65536,h=wt+T+65535,T=Math.floor(h/65536),wt=h-T*65536,h=at+T+65535,T=Math.floor(h/65536),at=h-T*65536,h=De+T+65535,T=Math.floor(h/65536),De=h-T*65536,h=Je+T+65535,T=Math.floor(h/65536),Je=h-T*65536,h=Ye+T+65535,T=Math.floor(h/65536),Ye=h-T*65536,h=ot+T+65535,T=Math.floor(h/65536),ot=h-T*65536,h=Me+T+65535,T=Math.floor(h/65536),Me=h-T*65536,h=Ze+T+65535,T=Math.floor(h/65536),Ze=h-T*65536,h=Re+T+65535,T=Math.floor(h/65536),Re=h-T*65536,ae+=T-1+37*(T-1),T=1,h=ae+T+65535,T=Math.floor(h/65536),ae=h-T*65536,h=de+T+65535,T=Math.floor(h/65536),de=h-T*65536,h=ve+T+65535,T=Math.floor(h/65536),ve=h-T*65536,h=Ce+T+65535,T=Math.floor(h/65536),Ce=h-T*65536,h=$e+T+65535,T=Math.floor(h/65536),$e=h-T*65536,h=Se+T+65535,T=Math.floor(h/65536),Se=h-T*65536,h=xt+T+65535,T=Math.floor(h/65536),xt=h-T*65536,h=wt+T+65535,T=Math.floor(h/65536),wt=h-T*65536,h=at+T+65535,T=Math.floor(h/65536),at=h-T*65536,h=De+T+65535,T=Math.floor(h/65536),De=h-T*65536,h=Je+T+65535,T=Math.floor(h/65536),Je=h-T*65536,h=Ye+T+65535,T=Math.floor(h/65536),Ye=h-T*65536,h=ot+T+65535,T=Math.floor(h/65536),ot=h-T*65536,h=Me+T+65535,T=Math.floor(h/65536),Me=h-T*65536,h=Ze+T+65535,T=Math.floor(h/65536),Ze=h-T*65536,h=Re+T+65535,T=Math.floor(h/65536),Re=h-T*65536,ae+=T-1+37*(T-1),M[0]=ae,M[1]=de,M[2]=ve,M[3]=Ce,M[4]=$e,M[5]=Se,M[6]=xt,M[7]=wt,M[8]=at,M[9]=De,M[10]=Je,M[11]=Ye,M[12]=ot,M[13]=Me,M[14]=Ze,M[15]=Re}function x(M,L){N(M,L,L)}function Q(M,L){const F=o();let h;for(h=0;h<16;h++)F[h]=L[h];for(h=253;h>=0;h--)x(F,F),h!==2&&h!==4&&N(F,F,L);for(h=0;h<16;h++)M[h]=F[h]}function se(M,L){const F=o();let h;for(h=0;h<16;h++)F[h]=L[h];for(h=250;h>=0;h--)x(F,F),h!==1&&N(F,F,L);for(h=0;h<16;h++)M[h]=F[h]}function Ee(M,L){const F=o(),h=o(),T=o(),ae=o(),de=o(),ve=o(),Ce=o(),$e=o(),Se=o();p(F,M[1],M[0]),p(Se,L[1],L[0]),N(F,F,Se),g(h,M[0],M[1]),g(Se,L[0],L[1]),N(h,h,Se),N(T,M[3],L[3]),N(T,T,_),N(ae,M[2],L[2]),g(ae,ae,ae),p(de,h,F),p(ve,ae,T),g(Ce,ae,T),g($e,h,F),N(M[0],de,ve),N(M[1],$e,Ce),N(M[2],Ce,ve),N(M[3],de,$e)}function Ae(M,L,F){for(let h=0;h<4;h++)W(M[h],L[h],F)}function tt(M,L){const F=o(),h=o(),T=o();Q(T,L[2]),N(F,L[0],T),N(h,L[1],T),ie(M,h),M[31]^=d(F)<<7}function j(M,L,F){H(M[0],y),H(M[1],b),H(M[2],b),H(M[3],y);for(let h=255;h>=0;--h){const T=F[h/8|0]>>(h&7)&1;Ae(M,L,T),Ee(L,M),Ee(M,M),Ae(M,L,T)}}function V(M,L){const F=[o(),o(),o(),o()];H(F[0],E),H(F[1],O),H(F[2],b),N(F[3],E,O),j(M,F,L)}function qe(M){if(M.length!==s.SEED_LENGTH)throw new Error(`ed25519: seed must be ${s.SEED_LENGTH} bytes`);const L=(0,r.hash)(M);L[0]&=248,L[31]&=127,L[31]|=64;const F=new Uint8Array(32),h=[o(),o(),o(),o()];V(h,L),tt(F,h);const T=new Uint8Array(64);return T.set(M),T.set(F,32),{publicKey:F,secretKey:T}}s.generateKeyPairFromSeed=qe;function Te(M){const L=(0,t.randomBytes)(32,M),F=qe(L);return(0,n.wipe)(L),F}s.generateKeyPair=Te;function ee(M){if(M.length!==s.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${s.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(M.subarray(32))}s.extractPublicKeyFromSecretKey=ee;const Y=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function J(M,L){let F,h,T,ae;for(h=63;h>=32;--h){for(F=0,T=h-32,ae=h-12;T<ae;++T)L[T]+=F-16*L[h]*Y[T-(h-32)],F=Math.floor((L[T]+128)/256),L[T]-=F*256;L[T]+=F,L[h]=0}for(F=0,T=0;T<32;T++)L[T]+=F-(L[31]>>4)*Y[T],F=L[T]>>8,L[T]&=255;for(T=0;T<32;T++)L[T]-=F*Y[T];for(h=0;h<32;h++)L[h+1]+=L[h]>>8,M[h]=L[h]&255}function Z(M){const L=new Float64Array(64);for(let F=0;F<64;F++)L[F]=M[F];for(let F=0;F<64;F++)M[F]=0;J(M,L)}function ht(M,L){const F=new Float64Array(64),h=[o(),o(),o(),o()],T=(0,r.hash)(M.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const ae=new Uint8Array(64);ae.set(T.subarray(32),32);const de=new r.SHA512;de.update(ae.subarray(32)),de.update(L);const ve=de.digest();de.clean(),Z(ve),V(h,ve),tt(ae,h),de.reset(),de.update(ae.subarray(0,32)),de.update(M.subarray(32)),de.update(L);const Ce=de.digest();Z(Ce);for(let $e=0;$e<32;$e++)F[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let Se=0;Se<32;Se++)F[$e+Se]+=Ce[$e]*T[Se];return J(ae.subarray(32),F),ae}s.sign=ht;function ke(M,L){const F=o(),h=o(),T=o(),ae=o(),de=o(),ve=o(),Ce=o();return H(M[2],b),m(M[1],L),x(T,M[1]),N(ae,T,P),p(T,T,M[2]),g(ae,M[2],ae),x(de,ae),x(ve,de),N(Ce,ve,de),N(F,Ce,T),N(F,F,ae),se(F,F),N(F,F,T),N(F,F,ae),N(F,F,ae),N(M[0],F,ae),x(h,M[0]),N(h,h,ae),u(h,T)&&N(M[0],M[0],D),x(h,M[0]),N(h,h,ae),u(h,T)?-1:(d(M[0])===L[31]>>7&&p(M[0],y,M[0]),N(M[3],M[0],M[1]),0)}function zr(M,L,F){const h=new Uint8Array(32),T=[o(),o(),o(),o()],ae=[o(),o(),o(),o()];if(F.length!==s.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${s.SIGNATURE_LENGTH} bytes`);if(ke(ae,M))return!1;const de=new r.SHA512;de.update(F.subarray(0,32)),de.update(M),de.update(L);const ve=de.digest();return Z(ve),j(T,ae,ve),V(ae,F.subarray(32)),Ee(T,ae),tt(h,T),!ce(F,h)}s.verify=zr;function be(M){let L=[o(),o(),o(),o()];if(ke(L,M))throw new Error("Ed25519: invalid public key");let F=o(),h=o(),T=L[1];g(F,b,T),p(h,b,T),Q(h,h),N(F,F,h);let ae=new Uint8Array(32);return ie(ae,F),ae}s.convertPublicKeyToX25519=be;function St(M){const L=(0,r.hash)(M.subarray(0,32));L[0]&=248,L[31]&=127,L[31]|=64;const F=new Uint8Array(L.subarray(0,32));return(0,n.wipe)(L),F}s.convertSecretKeyToX25519=St})(tu);const _w="EdDSA",Ew="JWT",Lf=".",qf="base64url",Iw="utf8",Sw="utf8",xw=":",Pw="did",Ow="key",Ol="base58btc",Nw="z",Aw="K36",Tw=32;function xa(s){return Jt(nr(ss(s),Iw),qf)}function Mf(s){const t=nr(Aw,Ol),r=Nw+Jt(Dc([t,s]),Ol);return[Pw,Ow,r].join(xw)}function Cw(s){return Jt(s,qf)}function Rw(s){return nr([xa(s.header),xa(s.payload)].join(Lf),Sw)}function $w(s){return[xa(s.header),xa(s.payload),Cw(s.signature)].join(Lf)}function Nl(s=Fa.randomBytes(Tw)){return tu.generateKeyPairFromSeed(s)}async function Fw(s,t,r,n,o=ne.fromMiliseconds(Date.now())){const l={alg:_w,typ:Ew},y=Mf(n.publicKey),b=o+r,P={iss:y,sub:s,aud:t,iat:o,exp:b},_=Rw({header:l,payload:P}),E=tu.sign(n.secretKey,_);return $w({header:l,payload:P,signature:E})}var rs={},Dw=s=>encodeURIComponent(s).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`);(function(s){const t=Dw,r=$a,n=Ca,o=Ra,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function D(u){return Array.isArray(u)?u.sort():typeof u=="object"?D(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function q(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=D(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=q(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(rs);const zf="base10",sr="base16",Lc="base64pad",ru="utf8",Hf=0,bn=1,Uw=0,Al=1,qc=12,iu=32;function jw(){const s=Pf.generateKeyPair();return{privateKey:Jt(s.secretKey,sr),publicKey:Jt(s.publicKey,sr)}}function Mc(){const s=Fa.randomBytes(iu);return Jt(s,sr)}function Lw(s,t){const r=Pf.sharedKey(nr(s,sr),nr(t,sr),!0),n=new uv(Da.SHA256,r).expand(iu);return Jt(n,sr)}function qw(s){const t=Da.hash(nr(s,sr));return Jt(t,sr)}function zc(s){const t=Da.hash(nr(s,ru));return Jt(t,sr)}function Mw(s){return nr(`${s}`,zf)}function os(s){return Number(Jt(s,zf))}function zw(s){const t=Mw(typeof s.type<"u"?s.type:Hf);if(os(t)===bn&&typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof s.senderPublicKey<"u"?nr(s.senderPublicKey,sr):void 0,n=typeof s.iv<"u"?nr(s.iv,sr):Fa.randomBytes(qc),o=new Of.ChaCha20Poly1305(nr(s.symKey,sr)).seal(n,nr(s.message,ru));return kw({type:t,sealed:o,iv:n,senderPublicKey:r})}function Hw(s){const t=new Of.ChaCha20Poly1305(nr(s.symKey,sr)),{sealed:r,iv:n}=Pa(s.encoded),o=t.open(n,r);if(o===null)throw new Error("Failed to decrypt");return Jt(o,ru)}function kw(s){if(os(s.type)===bn){if(typeof s.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Jt(Dc([s.type,s.senderPublicKey,s.iv,s.sealed]),Lc)}return Jt(Dc([s.type,s.iv,s.sealed]),Lc)}function Pa(s){const t=nr(s,Lc),r=t.slice(Uw,Al),n=Al;if(os(r)===bn){const b=n+iu,P=b+qc,_=t.slice(n,b),E=t.slice(b,P),O=t.slice(P);return{type:r,sealed:O,iv:E,senderPublicKey:_}}const o=n+qc,l=t.slice(n,o),y=t.slice(o);return{type:r,sealed:y,iv:l}}function Kw(s,t){const r=Pa(s);return kf({type:os(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Jt(r.senderPublicKey,sr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function kf(s){const t=(s==null?void 0:s.type)||Hf;if(t===bn){if(typeof(s==null?void 0:s.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(s==null?void 0:s.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:s==null?void 0:s.senderPublicKey,receiverPublicKey:s==null?void 0:s.receiverPublicKey}}function Tl(s){return s.type===bn&&typeof s.senderPublicKey=="string"&&typeof s.receiverPublicKey=="string"}var Vw=Object.defineProperty,Cl=Object.getOwnPropertySymbols,Bw=Object.prototype.hasOwnProperty,Gw=Object.prototype.propertyIsEnumerable,Rl=(s,t,r)=>t in s?Vw(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,$l=(s,t)=>{for(var r in t||(t={}))Bw.call(t,r)&&Rl(s,r,t[r]);if(Cl)for(var r of Cl(t))Gw.call(t,r)&&Rl(s,r,t[r]);return s};const Ww="ReactNative",Mr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Qw="js";function nu(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function _n(){return!Nf()&&!!Ua()&&navigator.product===Ww}function La(){return!nu()&&!!Ua()}function qa(){return _n()?Mr.reactNative:nu()?Mr.node:La()?Mr.browser:Mr.unknown}function Jw(){var s;try{return _n()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(s=global.Application)==null?void 0:s.applicationId:void 0}catch{return}}function Yw(s,t){let r=rs.parse(s);return r=$l($l({},r),t),s=rs.stringify(r),s}function Zw(){if(qa()===Mr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const s=pv();if(s===null)return"unknown";const t=s.os?s.os.replace(" ","").toLowerCase():"unknown";return s.type==="browser"?[t,s.name,s.version].join("-"):[t,s.version].join("-")}function Xw(){var s;const t=qa();return t===Mr.browser?[t,((s=hv())==null?void 0:s.host)||"unknown"].join(":"):t}function eb(s,t,r){const n=Zw(),o=Xw();return[[s,t].join("-"),[Qw,r].join("-"),n,o].join("/")}function tb({protocol:s,version:t,relayUrl:r,sdkVersion:n,auth:o,projectId:l,useOnCloseEvent:y,bundleId:b}){const P=r.split("?"),_=eb(s,t,n),E={auth:o,ua:_,projectId:l,useOnCloseEvent:y||void 0,origin:b||void 0},O=Yw(P[1]||"",E);return P[0]+"?"+O}function Kf(s){return Object.fromEntries(s.entries())}function Vf(s){return new Map(Object.entries(s))}function rb(s=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(s||ne.FIVE_MINUTES);let n,o,l;return{resolve:y=>{l&&n&&(clearTimeout(l),n(y))},reject:y=>{l&&o&&(clearTimeout(l),o(y))},done:()=>new Promise((y,b)=>{l=setTimeout(()=>{b(new Error(t))},r),n=y,o=b})}}function is(s,t,r){return new Promise(async(n,o)=>{const l=setTimeout(()=>o(new Error(r)),t);try{const y=await s;n(y)}catch(y){o(y)}clearTimeout(l)})}function Bf(s,t){if(typeof t=="string"&&t.startsWith(`${s}:`))return t;if(s.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(s.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${s}`)}function ib(s){return Bf("topic",s)}function nb(s){return Bf("id",s)}function sb(s){const[t,r]=s.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function Ea(s,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(s))}function Fl(s){return Date.now()>=ne.toMiliseconds(s)}function _c(s,t){return`${s}${t?`:${t}`:""}`}const ab="irn";function Hc(s){return(s==null?void 0:s.relay)||{protocol:ab}}function Ia(s){const t=bv[s];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${s}`);return t}var ob=Object.defineProperty,Dl=Object.getOwnPropertySymbols,cb=Object.prototype.hasOwnProperty,ub=Object.prototype.propertyIsEnumerable,Ul=(s,t,r)=>t in s?ob(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,hb=(s,t)=>{for(var r in t||(t={}))cb.call(t,r)&&Ul(s,r,t[r]);if(Dl)for(var r of Dl(t))ub.call(t,r)&&Ul(s,r,t[r]);return s};function lb(s,t="-"){const r={},n="relay"+t;return Object.keys(s).forEach(o=>{if(o.startsWith(n)){const l=o.replace(n,""),y=s[o];r[l]=y}}),r}function jl(s){s=s.includes("wc://")?s.replace("wc://",""):s,s=s.includes("wc:")?s.replace("wc:",""):s;const t=s.indexOf(":"),r=s.indexOf("?")!==-1?s.indexOf("?"):void 0,n=s.substring(0,t),o=s.substring(t+1,r).split("@"),l=typeof r<"u"?s.substring(r):"",y=rs.parse(l);return{protocol:n,topic:fb(o[0]),version:parseInt(o[1],10),symKey:y.symKey,relay:lb(y)}}function fb(s){return s.startsWith("//")?s.substring(2):s}function db(s,t="-"){const r="relay",n={};return Object.keys(s).forEach(o=>{const l=r+t+o;s[o]&&(n[l]=s[o])}),n}function pb(s){return`${s.protocol}:${s.topic}@${s.version}?`+rs.stringify(hb({symKey:s.symKey},db(s.relay)))}const gb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},mb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function He(s,t){const{message:r,code:n}=mb[s];return{message:t?`${r} ${t}`:r,code:n}}function Jn(s,t){const{message:r,code:n}=gb[s];return{message:t?`${r} ${t}`:r,code:n}}function yb(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function Oa(s){return typeof s>"u"}function Gf(s,t){return t&&Oa(s)?!0:typeof s=="string"&&!!s.trim().length}function vb(s){if(Gf(s,!1))try{return typeof new URL(s)<"u"}catch{return!1}return!1}function wb(s){var t;return(t=s==null?void 0:s.proposer)==null?void 0:t.publicKey}function bb(s){return s==null?void 0:s.topic}function Ec(s){return typeof s<"u"&&typeof s!==null}function Ll(){const s=qa();return new Promise(t=>{switch(s){case Mr.browser:t(_b());break;case Mr.reactNative:t(Eb());break;case Mr.node:t(Ib());break;default:t(!0)}})}function _b(){return La()&&(navigator==null?void 0:navigator.onLine)}async function Eb(){if(_n()&&typeof global<"u"&&global!=null&&global.NetInfo){const s=await(global==null?void 0:global.NetInfo.fetch());return s==null?void 0:s.isConnected}return!0}function Ib(){return!0}function Sb(s){switch(qa()){case Mr.browser:xb(s);break;case Mr.reactNative:Pb(s);break}}function xb(s){!_n()&&La()&&(window.addEventListener("online",()=>s(!0)),window.addEventListener("offline",()=>s(!1)))}function Pb(s){_n()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>s(t==null?void 0:t.isConnected)))}const Ob=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Nb=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ql=s=>s.split("?")[0],Ml=10,Ab=Ob();let Tb=class{constructor(t){if(this.url=t,this.events=new Qr.EventEmitter,this.registering=!1,!ll(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ss(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!ll(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),o(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),l=gv.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!mv(t)},y=new Ab(t,[],l);Nb()?y.onerror=b=>{const P=b;n(this.emitError(P.error))}:y.on("error",b=>{n(this.emitError(b))}),y.onopen=()=>{this.onOpen(y),r(y)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ja(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),l=Jc(t,o);this.events.emit("payload",l)}parseError(t,r=this.url){return yv(t,ql(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ml&&this.events.setMaxListeners(Ml)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${ql(this.url)}`));return this.events.emit("register_error",r),r}};var Na={exports:{}};Na.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,l=2,y=9007199254740991,b="[object Arguments]",P="[object Array]",_="[object AsyncFunction]",E="[object Boolean]",O="[object Date]",D="[object Error]",H="[object Function]",q="[object GeneratorFunction]",W="[object Map]",ie="[object Number]",ce="[object Null]",u="[object Object]",d="[object Promise]",m="[object Proxy]",g="[object RegExp]",p="[object Set]",N="[object String]",x="[object Symbol]",Q="[object Undefined]",se="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",tt="[object Float32Array]",j="[object Float64Array]",V="[object Int8Array]",qe="[object Int16Array]",Te="[object Int32Array]",ee="[object Uint8Array]",Y="[object Uint8ClampedArray]",J="[object Uint16Array]",Z="[object Uint32Array]",ht=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,zr=/^(?:0|[1-9]\d*)$/,be={};be[tt]=be[j]=be[V]=be[qe]=be[Te]=be[ee]=be[Y]=be[J]=be[Z]=!0,be[b]=be[P]=be[Ee]=be[E]=be[Ae]=be[O]=be[D]=be[H]=be[W]=be[ie]=be[u]=be[g]=be[p]=be[N]=be[se]=!1;var St=typeof da=="object"&&da&&da.Object===Object&&da,M=typeof self=="object"&&self&&self.Object===Object&&self,L=St||M||Function("return this")(),F=t&&!t.nodeType&&t,h=F&&!0&&s&&!s.nodeType&&s,T=h&&h.exports===F,ae=T&&St.process,de=function(){try{return ae&&ae.binding&&ae.binding("util")}catch{}}(),ve=de&&de.isTypedArray;function Ce(I,C){for(var B=-1,te=I==null?0:I.length,Be=0,ge=[];++B<te;){var Xe=I[B];C(Xe,B,I)&&(ge[Be++]=Xe)}return ge}function $e(I,C){for(var B=-1,te=C.length,Be=I.length;++B<te;)I[Be+B]=C[B];return I}function Se(I,C){for(var B=-1,te=I==null?0:I.length;++B<te;)if(C(I[B],B,I))return!0;return!1}function xt(I,C){for(var B=-1,te=Array(I);++B<I;)te[B]=C(B);return te}function wt(I){return function(C){return I(C)}}function at(I,C){return I.has(C)}function De(I,C){return I==null?void 0:I[C]}function Je(I){var C=-1,B=Array(I.size);return I.forEach(function(te,Be){B[++C]=[Be,te]}),B}function Ye(I,C){return function(B){return I(C(B))}}function ot(I){var C=-1,B=Array(I.size);return I.forEach(function(te){B[++C]=te}),B}var Me=Array.prototype,Ze=Function.prototype,Re=Object.prototype,Ke=L["__core-js_shared__"],lt=Ze.toString,je=Re.hasOwnProperty,Pt=function(){var I=/[^.]+$/.exec(Ke&&Ke.keys&&Ke.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),Ft=Re.toString,zt=RegExp("^"+lt.call(je).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=T?L.Buffer:void 0,jt=L.Symbol,Yt=L.Uint8Array,ar=Re.propertyIsEnumerable,Hr=Me.splice,Zt=jt?jt.toStringTag:void 0,Jr=Object.getOwnPropertySymbols,di=Ht?Ht.isBuffer:void 0,Ni=Ye(Object.keys,Object),ft=pr(L,"DataView"),rt=pr(L,"Map"),dt=pr(L,"Promise"),pt=pr(L,"Set"),ct=pr(L,"WeakMap"),it=pr(Object,"create"),Ot=Zr(ft),Nt=Zr(rt),gt=Zr(dt),At=Zr(pt),mt=Zr(ct),bt=jt?jt.prototype:void 0,yt=bt?bt.valueOf:void 0;function Qe(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function Tt(){this.__data__=it?it(null):{},this.size=0}function Ct(I){var C=this.has(I)&&delete this.__data__[I];return this.size-=C?1:0,C}function ka(I){var C=this.__data__;if(it){var B=C[I];return B===n?void 0:B}return je.call(C,I)?C[I]:void 0}function Ka(I){var C=this.__data__;return it?C[I]!==void 0:je.call(C,I)}function Va(I,C){var B=this.__data__;return this.size+=this.has(I)?0:1,B[I]=it&&C===void 0?n:C,this}Qe.prototype.clear=Tt,Qe.prototype.delete=Ct,Qe.prototype.get=ka,Qe.prototype.has=Ka,Qe.prototype.set=Va;function _r(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function Ba(){this.__data__=[],this.size=0}function Ga(I){var C=this.__data__,B=Ai(C,I);if(B<0)return!1;var te=C.length-1;return B==te?C.pop():Hr.call(C,B,1),--this.size,!0}function Wa(I){var C=this.__data__,B=Ai(C,I);return B<0?void 0:C[B][1]}function Qa(I){return Ai(this.__data__,I)>-1}function Ja(I,C){var B=this.__data__,te=Ai(B,I);return te<0?(++this.size,B.push([I,C])):B[te][1]=C,this}_r.prototype.clear=Ba,_r.prototype.delete=Ga,_r.prototype.get=Wa,_r.prototype.has=Qa,_r.prototype.set=Ja;function Yr(I){var C=-1,B=I==null?0:I.length;for(this.clear();++C<B;){var te=I[C];this.set(te[0],te[1])}}function Qi(){this.size=0,this.__data__={hash:new Qe,map:new(rt||_r),string:new Qe}}function Ya(I){var C=pi(this,I).delete(I);return this.size-=C?1:0,C}function Ji(I){return pi(this,I).get(I)}function Za(I){return pi(this,I).has(I)}function Xa(I,C){var B=pi(this,I),te=B.size;return B.set(I,C),this.size+=B.size==te?0:1,this}Yr.prototype.clear=Qi,Yr.prototype.delete=Ya,Yr.prototype.get=Ji,Yr.prototype.has=Za,Yr.prototype.set=Xa;function Yi(I){var C=-1,B=I==null?0:I.length;for(this.__data__=new Yr;++C<B;)this.add(I[C])}function us(I){return this.__data__.set(I,n),this}function hs(I){return this.__data__.has(I)}Yi.prototype.add=Yi.prototype.push=us,Yi.prototype.has=hs;function Rr(I){var C=this.__data__=new _r(I);this.size=C.size}function eo(){this.__data__=new _r,this.size=0}function to(I){var C=this.__data__,B=C.delete(I);return this.size=C.size,B}function ro(I){return this.__data__.get(I)}function io(I){return this.__data__.has(I)}function ls(I,C){var B=this.__data__;if(B instanceof _r){var te=B.__data__;if(!rt||te.length<r-1)return te.push([I,C]),this.size=++B.size,this;B=this.__data__=new Yr(te)}return B.set(I,C),this.size=B.size,this}Rr.prototype.clear=eo,Rr.prototype.delete=to,Rr.prototype.get=ro,Rr.prototype.has=io,Rr.prototype.set=ls;function fs(I,C){var B=en(I),te=!B&&Ss(I),Be=!B&&!te&&xn(I),ge=!B&&!te&&!Be&&Os(I),Xe=B||te||Be||ge,Rt=Xe?xt(I.length,String):[],Pe=Rt.length;for(var Ge in I)(C||je.call(I,Ge))&&!(Xe&&(Ge=="length"||Be&&(Ge=="offset"||Ge=="parent")||ge&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||ws(Ge,Pe)))&&Rt.push(Ge);return Rt}function Ai(I,C){for(var B=I.length;B--;)if(Is(I[B][0],C))return B;return-1}function In(I,C,B){var te=C(I);return en(I)?te:$e(te,B(I))}function Ti(I){return I==null?I===void 0?Q:ce:Zt&&Zt in Object(I)?ys(I):ao(I)}function Sn(I){return Ri(I)&&Ti(I)==b}function Ci(I,C,B,te,Be){return I===C?!0:I==null||C==null||!Ri(I)&&!Ri(C)?I!==I&&C!==C:ds(I,C,B,te,Ci,Be)}function ds(I,C,B,te,Be,ge){var Xe=en(I),Rt=en(C),Pe=Xe?P:kr(I),Ge=Rt?P:kr(C);Pe=Pe==b?u:Pe,Ge=Ge==b?u:Ge;var _t=Pe==u,or=Ge==u,$t=Pe==Ge;if($t&&xn(I)){if(!xn(C))return!1;Xe=!0,_t=!1}if($t&&!_t)return ge||(ge=new Rr),Xe||Os(I)?Zi(I,C,B,te,Be,ge):so(I,C,Pe,B,te,Be,ge);if(!(B&o)){var et=_t&&je.call(I,"__wrapped__"),Xt=or&&je.call(C,"__wrapped__");if(et||Xt){var $r=et?I.value():I,Er=Xt?C.value():C;return ge||(ge=new Rr),Be($r,Er,B,te,ge)}}return $t?(ge||(ge=new Rr),ms(I,C,B,te,Be,ge)):!1}function no(I){if(!Ps(I)||_s(I))return!1;var C=tn(I)?zt:ke;return C.test(Zr(I))}function ps(I){return Ri(I)&&xs(I.length)&&!!be[Ti(I)]}function gs(I){if(!Es(I))return Ni(I);var C=[];for(var B in Object(I))je.call(I,B)&&B!="constructor"&&C.push(B);return C}function Zi(I,C,B,te,Be,ge){var Xe=B&o,Rt=I.length,Pe=C.length;if(Rt!=Pe&&!(Xe&&Pe>Rt))return!1;var Ge=ge.get(I);if(Ge&&ge.get(C))return Ge==C;var _t=-1,or=!0,$t=B&l?new Yi:void 0;for(ge.set(I,C),ge.set(C,I);++_t<Rt;){var et=I[_t],Xt=C[_t];if(te)var $r=Xe?te(Xt,et,_t,C,I,ge):te(et,Xt,_t,I,C,ge);if($r!==void 0){if($r)continue;or=!1;break}if($t){if(!Se(C,function(Er,Kr){if(!at($t,Kr)&&(et===Er||Be(et,Er,B,te,ge)))return $t.push(Kr)})){or=!1;break}}else if(!(et===Xt||Be(et,Xt,B,te,ge))){or=!1;break}}return ge.delete(I),ge.delete(C),or}function so(I,C,B,te,Be,ge,Xe){switch(B){case Ae:if(I.byteLength!=C.byteLength||I.byteOffset!=C.byteOffset)return!1;I=I.buffer,C=C.buffer;case Ee:return!(I.byteLength!=C.byteLength||!ge(new Yt(I),new Yt(C)));case E:case O:case ie:return Is(+I,+C);case D:return I.name==C.name&&I.message==C.message;case g:case N:return I==C+"";case W:var Rt=Je;case p:var Pe=te&o;if(Rt||(Rt=ot),I.size!=C.size&&!Pe)return!1;var Ge=Xe.get(I);if(Ge)return Ge==C;te|=l,Xe.set(I,C);var _t=Zi(Rt(I),Rt(C),te,Be,ge,Xe);return Xe.delete(I),_t;case x:if(yt)return yt.call(I)==yt.call(C)}return!1}function ms(I,C,B,te,Be,ge){var Xe=B&o,Rt=Xi(I),Pe=Rt.length,Ge=Xi(C),_t=Ge.length;if(Pe!=_t&&!Xe)return!1;for(var or=Pe;or--;){var $t=Rt[or];if(!(Xe?$t in C:je.call(C,$t)))return!1}var et=ge.get(I);if(et&&ge.get(C))return et==C;var Xt=!0;ge.set(I,C),ge.set(C,I);for(var $r=Xe;++or<Pe;){$t=Rt[or];var Er=I[$t],Kr=C[$t];if(te)var Pn=Xe?te(Kr,Er,$t,C,I,ge):te(Er,Kr,$t,I,C,ge);if(!(Pn===void 0?Er===Kr||Be(Er,Kr,B,te,ge):Pn)){Xt=!1;break}$r||($r=$t=="constructor")}if(Xt&&!$r){var $i=I.constructor,Lt=C.constructor;$i!=Lt&&"constructor"in I&&"constructor"in C&&!(typeof $i=="function"&&$i instanceof $i&&typeof Lt=="function"&&Lt instanceof Lt)&&(Xt=!1)}return ge.delete(I),ge.delete(C),Xt}function Xi(I){return In(I,uo,vs)}function pi(I,C){var B=I.__data__;return bs(C)?B[typeof C=="string"?"string":"hash"]:B.map}function pr(I,C){var B=De(I,C);return no(B)?B:void 0}function ys(I){var C=je.call(I,Zt),B=I[Zt];try{I[Zt]=void 0;var te=!0}catch{}var Be=Ft.call(I);return te&&(C?I[Zt]=B:delete I[Zt]),Be}var vs=Jr?function(I){return I==null?[]:(I=Object(I),Ce(Jr(I),function(C){return ar.call(I,C)}))}:Ve,kr=Ti;(ft&&kr(new ft(new ArrayBuffer(1)))!=Ae||rt&&kr(new rt)!=W||dt&&kr(dt.resolve())!=d||pt&&kr(new pt)!=p||ct&&kr(new ct)!=se)&&(kr=function(I){var C=Ti(I),B=C==u?I.constructor:void 0,te=B?Zr(B):"";if(te)switch(te){case Ot:return Ae;case Nt:return W;case gt:return d;case At:return p;case mt:return se}return C});function ws(I,C){return C=C??y,!!C&&(typeof I=="number"||zr.test(I))&&I>-1&&I%1==0&&I<C}function bs(I){var C=typeof I;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?I!=="__proto__":I===null}function _s(I){return!!Pt&&Pt in I}function Es(I){var C=I&&I.constructor,B=typeof C=="function"&&C.prototype||Re;return I===B}function ao(I){return Ft.call(I)}function Zr(I){if(I!=null){try{return lt.call(I)}catch{}try{return I+""}catch{}}return""}function Is(I,C){return I===C||I!==I&&C!==C}var Ss=Sn(function(){return arguments}())?Sn:function(I){return Ri(I)&&je.call(I,"callee")&&!ar.call(I,"callee")},en=Array.isArray;function oo(I){return I!=null&&xs(I.length)&&!tn(I)}var xn=di||ze;function co(I,C){return Ci(I,C)}function tn(I){if(!Ps(I))return!1;var C=Ti(I);return C==H||C==q||C==_||C==m}function xs(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=y}function Ps(I){var C=typeof I;return I!=null&&(C=="object"||C=="function")}function Ri(I){return I!=null&&typeof I=="object"}var Os=ve?wt(ve):ps;function uo(I){return oo(I)?fs(I):gs(I)}function Ve(){return[]}function ze(){return!1}s.exports=co})(Na,Na.exports);var Cb=Na.exports;const Rb=lv(Cb);function $b(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var l=s.charAt(o),y=l.charCodeAt(0);if(r[y]!==255)throw new TypeError(l+" is ambiguous");r[y]=o}var b=s.length,P=s.charAt(0),_=Math.log(b)/Math.log(256),E=Math.log(256)/Math.log(b);function O(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var W=0,ie=0,ce=0,u=q.length;ce!==u&&q[ce]===0;)ce++,W++;for(var d=(u-ce)*E+1>>>0,m=new Uint8Array(d);ce!==u;){for(var g=q[ce],p=0,N=d-1;(g!==0||p<ie)&&N!==-1;N--,p++)g+=256*m[N]>>>0,m[N]=g%b>>>0,g=g/b>>>0;if(g!==0)throw new Error("Non-zero carry");ie=p,ce++}for(var x=d-ie;x!==d&&m[x]===0;)x++;for(var Q=P.repeat(W);x<d;++x)Q+=s.charAt(m[x]);return Q}function D(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var W=0;if(q[W]!==" "){for(var ie=0,ce=0;q[W]===P;)ie++,W++;for(var u=(q.length-W)*_+1>>>0,d=new Uint8Array(u);q[W];){var m=r[q.charCodeAt(W)];if(m===255)return;for(var g=0,p=u-1;(m!==0||g<ce)&&p!==-1;p--,g++)m+=b*d[p]>>>0,d[p]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");ce=g,W++}if(q[W]!==" "){for(var N=u-ce;N!==u&&d[N]===0;)N++;for(var x=new Uint8Array(ie+(u-N)),Q=ie;N!==u;)x[Q++]=d[N++];return x}}}function H(q){var W=D(q);if(W)return W;throw new Error(`Non-${t} character`)}return{encode:O,decodeUnsafe:D,decode:H}}var Fb=$b,Db=Fb;const Wf=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},Ub=s=>new TextEncoder().encode(s),jb=s=>new TextDecoder().decode(s);class Lb{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class qb{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Qf(this,t)}}let Mb=class{constructor(t){this.decoders=t}or(t){return Qf(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Qf=(s,t)=>new Mb({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class zb{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Lb(t,r,n),this.decoder=new qb(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Ma=({name:s,prefix:t,encode:r,decode:n})=>new zb(s,t,r,n),cs=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=Db(r,t);return Ma({prefix:s,name:t,encode:n,decode:l=>Wf(o(l))})},Hb=(s,t,r,n)=>{const o={};for(let E=0;E<t.length;++E)o[t[E]]=E;let l=s.length;for(;s[l-1]==="=";)--l;const y=new Uint8Array(l*r/8|0);let b=0,P=0,_=0;for(let E=0;E<l;++E){const O=o[s[E]];if(O===void 0)throw new SyntaxError(`Non-${n} character`);P=P<<r|O,b+=r,b>=8&&(b-=8,y[_++]=255&P>>b)}if(b>=r||255&P<<8-b)throw new SyntaxError("Unexpected end of data");return y},kb=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let l="",y=0,b=0;for(let P=0;P<s.length;++P)for(b=b<<8|s[P],y+=8;y>r;)y-=r,l+=t[o&b>>y];if(y&&(l+=t[o&b<<r-y]),n)for(;l.length*r&7;)l+="=";return l},Vt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Ma({prefix:t,name:s,encode(o){return kb(o,n,r)},decode(o){return Hb(o,n,r,s)}}),Kb=Ma({prefix:"\0",name:"identity",encode:s=>jb(s),decode:s=>Ub(s)});var Vb=Object.freeze({__proto__:null,identity:Kb});const Bb=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gb=Object.freeze({__proto__:null,base2:Bb});const Wb=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Qb=Object.freeze({__proto__:null,base8:Wb});const Jb=cs({prefix:"9",name:"base10",alphabet:"0123456789"});var Yb=Object.freeze({__proto__:null,base10:Jb});const Zb=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xb=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e_=Object.freeze({__proto__:null,base16:Zb,base16upper:Xb});const t_=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),r_=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),i_=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),n_=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),s_=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),a_=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o_=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c_=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),u_=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var h_=Object.freeze({__proto__:null,base32:t_,base32upper:r_,base32pad:i_,base32padupper:n_,base32hex:s_,base32hexupper:a_,base32hexpad:o_,base32hexpadupper:c_,base32z:u_});const l_=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),f_=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var d_=Object.freeze({__proto__:null,base36:l_,base36upper:f_});const p_=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),g_=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var m_=Object.freeze({__proto__:null,base58btc:p_,base58flickr:g_});const y_=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),v_=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),w_=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b_=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var __=Object.freeze({__proto__:null,base64:y_,base64pad:v_,base64url:w_,base64urlpad:b_});const Jf=Array.from(""),E_=Jf.reduce((s,t,r)=>(s[r]=t,s),[]),I_=Jf.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function S_(s){return s.reduce((t,r)=>(t+=E_[r],t),"")}function x_(s){const t=[];for(const r of s){const n=I_[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const P_=Ma({prefix:"",name:"base256emoji",encode:S_,decode:x_});var O_=Object.freeze({__proto__:null,base256emoji:P_}),N_=Yf,zl=128,A_=127,T_=~A_,C_=Math.pow(2,31);function Yf(s,t,r){t=t||[],r=r||0;for(var n=r;s>=C_;)t[r++]=s&255|zl,s/=128;for(;s&T_;)t[r++]=s&255|zl,s>>>=7;return t[r]=s|0,Yf.bytes=r-n+1,t}var R_=kc,$_=128,Hl=127;function kc(s,n){var r=0,n=n||0,o=0,l=n,y,b=s.length;do{if(l>=b)throw kc.bytes=0,new RangeError("Could not decode varint");y=s[l++],r+=o<28?(y&Hl)<<o:(y&Hl)*Math.pow(2,o),o+=7}while(y>=$_);return kc.bytes=l-n,r}var F_=Math.pow(2,7),D_=Math.pow(2,14),U_=Math.pow(2,21),j_=Math.pow(2,28),L_=Math.pow(2,35),q_=Math.pow(2,42),M_=Math.pow(2,49),z_=Math.pow(2,56),H_=Math.pow(2,63),k_=function(s){return s<F_?1:s<D_?2:s<U_?3:s<j_?4:s<L_?5:s<q_?6:s<M_?7:s<z_?8:s<H_?9:10},K_={encode:N_,decode:R_,encodingLength:k_},Zf=K_;const kl=(s,t,r=0)=>(Zf.encode(s,t,r),t),Kl=s=>Zf.encodingLength(s),Kc=(s,t)=>{const r=t.byteLength,n=Kl(s),o=n+Kl(r),l=new Uint8Array(o+r);return kl(s,l,0),kl(r,l,n),l.set(t,o),new V_(s,r,t,l)};let V_=class{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};const Xf=({name:s,code:t,encode:r})=>new B_(s,t,r);class B_{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Kc(this.code,r):r.then(n=>Kc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const ed=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),G_=Xf({name:"sha2-256",code:18,encode:ed("SHA-256")}),W_=Xf({name:"sha2-512",code:19,encode:ed("SHA-512")});var Q_=Object.freeze({__proto__:null,sha256:G_,sha512:W_});const td=0,J_="identity",rd=Wf,Y_=s=>Kc(td,rd(s)),Z_={code:td,name:J_,encode:rd,digest:Y_};var X_=Object.freeze({__proto__:null,identity:Z_});new TextEncoder,new TextDecoder;const Vl={...Vb,...Gb,...Qb,...Yb,...e_,...h_,...d_,...m_,...__,...O_};({...Q_,...X_});function id(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function eE(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?id(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function nd(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const Bl=nd("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),Ic=nd("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=eE(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),tE={utf8:Bl,"utf-8":Bl,hex:Vl.base16,latin1:Ic,ascii:Ic,binary:Ic,...Vl};function rE(s,t="utf8"){const r=tE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?id(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const sd="wc",iE=2,su="core",xi=`${sd}@2:${su}:`,nE={name:su,logger:"error"},sE={database:":memory:"},aE="crypto",Gl="client_ed25519_seed",oE=ne.ONE_DAY,cE="keychain",uE="0.3",hE="messages",lE="0.3",fE=ne.SIX_HOURS,dE="publisher",ad="irn",pE="error",od="wss://relay.walletconnect.com",Wl="wss://relay.walletconnect.org",gE="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},mE="_subscription",ci={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},yE=ne.ONE_SECOND,vE="2.10.6",wE=1e4,bE="0.3",_E="WALLETCONNECT_CLIENT_ID",qr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},EE="subscription",IE="0.3",SE=ne.FIVE_SECONDS*1e3,xE="pairing",PE="0.3",Kn={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},OE="history",NE="0.3",AE="expirer",Tr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},TE="0.3",Sc="verify-api",yn="https://verify.walletconnect.com",Vc="https://verify.walletconnect.org",CE=[yn,Vc];class RE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=cE,this.version=uE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:l}=He("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Kf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Vf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class $E{constructor(t,r,n){this.core=t,this.logger=r,this.name=aE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),l=Nl(o);return Mf(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=jw();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const l=await this.getClientSeed(),y=Nl(l),b=Mc();return await Fw(b,o,oE,y)},this.generateSharedKey=(o,l,y)=>{this.isInitialized();const b=this.getPrivateKey(o),P=Lw(b,l);return this.setSymKey(P,y)},this.setSymKey=async(o,l)=>{this.isInitialized();const y=l||qw(o);return await this.keychain.set(y,o),y},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,l,y)=>{this.isInitialized();const b=kf(y),P=ss(l);if(Tl(b)){const D=b.senderPublicKey,H=b.receiverPublicKey;o=await this.generateSharedKey(D,H)}const _=this.getSymKey(o),{type:E,senderPublicKey:O}=b;return zw({type:E,symKey:_,message:P,senderPublicKey:O})},this.decode=async(o,l,y)=>{this.isInitialized();const b=Kw(l,y);if(Tl(b)){const P=b.receiverPublicKey,_=b.senderPublicKey;o=await this.generateSharedKey(P,_)}try{const P=this.getSymKey(o),_=Hw({symKey:P,encoded:l});return ja(_)}catch(P){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(P)}},this.getPayloadType=o=>{const l=Pa(o);return os(l.type)},this.getPayloadSenderPublicKey=o=>{const l=Pa(o);return l.senderPublicKey?Jt(l.senderPublicKey,sr):void 0},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.keychain=n||new RE(this.core,this.logger)}get context(){return Ne.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Gl)}catch{t=Mc(),await this.keychain.set(Gl,t)}return rE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class FE extends fw{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=hE,this.version=lE,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const l=zc(o);let y=this.messages.get(n);return typeof y>"u"&&(y={}),typeof y[l]<"u"||(y[l]=o,this.messages.set(n,y),await this.persist()),l},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const l=this.get(n),y=zc(o);return typeof l[y]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ne.generateChildLogger(t,this.name),this.core=r}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Kf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Vf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class DE extends dw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qr.EventEmitter,this.name=dE,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,l)=>{var y;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}});try{const b=(l==null?void 0:l.ttl)||fE,P=Hc(l),_=(l==null?void 0:l.prompt)||!1,E=(l==null?void 0:l.tag)||0,O=(l==null?void 0:l.id)||vv().toString(),D={topic:n,message:o,opts:{ttl:b,relay:P,prompt:_,tag:E,id:O}},H=setTimeout(()=>this.queue.set(O,D),this.publishTimeout);try{await await is(this.rpcPublish(n,o,b,P,_,E,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Wt.publish,D)}catch(q){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(y=l==null?void 0:l.internal)!=null&&y.throwOnFailedPublish)throw this.removeRequestFromQueue(O),q;return}finally{clearTimeout(H)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:l}})}catch(b){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(b),b}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ne.getLoggerContext(this.logger)}rpcPublish(t,r,n,o,l,y,b){var P,_,E,O;const D={method:Ia(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:l,tag:y},id:b};return Oa((P=D.params)==null?void 0:P.prompt)&&((_=D.params)==null||delete _.prompt),Oa((E=D.params)==null?void 0:E.tag)&&((O=D.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:D}),this.relayer.request(D)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class UE{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(l=>l!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var jE=Object.defineProperty,LE=Object.defineProperties,qE=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,ME=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,Jl=(s,t,r)=>t in s?jE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Vn=(s,t)=>{for(var r in t||(t={}))ME.call(t,r)&&Jl(s,r,t[r]);if(Ql)for(var r of Ql(t))zE.call(t,r)&&Jl(s,r,t[r]);return s},xc=(s,t)=>LE(s,qE(t));class HE extends mw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new UE,this.events=new Qr.EventEmitter,this.name=EE,this.version=IE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const l=Hc(o),y={topic:n,relay:l};this.pending.set(n,y);const b=await this.rpcSubscribe(n,l);return this.onSubscribe(b,y),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),b}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,l)=>{const y=new ne.Watch;y.start(this.pendingSubscriptionWatchLabel);const b=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(b),y.stop(this.pendingSubscriptionWatchLabel),o(!0)),y.elapsed(this.pendingSubscriptionWatchLabel)>=SE&&(clearInterval(b),y.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ne.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=Hc(n);await this.rpcUnsubscribe(t,r,o);const l=Jn("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:Ia(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return zc(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:Ia(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await is(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:Ia(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,xc(Vn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Vn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Vn({},r)),this.topicMap.set(r.topic,t),this.events.emit(qr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(qr.deleted,xc(Vn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(qr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);yb(r)&&this.onBatchSubscribe(r.map((n,o)=>xc(Vn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(qr.created,async t=>{const r=qr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(qr.deleted,async t=>{const r=qr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var kE=Object.defineProperty,Yl=Object.getOwnPropertySymbols,KE=Object.prototype.hasOwnProperty,VE=Object.prototype.propertyIsEnumerable,Zl=(s,t,r)=>t in s?kE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,BE=(s,t)=>{for(var r in t||(t={}))KE.call(t,r)&&Zl(s,r,t[r]);if(Yl)for(var r of Yl(t))VE.call(t,r)&&Zl(s,r,t[r]);return s};class GE extends pw{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=gE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Wt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ci.payload,this.onPayloadHandler),this.provider.on(ci.connect,this.onConnectHandler),this.provider.on(ci.disconnect,this.onDisconnectHandler),this.provider.on(ci.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ne.generateChildLogger(t.logger,this.name):Ne.pino(Ne.getDefaultLoggerOptions({level:t.logger||pE})),this.messages=new FE(this.logger,t.core),this.subscriber=new HE(this,this.logger),this.publisher=new DE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||od,this.projectId=t.projectId,this.bundleId=Jw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Wl}...`),await this.restartTransport(Wl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},wE)}get context(){return Ne.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let l;const y=b=>{b.topic===t&&(this.subscriber.off(qr.created,y),l())};return await Promise.all([new Promise(b=>{l=b,this.subscriber.on(qr.created,y)}),new Promise(async b=>{o=await this.subscriber.subscribe(t,r),b()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await is(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(qr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await is(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(ci.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ll())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new li(new Tb(tb({sdkVersion:vE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Yc(t)){if(!t.method.endsWith(mE))return;const r=t.params,{topic:n,message:o,publishedAt:l}=r.data,y={topic:n,message:o,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(BE({type:"event",event:r.id},y)),this.events.emit(r.id,y),await this.acknowledgePayload(t),await this.onMessageEvent(y)}else Zc(t)&&this.events.emit(Wt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Wt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Xc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ci.payload,this.onPayloadHandler),this.provider.off(ci.connect,this.onConnectHandler),this.provider.off(ci.disconnect,this.onDisconnectHandler),this.provider.off(ci.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Ll();Sb(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(yE)))}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var WE=Object.defineProperty,Xl=Object.getOwnPropertySymbols,QE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,ef=(s,t,r)=>t in s?WE(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,tf=(s,t)=>{for(var r in t||(t={}))QE.call(t,r)&&ef(s,r,t[r]);if(Xl)for(var r of Xl(t))JE.call(t,r)&&ef(s,r,t[r]);return s};class za extends gw{constructor(t,r,n,o=xi,l=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=bE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(y=>{this.getKey&&y!==null&&!Oa(y)?this.map.set(this.getKey(y),y):wb(y)?this.map.set(y.id,y):bb(y)&&this.map.set(y.topic,y)}),this.cached=[],this.initialized=!0)},this.set=async(y,b)=>{this.isInitialized(),this.map.has(y)?await this.update(y,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:y,value:b}),this.map.set(y,b),await this.persist())},this.get=y=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:y}),this.getData(y)),this.getAll=y=>(this.isInitialized(),y?this.values.filter(b=>Object.keys(y).every(P=>Rb(b[P],y[P]))):this.values),this.update=async(y,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:y,update:b});const P=tf(tf({},this.getData(y)),b);this.map.set(y,P),await this.persist()},this.delete=async(y,b)=>{this.isInitialized(),this.map.has(y)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:y,reason:b}),this.map.delete(y),await this.persist())},this.logger=Ne.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=l}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}}class YE{constructor(t,r){this.core=t,this.logger=r,this.name=xE,this.version=PE,this.events=new Qc,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[bn],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Mc(),o=await this.core.crypto.setSymKey(n),l=Ea(ne.FIVE_MINUTES),y={protocol:ad},b={topic:o,expiry:l,relay:y,active:!1},P=pb({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:y});return await this.pairings.set(o,b),await this.core.relayer.subscribe(o),this.core.expirer.set(o,l),{topic:o,uri:P}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:l,relay:y}=jl(n.uri);let b;if(this.pairings.keys.includes(o)&&(b=this.pairings.get(o),b.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const P=Ea(ne.FIVE_MINUTES),_={topic:o,relay:y,expiry:P,active:!1};return await this.pairings.set(o,_),this.core.expirer.set(o,P),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Yn.create,_),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(l,o),await this.core.relayer.subscribe(o,{relay:y})),_},this.activate=async({topic:n})=>{this.isInitialized();const o=Ea(ne.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const l=await this.sendRequest(o,"wc_pairingPing",{}),{done:y,resolve:b,reject:P}=rb();this.events.once(_c("pairing_ping",l),({error:_})=>{_?P(_):b()}),await y()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Jn("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,l)=>{const y=es(o,l),b=await this.core.crypto.encode(n,y),P=Kn[o].req;return this.core.history.set(n,y),this.core.relayer.publish(n,b,P),y.id},this.sendResult=async(n,o,l)=>{const y=Xc(n,l),b=await this.core.crypto.encode(o,y),P=await this.core.history.get(o,n),_=Kn[P.request.method].res;await this.core.relayer.publish(o,b,_),await this.core.history.resolve(y)},this.sendError=async(n,o,l)=>{const y=Jc(n,l),b=await this.core.crypto.encode(o,y),P=await this.core.history.get(o,n),_=Kn[P.request.method]?Kn[P.request.method].res:Kn.unregistered_method.res;await this.core.relayer.publish(o,b,_),await this.core.history.resolve(y)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Jn("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Fl(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:l}=n;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(o,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,l);default:return this.onUnknownRpcMethodRequest(o,l)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:l}=n,y=(await this.core.history.get(o,l.id)).request.method;switch(y){case"wc_pairingPing":return this.onPairingPingResponse(o,l);default:return this.onUnknownRpcMethodResponse(y)}},this.onPairingPingRequest=async(n,o)=>{const{id:l}=o;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit(Yn.ping,{id:l,topic:n})}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onPairingPingResponse=(n,o)=>{const{id:l}=o;setTimeout(()=>{Si(o)?this.events.emit(_c("pairing_ping",l),{}):hi(o)&&this.events.emit(_c("pairing_ping",l),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:l}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:l,topic:n})}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:l,method:y}=o;try{if(this.registeredMethods.includes(y))return;const b=Jn("WC_METHOD_UNSUPPORTED",y);await this.sendError(l,n,b),this.logger.error(b)}catch(b){await this.sendError(l,n,b),this.logger.error(b)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Jn("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Ec(n)){const{message:y}=He("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(y)}if(!vb(n.uri)){const{message:y}=He("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(y)}const l=jl(n.uri);if(!((o=l==null?void 0:l.relay)!=null&&o.protocol)){const{message:y}=He("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(y)}if(!(l!=null&&l.symKey)){const{message:y}=He("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(y)}},this.isValidPing=async n=>{if(!Ec(n)){const{message:l}=He("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ec(n)){const{message:l}=He("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!Gf(n,!1)){const{message:o}=He("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=He("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Fl(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=He("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=Ne.generateChildLogger(r,this.name),this.pairings=new za(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ne.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{Yc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):Zc(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Tr.expired,async t=>{const{topic:r}=sb(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}let ZE=class extends lw{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qr.EventEmitter,this.name=OE,this.version=NE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:l}),this.records.has(o.id))return;const y={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:l,expiry:Ea(ne.THIRTY_DAYS)};this.records.set(y.id,y),this.events.emit(Wr.created,y)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=hi(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Wr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(l=>{if(l.topic===n){if(typeof o<"u"&&l.id!==o)return;this.records.delete(l.id),this.events.emit(Wr.deleted,l)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:es(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Wr.created,t=>{const r=Wr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.updated,t=>{const r=Wr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.deleted,t=>{const r=Wr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}},XE=class extends yw{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=AE,this.version=TE,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const l=this.formatTarget(n),y={target:l,expiry:o};this.expirations.set(l,y),this.checkExpiry(l,y),this.events.emit(Tr.created,{target:l,expiration:y})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),l=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Tr.deleted,{target:o,expiration:l})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ne.generateChildLogger(r,this.name)}get context(){return Ne.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return ib(t);if(typeof t=="number")return nb(t);const{message:r}=He("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Tr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=He("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=He("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;ne.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Tr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(wn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Tr.created,t=>{const r=Tr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Tr.expired,t=>{const r=Tr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Tr.deleted,t=>{const r=Tr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=He("NOT_INITIALIZED",this.name);throw new Error(t)}}};class eI extends vw{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=Sc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||_n()||!La())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Vc;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let l;try{l=await this.fetchAttestation(n.attestationId,o)}catch(y){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(y),l=await this.fetchAttestation(n.attestationId,Vc)}return l},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const l=this.startAbortTimer(ne.ONE_SECOND*2),y=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(l),y.status===200?await y.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(l=>{if(document.getElementById(Sc))return l();window.addEventListener("message",o);const y=document.createElement("iframe");y.id=Sc,y.src=`${this.verifyUrl}/${this.projectId}`,y.style.display="none",document.body.append(y),this.iframe=y,n=l}),new Promise((l,y)=>setTimeout(()=>{window.removeEventListener("message",o),y("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||yn;return CE.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${yn}`),o=yn),o},this.logger=Ne.generateChildLogger(r,this.name),this.verifyUrl=yn,this.abortController=new AbortController,this.isDevEnv=nu()&&{}.IS_VITEST}get context(){return Ne.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var tI=Object.defineProperty,rf=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,nf=(s,t,r)=>t in s?tI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,sf=(s,t)=>{for(var r in t||(t={}))rI.call(t,r)&&nf(s,r,t[r]);if(rf)for(var r of rf(t))iI.call(t,r)&&nf(s,r,t[r]);return s};let nI=class cd extends hw{constructor(t){super(t),this.protocol=sd,this.version=iE,this.name=su,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||od,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||nE.logger}));this.logger=Ne.generateChildLogger(r,this.name),this.heartbeat=new wn.HeartBeat,this.crypto=new $E(this,this.logger,t==null?void 0:t.keychain),this.history=new ZE(this,this.logger),this.expirer=new XE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new tw(sf(sf({},sE),t==null?void 0:t.storageOptions)),this.relayer=new GE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new YE(this,this.logger),this.verify=new eI(this.projectId||"",this.logger)}static async init(t){const r=new cd(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(_E,n),r}get context(){return Ne.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}};const sI=nI;var aI={},oI=s=>encodeURIComponent(s).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`);(function(s){const t=oI,r=$a,n=Ca,o=Ra,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function D(u){return Array.isArray(u)?u.sort():typeof u=="object"?D(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function q(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=D(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=q(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(aI);function ud(s,t){return s.includes(":")?[s]:t.chains||[]}const cI="base16",uI="utf8",hI=1;function Pc(s){const t=Da.hash(nr(s,uI));return Jt(t,cI)}const lI="ReactNative",vn={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function hd(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function fI(){return!Nf()&&!!Ua()&&navigator.product===lI}function au(){return!hd()&&!!Ua()}function dI(){return fI()?vn.reactNative:hd()?vn.node:au()?vn.browser:vn.unknown}function pI(){return fv()||{name:"",description:"",url:"",icons:[""]}}function Vi(s,t){return s.filter(r=>t.includes(r)).length===s.length}function Bn(s=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(s||ne.FIVE_MINUTES);let n,o,l;return{resolve:y=>{l&&n&&(clearTimeout(l),n(y))},reject:y=>{l&&o&&(clearTimeout(l),o(y))},done:()=>new Promise((y,b)=>{l=setTimeout(()=>{b(new Error(t))},r),n=y,o=b})}}function gI(s){const[t,r]=s.split(":"),n={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")n.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return n}function Ki(s,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(s))}function mn(s){return Date.now()>=ne.toMiliseconds(s)}function Kt(s,t){return`${s}${t?`:${t}`:""}`}async function mI({id:s,topic:t,wcDeepLink:r}){try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r;let o=n==null?void 0:n.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const l=`${o}/wc?requestId=${s}&sessionTopic=${t}`,y=dI();y===vn.browser?l.startsWith("https://")?window.open(l,"_blank","noreferrer noopener"):window.open(l,"_self","noreferrer noopener"):y===vn.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(l)}catch(n){console.error(n)}}async function yI(s,t){try{return await s.getItem(t)||(au()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}function En(s){const t=[];return s.forEach(r=>{const[n,o]=r.split(":");t.push(`${n}:${o}`)}),t}function vI(s){const t=[];return Object.values(s).forEach(r=>{t.push(...En(r.accounts))}),t}function wI(s,t){const r=[];return Object.values(s).forEach(n=>{En(n.accounts).includes(t)&&r.push(...n.methods)}),r}function bI(s,t){const r=[];return Object.values(s).forEach(n=>{En(n.accounts).includes(t)&&r.push(...n.events)}),r}function _I(s,t){const r=Sa(s,t);if(r)throw new Error(r.message);const n={};for(const[o,l]of Object.entries(s))n[o]={methods:l.methods,events:l.events,chains:l.accounts.map(y=>`${y.split(":")[0]}:${y.split(":")[1]}`)};return n}const EI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},II={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function fe(s,t){const{message:r,code:n}=II[s];return{message:t?`${r} ${t}`:r,code:n}}function br(s,t){const{message:r,code:n}=EI[s];return{message:t?`${r} ${t}`:r,code:n}}function Ha(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function ts(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}function Cr(s){return typeof s>"u"}function Qt(s,t){return t&&Cr(s)?!0:typeof s=="string"&&!!s.trim().length}function ou(s,t){return t&&Cr(s)?!0:typeof s=="number"&&!isNaN(s)}function SI(s,t){const{requiredNamespaces:r}=t,n=Object.keys(s.namespaces),o=Object.keys(r);let l=!0;return Vi(o,n)?(n.forEach(y=>{const{accounts:b,methods:P,events:_}=s.namespaces[y],E=En(b),O=r[y];(!Vi(ud(y,O),E)||!Vi(O.methods,P)||!Vi(O.events,_))&&(l=!1)}),l):!1}function Aa(s){return Qt(s,!1)&&s.includes(":")?s.split(":").length===2:!1}function xI(s){if(Qt(s,!1)&&s.includes(":")){const t=s.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Aa(r)}}return!1}function PI(s,t){let r=null;return Qt(s==null?void 0:s.publicKey,!1)||(r=fe("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function af(s){let t=!0;return Ha(s)?s.length&&(t=s.every(r=>Qt(r,!1))):t=!1,t}function OI(s,t,r){let n=null;return Ha(t)&&t.length?t.forEach(o=>{n||Aa(o)||(n=br("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):Aa(s)||(n=br("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function NI(s,t,r){let n=null;return Object.entries(s).forEach(([o,l])=>{if(n)return;const y=OI(o,ud(o,l),`${t} ${r}`);y&&(n=y)}),n}function AI(s,t){let r=null;return Ha(s)?s.forEach(n=>{r||xI(n)||(r=br("UNSUPPORTED_ACCOUNTS",`${t}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=br("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function TI(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const o=AI(n==null?void 0:n.accounts,`${t} namespace`);o&&(r=o)}),r}function CI(s,t){let r=null;return af(s==null?void 0:s.methods)?af(s==null?void 0:s.events)||(r=br("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=br("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function ld(s,t){let r=null;return Object.values(s).forEach(n=>{if(r)return;const o=CI(n,`${t}, namespace`);o&&(r=o)}),r}function RI(s,t,r){let n=null;if(s&&ts(s)){const o=ld(s,t);o&&(n=o);const l=NI(s,t,r);l&&(n=l)}else n=fe("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return n}function Sa(s,t){let r=null;if(s&&ts(s)){const n=ld(s,t);n&&(r=n);const o=TI(s,t);o&&(r=o)}else r=fe("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function fd(s){return Qt(s.protocol,!0)}function $I(s,t){let r=!1;return t&&!s?r=!0:s&&Ha(s)&&s.length&&s.forEach(n=>{r=fd(n)}),r}function FI(s){return typeof s=="number"}function Lr(s){return typeof s<"u"&&typeof s!==null}function DI(s){return!(!s||typeof s!="object"||!s.code||!ou(s.code,!1)||!s.message||!Qt(s.message,!1))}function UI(s){return!(Cr(s)||!Qt(s.method,!1))}function jI(s){return!(Cr(s)||Cr(s.result)&&Cr(s.error)||!ou(s.id,!1)||!Qt(s.jsonrpc,!1))}function LI(s){return!(Cr(s)||!Qt(s.name,!1))}function of(s,t){return!(!Aa(t)||!vI(s).includes(t))}function qI(s,t,r){return Qt(r,!1)?wI(s,t).includes(r):!1}function MI(s,t,r){return Qt(r,!1)?bI(s,t).includes(r):!1}function cf(s,t,r){let n=null;const o=zI(s),l=HI(t),y=Object.keys(o),b=Object.keys(l),P=uf(Object.keys(s)),_=uf(Object.keys(t)),E=P.filter(O=>!_.includes(O));return E.length&&(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${E.toString()}
      Received: ${Object.keys(t).toString()}`)),Vi(y,b)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${y.toString()}
      Approved: ${b.toString()}`)),Object.keys(t).forEach(O=>{if(!O.includes(":")||n)return;const D=En(t[O].accounts);D.includes(O)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${D.toString()}`))}),y.forEach(O=>{n||(Vi(o[O].methods,l[O].methods)?Vi(o[O].events,l[O].events)||(n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):n=fe("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),n}function zI(s){const t={};return Object.keys(s).forEach(r=>{var n;r.includes(":")?t[r]=s[r]:(n=s[r].chains)==null||n.forEach(o=>{t[o]={methods:s[r].methods,events:s[r].events}})}),t}function uf(s){return[...new Set(s.map(t=>t.includes(":")?t.split(":")[0]:t))]}function HI(s){const t={};return Object.keys(s).forEach(r=>{if(r.includes(":"))t[r]=s[r];else{const n=En(s[r].accounts);n==null||n.forEach(o=>{t[o]={accounts:s[r].accounts.filter(l=>l.includes(`${o}:`)),methods:s[r].methods,events:s[r].events}})}}),t}function kI(s,t){return ou(s,!1)&&s<=t.max&&s>=t.min}const Oc={};class ma{static get(t){return Oc[t]}static set(t,r){Oc[t]=r}static delete(t){delete Oc[t]}}const dd="wc",pd=2,gd="client",cu=`${dd}@${pd}:${gd}:`,Nc={name:gd,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},hf="WALLETCONNECT_DEEPLINK_CHOICE",KI="proposal",md="Proposal expired",VI="session",ya=ne.SEVEN_DAYS,BI="engine",Gn={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ac={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ui={idle:"IDLE",active:"ACTIVE"},GI="request",WI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var QI=Object.defineProperty,JI=Object.defineProperties,YI=Object.getOwnPropertyDescriptors,lf=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,XI=Object.prototype.propertyIsEnumerable,ff=(s,t,r)=>t in s?QI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,fr=(s,t)=>{for(var r in t||(t={}))ZI.call(t,r)&&ff(s,r,t[r]);if(lf)for(var r of lf(t))XI.call(t,r)&&ff(s,r,t[r]);return s},Wn=(s,t)=>JI(s,YI(t));class eS extends bw{constructor(t){super(t),this.name=BI,this.events=new Qc,this.initialized=!1,this.ignoredPayloadTypes=[hI],this.requestQueue={state:ui.idle,queue:[]},this.sessionRequestQueue={state:ui.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(fr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:l,optionalNamespaces:y,sessionProperties:b,relays:P}=n;let _=o,E,O=!1;if(_&&(O=this.client.core.pairing.pairings.get(_).active),!_||!O){const{topic:d,uri:m}=await this.client.core.pairing.create();_=d,E=m}const D=await this.client.core.crypto.generateKeyPair(),H=fr({requiredNamespaces:l,optionalNamespaces:y,relays:P??[{protocol:ad}],proposer:{publicKey:D,metadata:this.client.metadata}},b&&{sessionProperties:b}),{reject:q,resolve:W,done:ie}=Bn(ne.FIVE_MINUTES,md);if(this.events.once(Kt("session_connect"),async({error:d,session:m})=>{if(d)q(d);else if(m){m.self.publicKey=D;const g=Wn(fr({},m),{requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces});await this.client.session.set(m.topic,g),await this.setExpiry(m.topic,m.expiry),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:m.peer.metadata}),W(g)}}),!_){const{message:d}=fe("NO_MATCHING_KEY",`connect() pairing topic: ${_}`);throw new Error(d)}const ce=await this.sendRequest({topic:_,method:"wc_sessionPropose",params:H}),u=Ki(ne.FIVE_MINUTES);return await this.setProposal(ce,fr({id:ce,expiry:u},H)),{uri:E,approval:ie}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:l,sessionProperties:y}=r,b=this.client.proposal.get(n);let{pairingTopic:P,proposer:_,requiredNamespaces:E,optionalNamespaces:O}=b;P=P||"",ts(E)||(E=_I(l,"approve()"));const D=await this.client.core.crypto.generateKeyPair(),H=_.publicKey,q=await this.client.core.crypto.generateSharedKey(D,H);P&&n&&(await this.client.core.pairing.updateMetadata({topic:P,metadata:_.metadata}),await this.sendResult({id:n,topic:P,result:{relay:{protocol:o??"irn"},responderPublicKey:D}}),await this.client.proposal.delete(n,br("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:P}));const W=fr({relay:{protocol:o??"irn"},namespaces:l,requiredNamespaces:E,optionalNamespaces:O,pairingTopic:P,controller:{publicKey:D,metadata:this.client.metadata},expiry:Ki(ya)},y&&{sessionProperties:y});await this.client.core.relayer.subscribe(q),await this.sendRequest({topic:q,method:"wc_sessionSettle",params:W,throwOnFailedPublish:!0});const ie=Wn(fr({},W),{topic:q,pairingTopic:P,acknowledged:!1,self:W.controller,peer:{publicKey:_.publicKey,metadata:_.metadata},controller:D});return await this.client.session.set(q,ie),await this.setExpiry(q,Ki(ya)),{topic:q,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(q)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,o),await this.client.proposal.delete(n,br("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,l=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:y,resolve:b,reject:P}=Bn();return this.events.once(Kt("session_update",l),({error:_})=>{_?P(_):b()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:y}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:l,resolve:y,reject:b}=Bn();return this.events.once(Kt("session_extend",o),({error:P})=>{P?b(P):y()}),await this.setExpiry(n,Ki(ya)),{acknowledged:l}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:l,expiry:y}=r,b=wv(),{done:P,resolve:_,reject:E}=Bn(y,"Request expired. Please try again.");return this.events.once(Kt("session_request",b),({error:O,result:D})=>{O?E(O):_(D)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:b,topic:l,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:y,throwOnFailedPublish:!0}).catch(D=>E(D)),this.client.events.emit("session_request_sent",{topic:l,request:o,chainId:n,id:b}),O()}),new Promise(async O=>{const D=await yI(this.client.core.storage,hf);mI({id:b,topic:l,wcDeepLink:D}),O()}),P()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:l}=o;Si(o)?await this.sendResult({id:l,topic:n,result:o.result,throwOnFailedPublish:!0}):hi(o)&&await this.sendError(l,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:l,resolve:y,reject:b}=Bn();this.events.once(Kt("session_ping",o),({error:P})=>{P?b(P):y()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:l}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:l}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:br("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>SI(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(l=>{var y,b;return((y=l.peerMetadata)==null?void 0:y.url)&&((b=l.peerMetadata)==null?void 0:b.url)===r.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,br("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(hf).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,br("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==r),o&&(this.sessionRequestQueue.state=ui.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:o,topic:l,params:y,verifyContext:b}=r;await this.client.pendingRequest.set(o,{id:o,topic:l,params:y,verifyContext:b}),n&&this.client.core.expirer.set(o,Ki(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:l,expiry:y,relayRpcId:b,clientRpcId:P,throwOnFailedPublish:_}=r,E=es(o,l,P);if(au()&&WI.includes(o)){const H=Pc(JSON.stringify(E));this.client.core.verify.register({attestationId:H})}const O=await this.client.core.crypto.encode(n,E),D=Gn[o].req;return y&&(D.ttl=y),b&&(D.id=b),this.client.core.history.set(n,E),_?(D.internal=Wn(fr({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,O,D)):this.client.core.relayer.publish(n,O,D).catch(H=>this.client.logger.error(H)),E.id},this.sendResult=async r=>{const{id:n,topic:o,result:l,throwOnFailedPublish:y}=r,b=Xc(n,l),P=await this.client.core.crypto.encode(o,b),_=await this.client.core.history.get(o,n),E=Gn[_.request.method].res;y?(E.internal=Wn(fr({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,P,E)):this.client.core.relayer.publish(o,P,E).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(b)},this.sendError=async(r,n,o)=>{const l=Jc(r,o),y=await this.client.core.crypto.encode(n,l),b=await this.client.core.history.get(n,r),P=Gn[b.request.method].res;this.client.core.relayer.publish(n,y,P),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{mn(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{mn(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ui.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ui.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ui.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,l=o.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,l=(await this.client.core.history.get(n,o.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=fe("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:l}=n;try{this.isValidConnect(fr({},n.params));const y=Ki(ne.FIVE_MINUTES),b=fr({id:l,pairingTopic:r,expiry:y},o);await this.setProposal(l,b);const P=Pc(JSON.stringify(n)),_=await this.getVerifyContext(P,b.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:b,verifyContext:_})}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(Si(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const y=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:y});const b=y.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:b});const P=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:P});const _=await this.client.core.crypto.generateSharedKey(b,P);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:_});const E=await this.client.core.relayer.subscribe(_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:r})}else hi(n)&&(await this.client.proposal.delete(o,br("USER_DISCONNECTED")),this.events.emit(Kt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:y,controller:b,expiry:P,namespaces:_,requiredNamespaces:E,optionalNamespaces:O,sessionProperties:D,pairingTopic:H}=n.params,q=fr({topic:r,relay:y,expiry:P,namespaces:_,acknowledged:!0,pairingTopic:H,requiredNamespaces:E,optionalNamespaces:O,controller:b.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:b.publicKey,metadata:b.metadata}},D&&{sessionProperties:D});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Kt("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;Si(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Kt("session_approve",o),{})):hi(n)&&(await this.client.session.delete(r,br("USER_DISCONNECTED")),this.events.emit(Kt("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:l}=n;try{const y=`${r}_session_update`,b=ma.get(y);if(b&&this.isRequestOutOfSync(b,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(fr({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:l,topic:r,result:!0}),this.client.events.emit("session_update",{id:l,topic:r,params:o}),ma.set(y,l)}catch(y){await this.sendError(l,r,y),this.client.logger.error(y)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_update",o),{}):hi(n)&&this.events.emit(Kt("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ki(ya)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_extend",o),{}):hi(n)&&this.events.emit(Kt("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{Si(n)?this.events.emit(Kt("session_ping",o),{}):hi(n)&&this.events.emit(Kt("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Wt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:l}=n;try{this.isValidRequest(fr({topic:r},l));const y=Pc(JSON.stringify(es("wc_sessionRequest",l,o))),b=this.client.session.get(r),P=await this.getVerifyContext(y,b.peer.metadata),_={id:o,topic:r,params:l,verifyContext:P};await this.setPendingSessionRequest(_),this.addSessionRequestToSessionRequestQueue(_),this.processSessionRequestQueue()}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;Si(n)?this.events.emit(Kt("session_request",o),{result:n.result}):hi(n)&&this.events.emit(Kt("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:l}=n;try{const y=`${r}_session_event_${l.event.name}`,b=ma.get(y);if(b&&this.isRequestOutOfSync(b,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(fr({topic:r},l)),this.client.events.emit("session_event",{id:o,topic:r,params:l}),ma.set(y,o)}catch(y){await this.sendError(o,r,y),this.client.logger.error(y)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ui.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ui.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ui.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,es("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Lr(r)){const{message:P}=fe("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(P)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:l,sessionProperties:y,relays:b}=r;if(Cr(n)||await this.isValidPairingTopic(n),!$I(b,!0)){const{message:P}=fe("MISSING_OR_INVALID",`connect() relays: ${b}`);throw new Error(P)}!Cr(o)&&ts(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Cr(l)&&ts(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),Cr(y)||this.validateSessionProps(y,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=RI(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Lr(r))throw new Error(fe("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:l,sessionProperties:y}=r;await this.isValidProposalId(n);const b=this.client.proposal.get(n),P=Sa(o,"approve()");if(P)throw new Error(P.message);const _=cf(b.requiredNamespaces,o,"approve()");if(_)throw new Error(_.message);if(!Qt(l,!0)){const{message:E}=fe("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(E)}Cr(y)||this.validateSessionProps(y,"sessionProperties")},this.isValidReject=async r=>{if(!Lr(r)){const{message:l}=fe("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!DI(o)){const{message:l}=fe("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!Lr(r)){const{message:_}=fe("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(_)}const{relay:n,controller:o,namespaces:l,expiry:y}=r;if(!fd(n)){const{message:_}=fe("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(_)}const b=PI(o,"onSessionSettleRequest()");if(b)throw new Error(b.message);const P=Sa(l,"onSessionSettleRequest()");if(P)throw new Error(P.message);if(mn(y)){const{message:_}=fe("EXPIRED","onSessionSettleRequest()");throw new Error(_)}},this.isValidUpdate=async r=>{if(!Lr(r)){const{message:P}=fe("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(P)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const l=this.client.session.get(n),y=Sa(o,"update()");if(y)throw new Error(y.message);const b=cf(l.requiredNamespaces,o,"update()");if(b)throw new Error(b.message)},this.isValidExtend=async r=>{if(!Lr(r)){const{message:o}=fe("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Lr(r)){const{message:P}=fe("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(P)}const{topic:n,request:o,chainId:l,expiry:y}=r;await this.isValidSessionTopic(n);const{namespaces:b}=this.client.session.get(n);if(!of(b,l)){const{message:P}=fe("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(P)}if(!UI(o)){const{message:P}=fe("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(P)}if(!qI(b,l,o.method)){const{message:P}=fe("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(P)}if(y&&!kI(y,Ac)){const{message:P}=fe("MISSING_OR_INVALID",`request() expiry: ${y}. Expiry must be a number (in seconds) between ${Ac.min} and ${Ac.max}`);throw new Error(P)}},this.isValidRespond=async r=>{if(!Lr(r)){const{message:l}=fe("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:n,response:o}=r;if(await this.isValidSessionTopic(n),!jI(o)){const{message:l}=fe("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!Lr(r)){const{message:o}=fe("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Lr(r)){const{message:b}=fe("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(b)}const{topic:n,event:o,chainId:l}=r;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!of(y,l)){const{message:b}=fe("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(b)}if(!LI(o)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(b)}if(!MI(y,l,o.name)){const{message:b}=fe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(b)}},this.isValidDisconnect=async r=>{if(!Lr(r)){const{message:o}=fe("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||yn,validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});l&&(o.verified.origin=l.origin,o.verified.isScam=l.isScam,o.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!Qt(o,!1)){const{message:l}=fe("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:t}=fe("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{Yc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):Zc(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Tr.expired,async t=>{const{topic:r,id:n}=gI(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,fe("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=fe("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Qt(t,!1)){const{message:r}=fe("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=fe("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Qt(t,!1)){const{message:r}=fe("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=fe("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!FI(t)){const{message:r}=fe("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=fe("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(mn(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=fe("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class tS extends za{constructor(t,r){super(t,r,KI,cu),this.core=t,this.logger=r}}class rS extends za{constructor(t,r){super(t,r,VI,cu),this.core=t,this.logger=r}}class iS extends za{constructor(t,r){super(t,r,GI,cu,n=>n.id),this.core=t,this.logger=r}}let nS=class yd extends ww{constructor(t){super(t),this.protocol=dd,this.version=pd,this.name=Nc.name,this.events=new Qr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Nc.name,this.metadata=(t==null?void 0:t.metadata)||pI();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Nc.logger}));this.core=(t==null?void 0:t.core)||new sI(t),this.logger=Ne.generateChildLogger(r,this.name),this.session=new rS(this.core,this.logger),this.proposal=new tS(this.core,this.logger),this.pendingRequest=new iS(this.core,this.logger),this.engine=new eS(this)}static async init(t){const r=new yd(t);return await r.initialize(),r}get context(){return Ne.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};var sS={},aS=s=>encodeURIComponent(s).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`);(function(s){const t=aS,r=$a,n=Ca,o=Ra,l=u=>u==null,y=Symbol("encodeFragmentIdentifier");function b(u){switch(u.arrayFormat){case"index":return d=>(m,g)=>{const p=m.length;return g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[",p,"]"].join("")]:[...m,[E(d,u),"[",E(p,u),"]=",E(g,u)].join("")]};case"bracket":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),"[]"].join("")]:[...m,[E(d,u),"[]=",E(g,u)].join("")];case"colon-list-separator":return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,[E(d,u),":list="].join("")]:[...m,[E(d,u),":list=",E(g,u)].join("")];case"comma":case"separator":case"bracket-separator":{const d=u.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(g,p)=>p===void 0||u.skipNull&&p===null||u.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[E(m,u),d,E(p,u)].join("")]:[[g,E(p,u)].join(u.arrayFormatSeparator)])}default:return d=>(m,g)=>g===void 0||u.skipNull&&g===null||u.skipEmptyString&&g===""?m:g===null?[...m,E(d,u)]:[...m,[E(d,u),"=",E(g,u)].join("")]}}function P(u){let d;switch(u.arrayFormat){case"index":return(m,g,p)=>{if(d=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!d){p[m]=g;return}p[m]===void 0&&(p[m]={}),p[m][d[1]]=g};case"bracket":return(m,g,p)=>{if(d=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"colon-list-separator":return(m,g,p)=>{if(d=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!d){p[m]=g;return}if(p[m]===void 0){p[m]=[g];return}p[m]=[].concat(p[m],g)};case"comma":case"separator":return(m,g,p)=>{const N=typeof g=="string"&&g.includes(u.arrayFormatSeparator),x=typeof g=="string"&&!N&&O(g,u).includes(u.arrayFormatSeparator);g=x?O(g,u):g;const Q=N||x?g.split(u.arrayFormatSeparator).map(se=>O(se,u)):g===null?g:O(g,u);p[m]=Q};case"bracket-separator":return(m,g,p)=>{const N=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!N){p[m]=g&&O(g,u);return}const x=g===null?[]:g.split(u.arrayFormatSeparator).map(Q=>O(Q,u));if(p[m]===void 0){p[m]=x;return}p[m]=[].concat(p[m],x)};default:return(m,g,p)=>{if(p[m]===void 0){p[m]=g;return}p[m]=[].concat(p[m],g)}}}function _(u){if(typeof u!="string"||u.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(u,d){return d.encode?d.strict?t(u):encodeURIComponent(u):u}function O(u,d){return d.decode?r(u):u}function D(u){return Array.isArray(u)?u.sort():typeof u=="object"?D(Object.keys(u)).sort((d,m)=>Number(d)-Number(m)).map(d=>u[d]):u}function H(u){const d=u.indexOf("#");return d!==-1&&(u=u.slice(0,d)),u}function q(u){let d="";const m=u.indexOf("#");return m!==-1&&(d=u.slice(m)),d}function W(u){u=H(u);const d=u.indexOf("?");return d===-1?"":u.slice(d+1)}function ie(u,d){return d.parseNumbers&&!Number.isNaN(Number(u))&&typeof u=="string"&&u.trim()!==""?u=Number(u):d.parseBooleans&&u!==null&&(u.toLowerCase()==="true"||u.toLowerCase()==="false")&&(u=u.toLowerCase()==="true"),u}function ce(u,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const m=P(d),g=Object.create(null);if(typeof u!="string"||(u=u.trim().replace(/^[?#&]/,""),!u))return g;for(const p of u.split("&")){if(p==="")continue;let[N,x]=n(d.decode?p.replace(/\+/g," "):p,"=");x=x===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?x:O(x,d),m(O(N,d),x,g)}for(const p of Object.keys(g)){const N=g[p];if(typeof N=="object"&&N!==null)for(const x of Object.keys(N))N[x]=ie(N[x],d);else g[p]=ie(N,d)}return d.sort===!1?g:(d.sort===!0?Object.keys(g).sort():Object.keys(g).sort(d.sort)).reduce((p,N)=>{const x=g[N];return x&&typeof x=="object"&&!Array.isArray(x)?p[N]=D(x):p[N]=x,p},Object.create(null))}s.extract=W,s.parse=ce,s.stringify=(u,d)=>{if(!u)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const m=x=>d.skipNull&&l(u[x])||d.skipEmptyString&&u[x]==="",g=b(d),p={};for(const x of Object.keys(u))m(x)||(p[x]=u[x]);const N=Object.keys(p);return d.sort!==!1&&N.sort(d.sort),N.map(x=>{const Q=u[x];return Q===void 0?"":Q===null?E(x,d):Array.isArray(Q)?Q.length===0&&d.arrayFormat==="bracket-separator"?E(x,d)+"[]":Q.reduce(g(x),[]).join("&"):E(x,d)+"="+E(Q,d)}).filter(x=>x.length>0).join("&")},s.parseUrl=(u,d)=>{d=Object.assign({decode:!0},d);const[m,g]=n(u,"#");return Object.assign({url:m.split("?")[0]||"",query:ce(W(u),d)},d&&d.parseFragmentIdentifier&&g?{fragmentIdentifier:O(g,d)}:{})},s.stringifyUrl=(u,d)=>{d=Object.assign({encode:!0,strict:!0,[y]:!0},d);const m=H(u.url).split("?")[0]||"",g=s.extract(u.url),p=s.parse(g,{sort:!1}),N=Object.assign(p,u.query);let x=s.stringify(N,d);x&&(x=`?${x}`);let Q=q(u.url);return u.fragmentIdentifier&&(Q=`#${d[y]?E(u.fragmentIdentifier,d):u.fragmentIdentifier}`),`${m}${x}${Q}`},s.pick=(u,d,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[y]:!1},m);const{url:g,query:p,fragmentIdentifier:N}=s.parseUrl(u,m);return s.stringifyUrl({url:g,query:o(p,d),fragmentIdentifier:N},m)},s.exclude=(u,d,m)=>{const g=Array.isArray(d)?p=>!d.includes(p):(p,N)=>!d(p,N);return s.pick(u,g,m)}})(sS);const oS=":";function cS(s){const[t,r]=s.split(oS);return{namespace:t,reference:r}}function Tc(s=[],t=[]){return[...new Set([...s,...t])]}function uu(s){return s.includes(":")}function Zn(s){return uu(s)?s.split(":")[0]:s}const uS={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function df(s,t){const{message:r,code:n}=uS[s];return{message:t?`${r} ${t}`:r,code:n}}function pf(s,t){return Array.isArray(s)?typeof t<"u"&&s.length?s.every(t):!0:!1}function hS(s){return Object.getPrototypeOf(s)===Object.prototype&&Object.keys(s).length}const gf="error",lS="wss://relay.walletconnect.com",fS="wc",dS="universal_provider",mf=`${fS}@2:${dS}:`,pS="https://rpc.walletconnect.com/v1/",fi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",y="Expected a function",b="Invalid `variable` option passed into `_.template`",P="__lodash_hash_undefined__",_=500,E="__lodash_placeholder__",O=1,D=2,H=4,q=1,W=2,ie=1,ce=2,u=4,d=8,m=16,g=32,p=64,N=128,x=256,Q=512,se=30,Ee="...",Ae=800,tt=16,j=1,V=2,qe=3,Te=1/0,ee=9007199254740991,Y=17976931348623157e292,J=0/0,Z=4294967295,ht=Z-1,ke=Z>>>1,zr=[["ary",N],["bind",ie],["bindKey",ce],["curry",d],["curryRight",m],["flip",Q],["partial",g],["partialRight",p],["rearg",x]],be="[object Arguments]",St="[object Array]",M="[object AsyncFunction]",L="[object Boolean]",F="[object Date]",h="[object DOMException]",T="[object Error]",ae="[object Function]",de="[object GeneratorFunction]",ve="[object Map]",Ce="[object Number]",$e="[object Null]",Se="[object Object]",xt="[object Promise]",wt="[object Proxy]",at="[object RegExp]",De="[object Set]",Je="[object String]",Ye="[object Symbol]",ot="[object Undefined]",Me="[object WeakMap]",Ze="[object WeakSet]",Re="[object ArrayBuffer]",Ke="[object DataView]",lt="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",Ft="[object Int16Array]",zt="[object Int32Array]",Ht="[object Uint8Array]",jt="[object Uint8ClampedArray]",Yt="[object Uint16Array]",ar="[object Uint32Array]",Hr=/\b__p \+= '';/g,Zt=/\b(__p \+=) '' \+/g,Jr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,ft=RegExp(di.source),rt=RegExp(Ni.source),dt=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ct=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(gt.source),mt=/^\s+/,bt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qe=/\{\n\/\* \[wrapped with (.+)\] \*/,Tt=/,? & /,Ct=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ka=/[()=,{}\[\]\/\s]/,Ka=/\\(\\)?/g,Va=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_r=/\w*$/,Ba=/^[-+]0x[0-9a-f]+$/i,Ga=/^0b[01]+$/i,Wa=/^\[object .+?Constructor\]$/,Qa=/^0o[0-7]+$/i,Ja=/^(?:0|[1-9]\d*)$/,Yr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qi=/($^)/,Ya=/['\n\r\u2028\u2029\\]/g,Ji="\\ud800-\\udfff",Za="\\u0300-\\u036f",Xa="\\ufe20-\\ufe2f",Yi="\\u20d0-\\u20ff",us=Za+Xa+Yi,hs="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",eo="\\xac\\xb1\\xd7\\xf7",to="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ro="\\u2000-\\u206f",io=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ls="A-Z\\xc0-\\xd6\\xd8-\\xde",fs="\\ufe0e\\ufe0f",Ai=eo+to+ro+io,In="[']",Ti="["+Ji+"]",Sn="["+Ai+"]",Ci="["+us+"]",ds="\\d+",no="["+hs+"]",ps="["+Rr+"]",gs="[^"+Ji+Ai+ds+hs+Rr+ls+"]",Zi="\\ud83c[\\udffb-\\udfff]",so="(?:"+Ci+"|"+Zi+")",ms="[^"+Ji+"]",Xi="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",pr="["+ls+"]",ys="\\u200d",vs="(?:"+ps+"|"+gs+")",kr="(?:"+pr+"|"+gs+")",ws="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",bs="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",_s=so+"?",Es="["+fs+"]?",ao="(?:"+ys+"(?:"+[ms,Xi,pi].join("|")+")"+Es+_s+")*",Zr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Is="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ss=Es+_s+ao,en="(?:"+[no,Xi,pi].join("|")+")"+Ss,oo="(?:"+[ms+Ci+"?",Ci,Xi,pi,Ti].join("|")+")",xn=RegExp(In,"g"),co=RegExp(Ci,"g"),tn=RegExp(Zi+"(?="+Zi+")|"+oo+Ss,"g"),xs=RegExp([pr+"?"+ps+"+"+ws+"(?="+[Sn,pr,"$"].join("|")+")",kr+"+"+bs+"(?="+[Sn,pr+vs,"$"].join("|")+")",pr+"?"+vs+"+"+ws,pr+"+"+bs,Is,Zr,ds,en].join("|"),"g"),Ps=RegExp("["+ys+Ji+us+fs+"]"),Ri=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Os=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],uo=-1,Ve={};Ve[lt]=Ve[je]=Ve[Pt]=Ve[Ft]=Ve[zt]=Ve[Ht]=Ve[jt]=Ve[Yt]=Ve[ar]=!0,Ve[be]=Ve[St]=Ve[Re]=Ve[L]=Ve[Ke]=Ve[F]=Ve[T]=Ve[ae]=Ve[ve]=Ve[Ce]=Ve[Se]=Ve[at]=Ve[De]=Ve[Je]=Ve[Me]=!1;var ze={};ze[be]=ze[St]=ze[Re]=ze[Ke]=ze[L]=ze[F]=ze[lt]=ze[je]=ze[Pt]=ze[Ft]=ze[zt]=ze[ve]=ze[Ce]=ze[Se]=ze[at]=ze[De]=ze[Je]=ze[Ye]=ze[Ht]=ze[jt]=ze[Yt]=ze[ar]=!0,ze[T]=ze[ae]=ze[Me]=!1;var I={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,ge=parseInt,Xe=typeof Qn=="object"&&Qn&&Qn.Object===Object&&Qn,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Rt||Function("return this")(),Ge=t&&!t.nodeType&&t,_t=Ge&&!0&&s&&!s.nodeType&&s,or=_t&&_t.exports===Ge,$t=or&&Xe.process,et=function(){try{var R=_t&&_t.require&&_t.require("util").types;return R||$t&&$t.binding&&$t.binding("util")}catch{}}(),Xt=et&&et.isArrayBuffer,$r=et&&et.isDate,Er=et&&et.isMap,Kr=et&&et.isRegExp,Pn=et&&et.isSet,$i=et&&et.isTypedArray;function Lt(R,z,U){switch(U.length){case 0:return R.call(z);case 1:return R.call(z,U[0]);case 2:return R.call(z,U[0],U[1]);case 3:return R.call(z,U[0],U[1],U[2])}return R.apply(z,U)}function bd(R,z,U,re){for(var pe=-1,Fe=R==null?0:R.length;++pe<Fe;){var Dt=R[pe];z(re,Dt,U(Dt),R)}return re}function Ir(R,z){for(var U=-1,re=R==null?0:R.length;++U<re&&z(R[U],U,R)!==!1;);return R}function _d(R,z){for(var U=R==null?0:R.length;U--&&z(R[U],U,R)!==!1;);return R}function fu(R,z){for(var U=-1,re=R==null?0:R.length;++U<re;)if(!z(R[U],U,R))return!1;return!0}function gi(R,z){for(var U=-1,re=R==null?0:R.length,pe=0,Fe=[];++U<re;){var Dt=R[U];z(Dt,U,R)&&(Fe[pe++]=Dt)}return Fe}function Ns(R,z){var U=R==null?0:R.length;return!!U&&rn(R,z,0)>-1}function ho(R,z,U){for(var re=-1,pe=R==null?0:R.length;++re<pe;)if(U(z,R[re]))return!0;return!1}function nt(R,z){for(var U=-1,re=R==null?0:R.length,pe=Array(re);++U<re;)pe[U]=z(R[U],U,R);return pe}function mi(R,z){for(var U=-1,re=z.length,pe=R.length;++U<re;)R[pe+U]=z[U];return R}function lo(R,z,U,re){var pe=-1,Fe=R==null?0:R.length;for(re&&Fe&&(U=R[++pe]);++pe<Fe;)U=z(U,R[pe],pe,R);return U}function Ed(R,z,U,re){var pe=R==null?0:R.length;for(re&&pe&&(U=R[--pe]);pe--;)U=z(U,R[pe],pe,R);return U}function fo(R,z){for(var U=-1,re=R==null?0:R.length;++U<re;)if(z(R[U],U,R))return!0;return!1}var Id=po("length");function Sd(R){return R.split("")}function xd(R){return R.match(Ct)||[]}function du(R,z,U){var re;return U(R,function(pe,Fe,Dt){if(z(pe,Fe,Dt))return re=Fe,!1}),re}function As(R,z,U,re){for(var pe=R.length,Fe=U+(re?1:-1);re?Fe--:++Fe<pe;)if(z(R[Fe],Fe,R))return Fe;return-1}function rn(R,z,U){return z===z?jd(R,z,U):As(R,pu,U)}function Pd(R,z,U,re){for(var pe=U-1,Fe=R.length;++pe<Fe;)if(re(R[pe],z))return pe;return-1}function pu(R){return R!==R}function gu(R,z){var U=R==null?0:R.length;return U?mo(R,z)/U:J}function po(R){return function(z){return z==null?r:z[R]}}function go(R){return function(z){return R==null?r:R[z]}}function mu(R,z,U,re,pe){return pe(R,function(Fe,Dt,We){U=re?(re=!1,Fe):z(U,Fe,Dt,We)}),U}function Od(R,z){var U=R.length;for(R.sort(z);U--;)R[U]=R[U].value;return R}function mo(R,z){for(var U,re=-1,pe=R.length;++re<pe;){var Fe=z(R[re]);Fe!==r&&(U=U===r?Fe:U+Fe)}return U}function yo(R,z){for(var U=-1,re=Array(R);++U<R;)re[U]=z(U);return re}function Nd(R,z){return nt(z,function(U){return[U,R[U]]})}function yu(R){return R&&R.slice(0,_u(R)+1).replace(mt,"")}function gr(R){return function(z){return R(z)}}function vo(R,z){return nt(z,function(U){return R[U]})}function On(R,z){return R.has(z)}function vu(R,z){for(var U=-1,re=R.length;++U<re&&rn(z,R[U],0)>-1;);return U}function wu(R,z){for(var U=R.length;U--&&rn(z,R[U],0)>-1;);return U}function Ad(R,z){for(var U=R.length,re=0;U--;)R[U]===z&&++re;return re}var Td=go(I),Cd=go(C);function Rd(R){return"\\"+te[R]}function $d(R,z){return R==null?r:R[z]}function nn(R){return Ps.test(R)}function Fd(R){return Ri.test(R)}function Dd(R){for(var z,U=[];!(z=R.next()).done;)U.push(z.value);return U}function wo(R){var z=-1,U=Array(R.size);return R.forEach(function(re,pe){U[++z]=[pe,re]}),U}function bu(R,z){return function(U){return R(z(U))}}function yi(R,z){for(var U=-1,re=R.length,pe=0,Fe=[];++U<re;){var Dt=R[U];(Dt===z||Dt===E)&&(R[U]=E,Fe[pe++]=U)}return Fe}function Ts(R){var z=-1,U=Array(R.size);return R.forEach(function(re){U[++z]=re}),U}function Ud(R){var z=-1,U=Array(R.size);return R.forEach(function(re){U[++z]=[re,re]}),U}function jd(R,z,U){for(var re=U-1,pe=R.length;++re<pe;)if(R[re]===z)return re;return-1}function Ld(R,z,U){for(var re=U+1;re--;)if(R[re]===z)return re;return re}function sn(R){return nn(R)?Md(R):Id(R)}function Fr(R){return nn(R)?zd(R):Sd(R)}function _u(R){for(var z=R.length;z--&&bt.test(R.charAt(z)););return z}var qd=go(B);function Md(R){for(var z=tn.lastIndex=0;tn.test(R);)++z;return z}function zd(R){return R.match(tn)||[]}function Hd(R){return R.match(xs)||[]}var kd=function R(z){z=z==null?Pe:an.defaults(Pe.Object(),z,an.pick(Pe,Os));var U=z.Array,re=z.Date,pe=z.Error,Fe=z.Function,Dt=z.Math,We=z.Object,bo=z.RegExp,Kd=z.String,Sr=z.TypeError,Cs=U.prototype,Vd=Fe.prototype,on=We.prototype,Rs=z["__core-js_shared__"],$s=Vd.toString,Le=on.hasOwnProperty,Bd=0,Eu=function(){var e=/[^.]+$/.exec(Rs&&Rs.keys&&Rs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Fs=on.toString,Gd=$s.call(We),Wd=Pe._,Qd=bo("^"+$s.call(Le).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ds=or?z.Buffer:r,vi=z.Symbol,Us=z.Uint8Array,Iu=Ds?Ds.allocUnsafe:r,js=bu(We.getPrototypeOf,We),Su=We.create,xu=on.propertyIsEnumerable,Ls=Cs.splice,Pu=vi?vi.isConcatSpreadable:r,Nn=vi?vi.iterator:r,Fi=vi?vi.toStringTag:r,qs=function(){try{var e=qi(We,"defineProperty");return e({},"",{}),e}catch{}}(),Jd=z.clearTimeout!==Pe.clearTimeout&&z.clearTimeout,Yd=re&&re.now!==Pe.Date.now&&re.now,Zd=z.setTimeout!==Pe.setTimeout&&z.setTimeout,Ms=Dt.ceil,zs=Dt.floor,_o=We.getOwnPropertySymbols,Xd=Ds?Ds.isBuffer:r,Ou=z.isFinite,ep=Cs.join,tp=bu(We.keys,We),Ut=Dt.max,Bt=Dt.min,rp=re.now,ip=z.parseInt,Nu=Dt.random,np=Cs.reverse,Eo=qi(z,"DataView"),An=qi(z,"Map"),Io=qi(z,"Promise"),cn=qi(z,"Set"),Tn=qi(z,"WeakMap"),Cn=qi(We,"create"),Hs=Tn&&new Tn,un={},sp=Mi(Eo),ap=Mi(An),op=Mi(Io),cp=Mi(cn),up=Mi(Tn),ks=vi?vi.prototype:r,Rn=ks?ks.valueOf:r,Au=ks?ks.toString:r;function v(e){if(vt(e)&&!me(e)&&!(e instanceof xe)){if(e instanceof xr)return e;if(Le.call(e,"__wrapped__"))return Th(e)}return new xr(e)}var hn=function(){function e(){}return function(i){if(!ut(i))return{};if(Su)return Su(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ks(){}function xr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}v.templateSettings={escape:dt,evaluate:pt,interpolate:ct,variable:"",imports:{_:v}},v.prototype=Ks.prototype,v.prototype.constructor=v,xr.prototype=hn(Ks.prototype),xr.prototype.constructor=xr;function xe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function hp(){var e=new xe(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function lp(){if(this.__filtered__){var e=new xe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function fp(){var e=this.__wrapped__.value(),i=this.__dir__,a=me(e),c=i<0,f=a?e.length:0,w=Sg(0,f,this.__views__),S=w.start,A=w.end,$=A-S,k=c?A:S-1,K=this.__iteratees__,G=K.length,X=0,oe=Bt($,this.__takeCount__);if(!a||!c&&f==$&&oe==$)return Xu(e,this.__actions__);var he=[];e:for(;$--&&X<oe;){k+=i;for(var we=-1,le=e[k];++we<G;){var Ie=K[we],Oe=Ie.iteratee,vr=Ie.type,rr=Oe(le);if(vr==V)le=rr;else if(!rr){if(vr==j)continue e;break e}}he[X++]=le}return he}xe.prototype=hn(Ks.prototype),xe.prototype.constructor=xe;function Di(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function dp(){this.__data__=Cn?Cn(null):{},this.size=0}function pp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function gp(e){var i=this.__data__;if(Cn){var a=i[e];return a===P?r:a}return Le.call(i,e)?i[e]:r}function mp(e){var i=this.__data__;return Cn?i[e]!==r:Le.call(i,e)}function yp(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Cn&&i===r?P:i,this}Di.prototype.clear=dp,Di.prototype.delete=pp,Di.prototype.get=gp,Di.prototype.has=mp,Di.prototype.set=yp;function Xr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function vp(){this.__data__=[],this.size=0}function wp(e){var i=this.__data__,a=Vs(i,e);if(a<0)return!1;var c=i.length-1;return a==c?i.pop():Ls.call(i,a,1),--this.size,!0}function bp(e){var i=this.__data__,a=Vs(i,e);return a<0?r:i[a][1]}function _p(e){return Vs(this.__data__,e)>-1}function Ep(e,i){var a=this.__data__,c=Vs(a,e);return c<0?(++this.size,a.push([e,i])):a[c][1]=i,this}Xr.prototype.clear=vp,Xr.prototype.delete=wp,Xr.prototype.get=bp,Xr.prototype.has=_p,Xr.prototype.set=Ep;function ei(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var c=e[i];this.set(c[0],c[1])}}function Ip(){this.size=0,this.__data__={hash:new Di,map:new(An||Xr),string:new Di}}function Sp(e){var i=ia(this,e).delete(e);return this.size-=i?1:0,i}function xp(e){return ia(this,e).get(e)}function Pp(e){return ia(this,e).has(e)}function Op(e,i){var a=ia(this,e),c=a.size;return a.set(e,i),this.size+=a.size==c?0:1,this}ei.prototype.clear=Ip,ei.prototype.delete=Sp,ei.prototype.get=xp,ei.prototype.has=Pp,ei.prototype.set=Op;function Ui(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new ei;++i<a;)this.add(e[i])}function Np(e){return this.__data__.set(e,P),this}function Ap(e){return this.__data__.has(e)}Ui.prototype.add=Ui.prototype.push=Np,Ui.prototype.has=Ap;function Dr(e){var i=this.__data__=new Xr(e);this.size=i.size}function Tp(){this.__data__=new Xr,this.size=0}function Cp(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function Rp(e){return this.__data__.get(e)}function $p(e){return this.__data__.has(e)}function Fp(e,i){var a=this.__data__;if(a instanceof Xr){var c=a.__data__;if(!An||c.length<o-1)return c.push([e,i]),this.size=++a.size,this;a=this.__data__=new ei(c)}return a.set(e,i),this.size=a.size,this}Dr.prototype.clear=Tp,Dr.prototype.delete=Cp,Dr.prototype.get=Rp,Dr.prototype.has=$p,Dr.prototype.set=Fp;function Tu(e,i){var a=me(e),c=!a&&zi(e),f=!a&&!c&&Ii(e),w=!a&&!c&&!f&&pn(e),S=a||c||f||w,A=S?yo(e.length,Kd):[],$=A.length;for(var k in e)(i||Le.call(e,k))&&!(S&&(k=="length"||f&&(k=="offset"||k=="parent")||w&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||ni(k,$)))&&A.push(k);return A}function Cu(e){var i=e.length;return i?e[Fo(0,i-1)]:r}function Dp(e,i){return na(cr(e),ji(i,0,e.length))}function Up(e){return na(cr(e))}function So(e,i,a){(a!==r&&!Ur(e[i],a)||a===r&&!(i in e))&&ti(e,i,a)}function $n(e,i,a){var c=e[i];(!(Le.call(e,i)&&Ur(c,a))||a===r&&!(i in e))&&ti(e,i,a)}function Vs(e,i){for(var a=e.length;a--;)if(Ur(e[a][0],i))return a;return-1}function jp(e,i,a,c){return wi(e,function(f,w,S){i(c,f,a(f),S)}),c}function Ru(e,i){return e&&Br(i,qt(i),e)}function Lp(e,i){return e&&Br(i,hr(i),e)}function ti(e,i,a){i=="__proto__"&&qs?qs(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function xo(e,i){for(var a=-1,c=i.length,f=U(c),w=e==null;++a<c;)f[a]=w?r:sc(e,i[a]);return f}function ji(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Pr(e,i,a,c,f,w){var S,A=i&O,$=i&D,k=i&H;if(a&&(S=f?a(e,c,f,w):a(e)),S!==r)return S;if(!ut(e))return e;var K=me(e);if(K){if(S=Pg(e),!A)return cr(e,S)}else{var G=Gt(e),X=G==ae||G==de;if(Ii(e))return rh(e,A);if(G==Se||G==be||X&&!f){if(S=$||X?{}:_h(e),!A)return $?gg(e,Lp(S,e)):pg(e,Ru(S,e))}else{if(!ze[G])return f?e:{};S=Og(e,G,A)}}w||(w=new Dr);var oe=w.get(e);if(oe)return oe;w.set(e,S),Jh(e)?e.forEach(function(le){S.add(Pr(le,i,a,le,e,w))}):Wh(e)&&e.forEach(function(le,Ie){S.set(Ie,Pr(le,i,a,Ie,e,w))});var he=k?$?Vo:Ko:$?hr:qt,we=K?r:he(e);return Ir(we||e,function(le,Ie){we&&(Ie=le,le=e[Ie]),$n(S,Ie,Pr(le,i,a,Ie,e,w))}),S}function qp(e){var i=qt(e);return function(a){return $u(a,e,i)}}function $u(e,i,a){var c=a.length;if(e==null)return!c;for(e=We(e);c--;){var f=a[c],w=i[f],S=e[f];if(S===r&&!(f in e)||!w(S))return!1}return!0}function Fu(e,i,a){if(typeof e!="function")throw new Sr(y);return Mn(function(){e.apply(r,a)},i)}function Fn(e,i,a,c){var f=-1,w=Ns,S=!0,A=e.length,$=[],k=i.length;if(!A)return $;a&&(i=nt(i,gr(a))),c?(w=ho,S=!1):i.length>=o&&(w=On,S=!1,i=new Ui(i));e:for(;++f<A;){var K=e[f],G=a==null?K:a(K);if(K=c||K!==0?K:0,S&&G===G){for(var X=k;X--;)if(i[X]===G)continue e;$.push(K)}else w(i,G,c)||$.push(K)}return $}var wi=oh(Vr),Du=oh(Oo,!0);function Mp(e,i){var a=!0;return wi(e,function(c,f,w){return a=!!i(c,f,w),a}),a}function Bs(e,i,a){for(var c=-1,f=e.length;++c<f;){var w=e[c],S=i(w);if(S!=null&&(A===r?S===S&&!yr(S):a(S,A)))var A=S,$=w}return $}function zp(e,i,a,c){var f=e.length;for(a=ye(a),a<0&&(a=-a>f?0:f+a),c=c===r||c>f?f:ye(c),c<0&&(c+=f),c=a>c?0:Zh(c);a<c;)e[a++]=i;return e}function Uu(e,i){var a=[];return wi(e,function(c,f,w){i(c,f,w)&&a.push(c)}),a}function kt(e,i,a,c,f){var w=-1,S=e.length;for(a||(a=Ag),f||(f=[]);++w<S;){var A=e[w];i>0&&a(A)?i>1?kt(A,i-1,a,c,f):mi(f,A):c||(f[f.length]=A)}return f}var Po=ch(),ju=ch(!0);function Vr(e,i){return e&&Po(e,i,qt)}function Oo(e,i){return e&&ju(e,i,qt)}function Gs(e,i){return gi(i,function(a){return si(e[a])})}function Li(e,i){i=_i(i,e);for(var a=0,c=i.length;e!=null&&a<c;)e=e[Gr(i[a++])];return a&&a==c?e:r}function Lu(e,i,a){var c=i(e);return me(e)?c:mi(c,a(e))}function er(e){return e==null?e===r?ot:$e:Fi&&Fi in We(e)?Ig(e):Ug(e)}function No(e,i){return e>i}function Hp(e,i){return e!=null&&Le.call(e,i)}function kp(e,i){return e!=null&&i in We(e)}function Kp(e,i,a){return e>=Bt(i,a)&&e<Ut(i,a)}function Ao(e,i,a){for(var c=a?ho:Ns,f=e[0].length,w=e.length,S=w,A=U(w),$=1/0,k=[];S--;){var K=e[S];S&&i&&(K=nt(K,gr(i))),$=Bt(K.length,$),A[S]=!a&&(i||f>=120&&K.length>=120)?new Ui(S&&K):r}K=e[0];var G=-1,X=A[0];e:for(;++G<f&&k.length<$;){var oe=K[G],he=i?i(oe):oe;if(oe=a||oe!==0?oe:0,!(X?On(X,he):c(k,he,a))){for(S=w;--S;){var we=A[S];if(!(we?On(we,he):c(e[S],he,a)))continue e}X&&X.push(he),k.push(oe)}}return k}function Vp(e,i,a,c){return Vr(e,function(f,w,S){i(c,a(f),w,S)}),c}function Dn(e,i,a){i=_i(i,e),e=xh(e,i);var c=e==null?e:e[Gr(Nr(i))];return c==null?r:Lt(c,e,a)}function qu(e){return vt(e)&&er(e)==be}function Bp(e){return vt(e)&&er(e)==Re}function Gp(e){return vt(e)&&er(e)==F}function Un(e,i,a,c,f){return e===i?!0:e==null||i==null||!vt(e)&&!vt(i)?e!==e&&i!==i:Wp(e,i,a,c,Un,f)}function Wp(e,i,a,c,f,w){var S=me(e),A=me(i),$=S?St:Gt(e),k=A?St:Gt(i);$=$==be?Se:$,k=k==be?Se:k;var K=$==Se,G=k==Se,X=$==k;if(X&&Ii(e)){if(!Ii(i))return!1;S=!0,K=!1}if(X&&!K)return w||(w=new Dr),S||pn(e)?vh(e,i,a,c,f,w):_g(e,i,$,a,c,f,w);if(!(a&q)){var oe=K&&Le.call(e,"__wrapped__"),he=G&&Le.call(i,"__wrapped__");if(oe||he){var we=oe?e.value():e,le=he?i.value():i;return w||(w=new Dr),f(we,le,a,c,w)}}return X?(w||(w=new Dr),Eg(e,i,a,c,f,w)):!1}function Qp(e){return vt(e)&&Gt(e)==ve}function To(e,i,a,c){var f=a.length,w=f,S=!c;if(e==null)return!w;for(e=We(e);f--;){var A=a[f];if(S&&A[2]?A[1]!==e[A[0]]:!(A[0]in e))return!1}for(;++f<w;){A=a[f];var $=A[0],k=e[$],K=A[1];if(S&&A[2]){if(k===r&&!($ in e))return!1}else{var G=new Dr;if(c)var X=c(k,K,$,e,i,G);if(!(X===r?Un(K,k,q|W,c,G):X))return!1}}return!0}function Mu(e){if(!ut(e)||Cg(e))return!1;var i=si(e)?Qd:Wa;return i.test(Mi(e))}function Jp(e){return vt(e)&&er(e)==at}function Yp(e){return vt(e)&&Gt(e)==De}function Zp(e){return vt(e)&&ha(e.length)&&!!Ve[er(e)]}function zu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?me(e)?Ku(e[0],e[1]):ku(e):ul(e)}function Co(e){if(!qn(e))return tp(e);var i=[];for(var a in We(e))Le.call(e,a)&&a!="constructor"&&i.push(a);return i}function Xp(e){if(!ut(e))return Dg(e);var i=qn(e),a=[];for(var c in e)c=="constructor"&&(i||!Le.call(e,c))||a.push(c);return a}function Ro(e,i){return e<i}function Hu(e,i){var a=-1,c=ur(e)?U(e.length):[];return wi(e,function(f,w,S){c[++a]=i(f,w,S)}),c}function ku(e){var i=Go(e);return i.length==1&&i[0][2]?Ih(i[0][0],i[0][1]):function(a){return a===e||To(a,e,i)}}function Ku(e,i){return Qo(e)&&Eh(i)?Ih(Gr(e),i):function(a){var c=sc(a,e);return c===r&&c===i?ac(a,e):Un(i,c,q|W)}}function Ws(e,i,a,c,f){e!==i&&Po(i,function(w,S){if(f||(f=new Dr),ut(w))eg(e,i,S,a,Ws,c,f);else{var A=c?c(Yo(e,S),w,S+"",e,i,f):r;A===r&&(A=w),So(e,S,A)}},hr)}function eg(e,i,a,c,f,w,S){var A=Yo(e,a),$=Yo(i,a),k=S.get($);if(k){So(e,a,k);return}var K=w?w(A,$,a+"",e,i,S):r,G=K===r;if(G){var X=me($),oe=!X&&Ii($),he=!X&&!oe&&pn($);K=$,X||oe||he?me(A)?K=A:Et(A)?K=cr(A):oe?(G=!1,K=rh($,!0)):he?(G=!1,K=ih($,!0)):K=[]:zn($)||zi($)?(K=A,zi(A)?K=Xh(A):(!ut(A)||si(A))&&(K=_h($))):G=!1}G&&(S.set($,K),f(K,$,c,w,S),S.delete($)),So(e,a,K)}function Vu(e,i){var a=e.length;if(a)return i+=i<0?a:0,ni(i,a)?e[i]:r}function Bu(e,i,a){i.length?i=nt(i,function(w){return me(w)?function(S){return Li(S,w.length===1?w[0]:w)}:w}):i=[lr];var c=-1;i=nt(i,gr(ue()));var f=Hu(e,function(w,S,A){var $=nt(i,function(k){return k(w)});return{criteria:$,index:++c,value:w}});return Od(f,function(w,S){return dg(w,S,a)})}function tg(e,i){return Gu(e,i,function(a,c){return ac(e,c)})}function Gu(e,i,a){for(var c=-1,f=i.length,w={};++c<f;){var S=i[c],A=Li(e,S);a(A,S)&&jn(w,_i(S,e),A)}return w}function rg(e){return function(i){return Li(i,e)}}function $o(e,i,a,c){var f=c?Pd:rn,w=-1,S=i.length,A=e;for(e===i&&(i=cr(i)),a&&(A=nt(e,gr(a)));++w<S;)for(var $=0,k=i[w],K=a?a(k):k;($=f(A,K,$,c))>-1;)A!==e&&Ls.call(A,$,1),Ls.call(e,$,1);return e}function Wu(e,i){for(var a=e?i.length:0,c=a-1;a--;){var f=i[a];if(a==c||f!==w){var w=f;ni(f)?Ls.call(e,f,1):jo(e,f)}}return e}function Fo(e,i){return e+zs(Nu()*(i-e+1))}function ig(e,i,a,c){for(var f=-1,w=Ut(Ms((i-e)/(a||1)),0),S=U(w);w--;)S[c?w:++f]=e,e+=a;return S}function Do(e,i){var a="";if(!e||i<1||i>ee)return a;do i%2&&(a+=e),i=zs(i/2),i&&(e+=e);while(i);return a}function _e(e,i){return Zo(Sh(e,i,lr),e+"")}function ng(e){return Cu(gn(e))}function sg(e,i){var a=gn(e);return na(a,ji(i,0,a.length))}function jn(e,i,a,c){if(!ut(e))return e;i=_i(i,e);for(var f=-1,w=i.length,S=w-1,A=e;A!=null&&++f<w;){var $=Gr(i[f]),k=a;if($==="__proto__"||$==="constructor"||$==="prototype")return e;if(f!=S){var K=A[$];k=c?c(K,$,A):r,k===r&&(k=ut(K)?K:ni(i[f+1])?[]:{})}$n(A,$,k),A=A[$]}return e}var Qu=Hs?function(e,i){return Hs.set(e,i),e}:lr,ag=qs?function(e,i){return qs(e,"toString",{configurable:!0,enumerable:!1,value:cc(i),writable:!0})}:lr;function og(e){return na(gn(e))}function Or(e,i,a){var c=-1,f=e.length;i<0&&(i=-i>f?0:f+i),a=a>f?f:a,a<0&&(a+=f),f=i>a?0:a-i>>>0,i>>>=0;for(var w=U(f);++c<f;)w[c]=e[c+i];return w}function cg(e,i){var a;return wi(e,function(c,f,w){return a=i(c,f,w),!a}),!!a}function Qs(e,i,a){var c=0,f=e==null?c:e.length;if(typeof i=="number"&&i===i&&f<=ke){for(;c<f;){var w=c+f>>>1,S=e[w];S!==null&&!yr(S)&&(a?S<=i:S<i)?c=w+1:f=w}return f}return Uo(e,i,lr,a)}function Uo(e,i,a,c){var f=0,w=e==null?0:e.length;if(w===0)return 0;i=a(i);for(var S=i!==i,A=i===null,$=yr(i),k=i===r;f<w;){var K=zs((f+w)/2),G=a(e[K]),X=G!==r,oe=G===null,he=G===G,we=yr(G);if(S)var le=c||he;else k?le=he&&(c||X):A?le=he&&X&&(c||!oe):$?le=he&&X&&!oe&&(c||!we):oe||we?le=!1:le=c?G<=i:G<i;le?f=K+1:w=K}return Bt(w,ht)}function Ju(e,i){for(var a=-1,c=e.length,f=0,w=[];++a<c;){var S=e[a],A=i?i(S):S;if(!a||!Ur(A,$)){var $=A;w[f++]=S===0?0:S}}return w}function Yu(e){return typeof e=="number"?e:yr(e)?J:+e}function mr(e){if(typeof e=="string")return e;if(me(e))return nt(e,mr)+"";if(yr(e))return Au?Au.call(e):"";var i=e+"";return i=="0"&&1/e==-Te?"-0":i}function bi(e,i,a){var c=-1,f=Ns,w=e.length,S=!0,A=[],$=A;if(a)S=!1,f=ho;else if(w>=o){var k=i?null:wg(e);if(k)return Ts(k);S=!1,f=On,$=new Ui}else $=i?[]:A;e:for(;++c<w;){var K=e[c],G=i?i(K):K;if(K=a||K!==0?K:0,S&&G===G){for(var X=$.length;X--;)if($[X]===G)continue e;i&&$.push(G),A.push(K)}else f($,G,a)||($!==A&&$.push(G),A.push(K))}return A}function jo(e,i){return i=_i(i,e),e=xh(e,i),e==null||delete e[Gr(Nr(i))]}function Zu(e,i,a,c){return jn(e,i,a(Li(e,i)),c)}function Js(e,i,a,c){for(var f=e.length,w=c?f:-1;(c?w--:++w<f)&&i(e[w],w,e););return a?Or(e,c?0:w,c?w+1:f):Or(e,c?w+1:0,c?f:w)}function Xu(e,i){var a=e;return a instanceof xe&&(a=a.value()),lo(i,function(c,f){return f.func.apply(f.thisArg,mi([c],f.args))},a)}function Lo(e,i,a){var c=e.length;if(c<2)return c?bi(e[0]):[];for(var f=-1,w=U(c);++f<c;)for(var S=e[f],A=-1;++A<c;)A!=f&&(w[f]=Fn(w[f]||S,e[A],i,a));return bi(kt(w,1),i,a)}function eh(e,i,a){for(var c=-1,f=e.length,w=i.length,S={};++c<f;){var A=c<w?i[c]:r;a(S,e[c],A)}return S}function qo(e){return Et(e)?e:[]}function Mo(e){return typeof e=="function"?e:lr}function _i(e,i){return me(e)?e:Qo(e,i)?[e]:Ah(Ue(e))}var ug=_e;function Ei(e,i,a){var c=e.length;return a=a===r?c:a,!i&&a>=c?e:Or(e,i,a)}var th=Jd||function(e){return Pe.clearTimeout(e)};function rh(e,i){if(i)return e.slice();var a=e.length,c=Iu?Iu(a):new e.constructor(a);return e.copy(c),c}function zo(e){var i=new e.constructor(e.byteLength);return new Us(i).set(new Us(e)),i}function hg(e,i){var a=i?zo(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function lg(e){var i=new e.constructor(e.source,_r.exec(e));return i.lastIndex=e.lastIndex,i}function fg(e){return Rn?We(Rn.call(e)):{}}function ih(e,i){var a=i?zo(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function nh(e,i){if(e!==i){var a=e!==r,c=e===null,f=e===e,w=yr(e),S=i!==r,A=i===null,$=i===i,k=yr(i);if(!A&&!k&&!w&&e>i||w&&S&&$&&!A&&!k||c&&S&&$||!a&&$||!f)return 1;if(!c&&!w&&!k&&e<i||k&&a&&f&&!c&&!w||A&&a&&f||!S&&f||!$)return-1}return 0}function dg(e,i,a){for(var c=-1,f=e.criteria,w=i.criteria,S=f.length,A=a.length;++c<S;){var $=nh(f[c],w[c]);if($){if(c>=A)return $;var k=a[c];return $*(k=="desc"?-1:1)}}return e.index-i.index}function sh(e,i,a,c){for(var f=-1,w=e.length,S=a.length,A=-1,$=i.length,k=Ut(w-S,0),K=U($+k),G=!c;++A<$;)K[A]=i[A];for(;++f<S;)(G||f<w)&&(K[a[f]]=e[f]);for(;k--;)K[A++]=e[f++];return K}function ah(e,i,a,c){for(var f=-1,w=e.length,S=-1,A=a.length,$=-1,k=i.length,K=Ut(w-A,0),G=U(K+k),X=!c;++f<K;)G[f]=e[f];for(var oe=f;++$<k;)G[oe+$]=i[$];for(;++S<A;)(X||f<w)&&(G[oe+a[S]]=e[f++]);return G}function cr(e,i){var a=-1,c=e.length;for(i||(i=U(c));++a<c;)i[a]=e[a];return i}function Br(e,i,a,c){var f=!a;a||(a={});for(var w=-1,S=i.length;++w<S;){var A=i[w],$=c?c(a[A],e[A],A,a,e):r;$===r&&($=e[A]),f?ti(a,A,$):$n(a,A,$)}return a}function pg(e,i){return Br(e,Wo(e),i)}function gg(e,i){return Br(e,wh(e),i)}function Ys(e,i){return function(a,c){var f=me(a)?bd:jp,w=i?i():{};return f(a,e,ue(c,2),w)}}function ln(e){return _e(function(i,a){var c=-1,f=a.length,w=f>1?a[f-1]:r,S=f>2?a[2]:r;for(w=e.length>3&&typeof w=="function"?(f--,w):r,S&&tr(a[0],a[1],S)&&(w=f<3?r:w,f=1),i=We(i);++c<f;){var A=a[c];A&&e(i,A,c,w)}return i})}function oh(e,i){return function(a,c){if(a==null)return a;if(!ur(a))return e(a,c);for(var f=a.length,w=i?f:-1,S=We(a);(i?w--:++w<f)&&c(S[w],w,S)!==!1;);return a}}function ch(e){return function(i,a,c){for(var f=-1,w=We(i),S=c(i),A=S.length;A--;){var $=S[e?A:++f];if(a(w[$],$,w)===!1)break}return i}}function mg(e,i,a){var c=i&ie,f=Ln(e);function w(){var S=this&&this!==Pe&&this instanceof w?f:e;return S.apply(c?a:this,arguments)}return w}function uh(e){return function(i){i=Ue(i);var a=nn(i)?Fr(i):r,c=a?a[0]:i.charAt(0),f=a?Ei(a,1).join(""):i.slice(1);return c[e]()+f}}function fn(e){return function(i){return lo(ol(al(i).replace(xn,"")),e,"")}}function Ln(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=hn(e.prototype),c=e.apply(a,i);return ut(c)?c:a}}function yg(e,i,a){var c=Ln(e);function f(){for(var w=arguments.length,S=U(w),A=w,$=dn(f);A--;)S[A]=arguments[A];var k=w<3&&S[0]!==$&&S[w-1]!==$?[]:yi(S,$);if(w-=k.length,w<a)return ph(e,i,Zs,f.placeholder,r,S,k,r,r,a-w);var K=this&&this!==Pe&&this instanceof f?c:e;return Lt(K,this,S)}return f}function hh(e){return function(i,a,c){var f=We(i);if(!ur(i)){var w=ue(a,3);i=qt(i),a=function(A){return w(f[A],A,f)}}var S=e(i,a,c);return S>-1?f[w?i[S]:S]:r}}function lh(e){return ii(function(i){var a=i.length,c=a,f=xr.prototype.thru;for(e&&i.reverse();c--;){var w=i[c];if(typeof w!="function")throw new Sr(y);if(f&&!S&&ra(w)=="wrapper")var S=new xr([],!0)}for(c=S?c:a;++c<a;){w=i[c];var A=ra(w),$=A=="wrapper"?Bo(w):r;$&&Jo($[0])&&$[1]==(N|d|g|x)&&!$[4].length&&$[9]==1?S=S[ra($[0])].apply(S,$[3]):S=w.length==1&&Jo(w)?S[A]():S.thru(w)}return function(){var k=arguments,K=k[0];if(S&&k.length==1&&me(K))return S.plant(K).value();for(var G=0,X=a?i[G].apply(this,k):K;++G<a;)X=i[G].call(this,X);return X}})}function Zs(e,i,a,c,f,w,S,A,$,k){var K=i&N,G=i&ie,X=i&ce,oe=i&(d|m),he=i&Q,we=X?r:Ln(e);function le(){for(var Ie=arguments.length,Oe=U(Ie),vr=Ie;vr--;)Oe[vr]=arguments[vr];if(oe)var rr=dn(le),wr=Ad(Oe,rr);if(c&&(Oe=sh(Oe,c,f,oe)),w&&(Oe=ah(Oe,w,S,oe)),Ie-=wr,oe&&Ie<k){var It=yi(Oe,rr);return ph(e,i,Zs,le.placeholder,a,Oe,It,A,$,k-Ie)}var jr=G?a:this,oi=X?jr[e]:e;return Ie=Oe.length,A?Oe=jg(Oe,A):he&&Ie>1&&Oe.reverse(),K&&$<Ie&&(Oe.length=$),this&&this!==Pe&&this instanceof le&&(oi=we||Ln(oi)),oi.apply(jr,Oe)}return le}function fh(e,i){return function(a,c){return Vp(a,e,i(c),{})}}function Xs(e,i){return function(a,c){var f;if(a===r&&c===r)return i;if(a!==r&&(f=a),c!==r){if(f===r)return c;typeof a=="string"||typeof c=="string"?(a=mr(a),c=mr(c)):(a=Yu(a),c=Yu(c)),f=e(a,c)}return f}}function Ho(e){return ii(function(i){return i=nt(i,gr(ue())),_e(function(a){var c=this;return e(i,function(f){return Lt(f,c,a)})})})}function ea(e,i){i=i===r?" ":mr(i);var a=i.length;if(a<2)return a?Do(i,e):i;var c=Do(i,Ms(e/sn(i)));return nn(i)?Ei(Fr(c),0,e).join(""):c.slice(0,e)}function vg(e,i,a,c){var f=i&ie,w=Ln(e);function S(){for(var A=-1,$=arguments.length,k=-1,K=c.length,G=U(K+$),X=this&&this!==Pe&&this instanceof S?w:e;++k<K;)G[k]=c[k];for(;$--;)G[k++]=arguments[++A];return Lt(X,f?a:this,G)}return S}function dh(e){return function(i,a,c){return c&&typeof c!="number"&&tr(i,a,c)&&(a=c=r),i=ai(i),a===r?(a=i,i=0):a=ai(a),c=c===r?i<a?1:-1:ai(c),ig(i,a,c,e)}}function ta(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Ar(i),a=Ar(a)),e(i,a)}}function ph(e,i,a,c,f,w,S,A,$,k){var K=i&d,G=K?S:r,X=K?r:S,oe=K?w:r,he=K?r:w;i|=K?g:p,i&=~(K?p:g),i&u||(i&=~(ie|ce));var we=[e,i,f,oe,G,he,X,A,$,k],le=a.apply(r,we);return Jo(e)&&Ph(le,we),le.placeholder=c,Oh(le,e,i)}function ko(e){var i=Dt[e];return function(a,c){if(a=Ar(a),c=c==null?0:Bt(ye(c),292),c&&Ou(a)){var f=(Ue(a)+"e").split("e"),w=i(f[0]+"e"+(+f[1]+c));return f=(Ue(w)+"e").split("e"),+(f[0]+"e"+(+f[1]-c))}return i(a)}}var wg=cn&&1/Ts(new cn([,-0]))[1]==Te?function(e){return new cn(e)}:lc;function gh(e){return function(i){var a=Gt(i);return a==ve?wo(i):a==De?Ud(i):Nd(i,e(i))}}function ri(e,i,a,c,f,w,S,A){var $=i&ce;if(!$&&typeof e!="function")throw new Sr(y);var k=c?c.length:0;if(k||(i&=~(g|p),c=f=r),S=S===r?S:Ut(ye(S),0),A=A===r?A:ye(A),k-=f?f.length:0,i&p){var K=c,G=f;c=f=r}var X=$?r:Bo(e),oe=[e,i,a,c,f,K,G,w,S,A];if(X&&Fg(oe,X),e=oe[0],i=oe[1],a=oe[2],c=oe[3],f=oe[4],A=oe[9]=oe[9]===r?$?0:e.length:Ut(oe[9]-k,0),!A&&i&(d|m)&&(i&=~(d|m)),!i||i==ie)var he=mg(e,i,a);else i==d||i==m?he=yg(e,i,A):(i==g||i==(ie|g))&&!f.length?he=vg(e,i,a,c):he=Zs.apply(r,oe);var we=X?Qu:Ph;return Oh(we(he,oe),e,i)}function mh(e,i,a,c){return e===r||Ur(e,on[a])&&!Le.call(c,a)?i:e}function yh(e,i,a,c,f,w){return ut(e)&&ut(i)&&(w.set(i,e),Ws(e,i,r,yh,w),w.delete(i)),e}function bg(e){return zn(e)?r:e}function vh(e,i,a,c,f,w){var S=a&q,A=e.length,$=i.length;if(A!=$&&!(S&&$>A))return!1;var k=w.get(e),K=w.get(i);if(k&&K)return k==i&&K==e;var G=-1,X=!0,oe=a&W?new Ui:r;for(w.set(e,i),w.set(i,e);++G<A;){var he=e[G],we=i[G];if(c)var le=S?c(we,he,G,i,e,w):c(he,we,G,e,i,w);if(le!==r){if(le)continue;X=!1;break}if(oe){if(!fo(i,function(Ie,Oe){if(!On(oe,Oe)&&(he===Ie||f(he,Ie,a,c,w)))return oe.push(Oe)})){X=!1;break}}else if(!(he===we||f(he,we,a,c,w))){X=!1;break}}return w.delete(e),w.delete(i),X}function _g(e,i,a,c,f,w,S){switch(a){case Ke:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Re:return!(e.byteLength!=i.byteLength||!w(new Us(e),new Us(i)));case L:case F:case Ce:return Ur(+e,+i);case T:return e.name==i.name&&e.message==i.message;case at:case Je:return e==i+"";case ve:var A=wo;case De:var $=c&q;if(A||(A=Ts),e.size!=i.size&&!$)return!1;var k=S.get(e);if(k)return k==i;c|=W,S.set(e,i);var K=vh(A(e),A(i),c,f,w,S);return S.delete(e),K;case Ye:if(Rn)return Rn.call(e)==Rn.call(i)}return!1}function Eg(e,i,a,c,f,w){var S=a&q,A=Ko(e),$=A.length,k=Ko(i),K=k.length;if($!=K&&!S)return!1;for(var G=$;G--;){var X=A[G];if(!(S?X in i:Le.call(i,X)))return!1}var oe=w.get(e),he=w.get(i);if(oe&&he)return oe==i&&he==e;var we=!0;w.set(e,i),w.set(i,e);for(var le=S;++G<$;){X=A[G];var Ie=e[X],Oe=i[X];if(c)var vr=S?c(Oe,Ie,X,i,e,w):c(Ie,Oe,X,e,i,w);if(!(vr===r?Ie===Oe||f(Ie,Oe,a,c,w):vr)){we=!1;break}le||(le=X=="constructor")}if(we&&!le){var rr=e.constructor,wr=i.constructor;rr!=wr&&"constructor"in e&&"constructor"in i&&!(typeof rr=="function"&&rr instanceof rr&&typeof wr=="function"&&wr instanceof wr)&&(we=!1)}return w.delete(e),w.delete(i),we}function ii(e){return Zo(Sh(e,r,$h),e+"")}function Ko(e){return Lu(e,qt,Wo)}function Vo(e){return Lu(e,hr,wh)}var Bo=Hs?function(e){return Hs.get(e)}:lc;function ra(e){for(var i=e.name+"",a=un[i],c=Le.call(un,i)?a.length:0;c--;){var f=a[c],w=f.func;if(w==null||w==e)return f.name}return i}function dn(e){var i=Le.call(v,"placeholder")?v:e;return i.placeholder}function ue(){var e=v.iteratee||uc;return e=e===uc?zu:e,arguments.length?e(arguments[0],arguments[1]):e}function ia(e,i){var a=e.__data__;return Tg(i)?a[typeof i=="string"?"string":"hash"]:a.map}function Go(e){for(var i=qt(e),a=i.length;a--;){var c=i[a],f=e[c];i[a]=[c,f,Eh(f)]}return i}function qi(e,i){var a=$d(e,i);return Mu(a)?a:r}function Ig(e){var i=Le.call(e,Fi),a=e[Fi];try{e[Fi]=r;var c=!0}catch{}var f=Fs.call(e);return c&&(i?e[Fi]=a:delete e[Fi]),f}var Wo=_o?function(e){return e==null?[]:(e=We(e),gi(_o(e),function(i){return xu.call(e,i)}))}:fc,wh=_o?function(e){for(var i=[];e;)mi(i,Wo(e)),e=js(e);return i}:fc,Gt=er;(Eo&&Gt(new Eo(new ArrayBuffer(1)))!=Ke||An&&Gt(new An)!=ve||Io&&Gt(Io.resolve())!=xt||cn&&Gt(new cn)!=De||Tn&&Gt(new Tn)!=Me)&&(Gt=function(e){var i=er(e),a=i==Se?e.constructor:r,c=a?Mi(a):"";if(c)switch(c){case sp:return Ke;case ap:return ve;case op:return xt;case cp:return De;case up:return Me}return i});function Sg(e,i,a){for(var c=-1,f=a.length;++c<f;){var w=a[c],S=w.size;switch(w.type){case"drop":e+=S;break;case"dropRight":i-=S;break;case"take":i=Bt(i,e+S);break;case"takeRight":e=Ut(e,i-S);break}}return{start:e,end:i}}function xg(e){var i=e.match(Qe);return i?i[1].split(Tt):[]}function bh(e,i,a){i=_i(i,e);for(var c=-1,f=i.length,w=!1;++c<f;){var S=Gr(i[c]);if(!(w=e!=null&&a(e,S)))break;e=e[S]}return w||++c!=f?w:(f=e==null?0:e.length,!!f&&ha(f)&&ni(S,f)&&(me(e)||zi(e)))}function Pg(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&Le.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function _h(e){return typeof e.constructor=="function"&&!qn(e)?hn(js(e)):{}}function Og(e,i,a){var c=e.constructor;switch(i){case Re:return zo(e);case L:case F:return new c(+e);case Ke:return hg(e,a);case lt:case je:case Pt:case Ft:case zt:case Ht:case jt:case Yt:case ar:return ih(e,a);case ve:return new c;case Ce:case Je:return new c(e);case at:return lg(e);case De:return new c;case Ye:return fg(e)}}function Ng(e,i){var a=i.length;if(!a)return e;var c=a-1;return i[c]=(a>1?"& ":"")+i[c],i=i.join(a>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function Ag(e){return me(e)||zi(e)||!!(Pu&&e&&e[Pu])}function ni(e,i){var a=typeof e;return i=i??ee,!!i&&(a=="number"||a!="symbol"&&Ja.test(e))&&e>-1&&e%1==0&&e<i}function tr(e,i,a){if(!ut(a))return!1;var c=typeof i;return(c=="number"?ur(a)&&ni(i,a.length):c=="string"&&i in a)?Ur(a[i],e):!1}function Qo(e,i){if(me(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||yr(e)?!0:Ot.test(e)||!it.test(e)||i!=null&&e in We(i)}function Tg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Jo(e){var i=ra(e),a=v[i];if(typeof a!="function"||!(i in xe.prototype))return!1;if(e===a)return!0;var c=Bo(a);return!!c&&e===c[0]}function Cg(e){return!!Eu&&Eu in e}var Rg=Rs?si:dc;function qn(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||on;return e===a}function Eh(e){return e===e&&!ut(e)}function Ih(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in We(a))}}function $g(e){var i=ca(e,function(c){return a.size===_&&a.clear(),c}),a=i.cache;return i}function Fg(e,i){var a=e[1],c=i[1],f=a|c,w=f<(ie|ce|N),S=c==N&&a==d||c==N&&a==x&&e[7].length<=i[8]||c==(N|x)&&i[7].length<=i[8]&&a==d;if(!(w||S))return e;c&ie&&(e[2]=i[2],f|=a&ie?0:u);var A=i[3];if(A){var $=e[3];e[3]=$?sh($,A,i[4]):A,e[4]=$?yi(e[3],E):i[4]}return A=i[5],A&&($=e[5],e[5]=$?ah($,A,i[6]):A,e[6]=$?yi(e[5],E):i[6]),A=i[7],A&&(e[7]=A),c&N&&(e[8]=e[8]==null?i[8]:Bt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function Dg(e){var i=[];if(e!=null)for(var a in We(e))i.push(a);return i}function Ug(e){return Fs.call(e)}function Sh(e,i,a){return i=Ut(i===r?e.length-1:i,0),function(){for(var c=arguments,f=-1,w=Ut(c.length-i,0),S=U(w);++f<w;)S[f]=c[i+f];f=-1;for(var A=U(i+1);++f<i;)A[f]=c[f];return A[i]=a(S),Lt(e,this,A)}}function xh(e,i){return i.length<2?e:Li(e,Or(i,0,-1))}function jg(e,i){for(var a=e.length,c=Bt(i.length,a),f=cr(e);c--;){var w=i[c];e[c]=ni(w,a)?f[w]:r}return e}function Yo(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Ph=Nh(Qu),Mn=Zd||function(e,i){return Pe.setTimeout(e,i)},Zo=Nh(ag);function Oh(e,i,a){var c=i+"";return Zo(e,Ng(c,Lg(xg(c),a)))}function Nh(e){var i=0,a=0;return function(){var c=rp(),f=tt-(c-a);if(a=c,f>0){if(++i>=Ae)return arguments[0]}else i=0;return e.apply(r,arguments)}}function na(e,i){var a=-1,c=e.length,f=c-1;for(i=i===r?c:i;++a<i;){var w=Fo(a,f),S=e[w];e[w]=e[a],e[a]=S}return e.length=i,e}var Ah=$g(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Nt,function(a,c,f,w){i.push(f?w.replace(Ka,"$1"):c||a)}),i});function Gr(e){if(typeof e=="string"||yr(e))return e;var i=e+"";return i=="0"&&1/e==-Te?"-0":i}function Mi(e){if(e!=null){try{return $s.call(e)}catch{}try{return e+""}catch{}}return""}function Lg(e,i){return Ir(zr,function(a){var c="_."+a[0];i&a[1]&&!Ns(e,c)&&e.push(c)}),e.sort()}function Th(e){if(e instanceof xe)return e.clone();var i=new xr(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function qg(e,i,a){(a?tr(e,i,a):i===r)?i=1:i=Ut(ye(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var f=0,w=0,S=U(Ms(c/i));f<c;)S[w++]=Or(e,f,f+=i);return S}function Mg(e){for(var i=-1,a=e==null?0:e.length,c=0,f=[];++i<a;){var w=e[i];w&&(f[c++]=w)}return f}function zg(){var e=arguments.length;if(!e)return[];for(var i=U(e-1),a=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(me(a)?cr(a):[a],kt(i,1))}var Hg=_e(function(e,i){return Et(e)?Fn(e,kt(i,1,Et,!0)):[]}),kg=_e(function(e,i){var a=Nr(i);return Et(a)&&(a=r),Et(e)?Fn(e,kt(i,1,Et,!0),ue(a,2)):[]}),Kg=_e(function(e,i){var a=Nr(i);return Et(a)&&(a=r),Et(e)?Fn(e,kt(i,1,Et,!0),r,a):[]});function Vg(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),Or(e,i<0?0:i,c)):[]}function Bg(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),i=c-i,Or(e,0,i<0?0:i)):[]}function Gg(e,i){return e&&e.length?Js(e,ue(i,3),!0,!0):[]}function Wg(e,i){return e&&e.length?Js(e,ue(i,3),!0):[]}function Qg(e,i,a,c){var f=e==null?0:e.length;return f?(a&&typeof a!="number"&&tr(e,i,a)&&(a=0,c=f),zp(e,i,a,c)):[]}function Ch(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=a==null?0:ye(a);return f<0&&(f=Ut(c+f,0)),As(e,ue(i,3),f)}function Rh(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=c-1;return a!==r&&(f=ye(a),f=a<0?Ut(c+f,0):Bt(f,c-1)),As(e,ue(i,3),f,!0)}function $h(e){var i=e==null?0:e.length;return i?kt(e,1):[]}function Jg(e){var i=e==null?0:e.length;return i?kt(e,Te):[]}function Yg(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:ye(i),kt(e,i)):[]}function Zg(e){for(var i=-1,a=e==null?0:e.length,c={};++i<a;){var f=e[i];c[f[0]]=f[1]}return c}function Fh(e){return e&&e.length?e[0]:r}function Xg(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=a==null?0:ye(a);return f<0&&(f=Ut(c+f,0)),rn(e,i,f)}function em(e){var i=e==null?0:e.length;return i?Or(e,0,-1):[]}var tm=_e(function(e){var i=nt(e,qo);return i.length&&i[0]===e[0]?Ao(i):[]}),rm=_e(function(e){var i=Nr(e),a=nt(e,qo);return i===Nr(a)?i=r:a.pop(),a.length&&a[0]===e[0]?Ao(a,ue(i,2)):[]}),im=_e(function(e){var i=Nr(e),a=nt(e,qo);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?Ao(a,r,i):[]});function nm(e,i){return e==null?"":ep.call(e,i)}function Nr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function sm(e,i,a){var c=e==null?0:e.length;if(!c)return-1;var f=c;return a!==r&&(f=ye(a),f=f<0?Ut(c+f,0):Bt(f,c-1)),i===i?Ld(e,i,f):As(e,pu,f,!0)}function am(e,i){return e&&e.length?Vu(e,ye(i)):r}var om=_e(Dh);function Dh(e,i){return e&&e.length&&i&&i.length?$o(e,i):e}function cm(e,i,a){return e&&e.length&&i&&i.length?$o(e,i,ue(a,2)):e}function um(e,i,a){return e&&e.length&&i&&i.length?$o(e,i,r,a):e}var hm=ii(function(e,i){var a=e==null?0:e.length,c=xo(e,i);return Wu(e,nt(i,function(f){return ni(f,a)?+f:f}).sort(nh)),c});function lm(e,i){var a=[];if(!(e&&e.length))return a;var c=-1,f=[],w=e.length;for(i=ue(i,3);++c<w;){var S=e[c];i(S,c,e)&&(a.push(S),f.push(c))}return Wu(e,f),a}function Xo(e){return e==null?e:np.call(e)}function fm(e,i,a){var c=e==null?0:e.length;return c?(a&&typeof a!="number"&&tr(e,i,a)?(i=0,a=c):(i=i==null?0:ye(i),a=a===r?c:ye(a)),Or(e,i,a)):[]}function dm(e,i){return Qs(e,i)}function pm(e,i,a){return Uo(e,i,ue(a,2))}function gm(e,i){var a=e==null?0:e.length;if(a){var c=Qs(e,i);if(c<a&&Ur(e[c],i))return c}return-1}function mm(e,i){return Qs(e,i,!0)}function ym(e,i,a){return Uo(e,i,ue(a,2),!0)}function vm(e,i){var a=e==null?0:e.length;if(a){var c=Qs(e,i,!0)-1;if(Ur(e[c],i))return c}return-1}function wm(e){return e&&e.length?Ju(e):[]}function bm(e,i){return e&&e.length?Ju(e,ue(i,2)):[]}function _m(e){var i=e==null?0:e.length;return i?Or(e,1,i):[]}function Em(e,i,a){return e&&e.length?(i=a||i===r?1:ye(i),Or(e,0,i<0?0:i)):[]}function Im(e,i,a){var c=e==null?0:e.length;return c?(i=a||i===r?1:ye(i),i=c-i,Or(e,i<0?0:i,c)):[]}function Sm(e,i){return e&&e.length?Js(e,ue(i,3),!1,!0):[]}function xm(e,i){return e&&e.length?Js(e,ue(i,3)):[]}var Pm=_e(function(e){return bi(kt(e,1,Et,!0))}),Om=_e(function(e){var i=Nr(e);return Et(i)&&(i=r),bi(kt(e,1,Et,!0),ue(i,2))}),Nm=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,bi(kt(e,1,Et,!0),r,i)});function Am(e){return e&&e.length?bi(e):[]}function Tm(e,i){return e&&e.length?bi(e,ue(i,2)):[]}function Cm(e,i){return i=typeof i=="function"?i:r,e&&e.length?bi(e,r,i):[]}function ec(e){if(!(e&&e.length))return[];var i=0;return e=gi(e,function(a){if(Et(a))return i=Ut(a.length,i),!0}),yo(i,function(a){return nt(e,po(a))})}function Uh(e,i){if(!(e&&e.length))return[];var a=ec(e);return i==null?a:nt(a,function(c){return Lt(i,r,c)})}var Rm=_e(function(e,i){return Et(e)?Fn(e,i):[]}),$m=_e(function(e){return Lo(gi(e,Et))}),Fm=_e(function(e){var i=Nr(e);return Et(i)&&(i=r),Lo(gi(e,Et),ue(i,2))}),Dm=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,Lo(gi(e,Et),r,i)}),Um=_e(ec);function jm(e,i){return eh(e||[],i||[],$n)}function Lm(e,i){return eh(e||[],i||[],jn)}var qm=_e(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Uh(e,a)});function jh(e){var i=v(e);return i.__chain__=!0,i}function Mm(e,i){return i(e),e}function sa(e,i){return i(e)}var zm=ii(function(e){var i=e.length,a=i?e[0]:0,c=this.__wrapped__,f=function(w){return xo(w,e)};return i>1||this.__actions__.length||!(c instanceof xe)||!ni(a)?this.thru(f):(c=c.slice(a,+a+(i?1:0)),c.__actions__.push({func:sa,args:[f],thisArg:r}),new xr(c,this.__chain__).thru(function(w){return i&&!w.length&&w.push(r),w}))});function Hm(){return jh(this)}function km(){return new xr(this.value(),this.__chain__)}function Km(){this.__values__===r&&(this.__values__=Yh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Vm(){return this}function Bm(e){for(var i,a=this;a instanceof Ks;){var c=Th(a);c.__index__=0,c.__values__=r,i?f.__wrapped__=c:i=c;var f=c;a=a.__wrapped__}return f.__wrapped__=e,i}function Gm(){var e=this.__wrapped__;if(e instanceof xe){var i=e;return this.__actions__.length&&(i=new xe(this)),i=i.reverse(),i.__actions__.push({func:sa,args:[Xo],thisArg:r}),new xr(i,this.__chain__)}return this.thru(Xo)}function Wm(){return Xu(this.__wrapped__,this.__actions__)}var Qm=Ys(function(e,i,a){Le.call(e,a)?++e[a]:ti(e,a,1)});function Jm(e,i,a){var c=me(e)?fu:Mp;return a&&tr(e,i,a)&&(i=r),c(e,ue(i,3))}function Ym(e,i){var a=me(e)?gi:Uu;return a(e,ue(i,3))}var Zm=hh(Ch),Xm=hh(Rh);function ey(e,i){return kt(aa(e,i),1)}function ty(e,i){return kt(aa(e,i),Te)}function ry(e,i,a){return a=a===r?1:ye(a),kt(aa(e,i),a)}function Lh(e,i){var a=me(e)?Ir:wi;return a(e,ue(i,3))}function qh(e,i){var a=me(e)?_d:Du;return a(e,ue(i,3))}var iy=Ys(function(e,i,a){Le.call(e,a)?e[a].push(i):ti(e,a,[i])});function ny(e,i,a,c){e=ur(e)?e:gn(e),a=a&&!c?ye(a):0;var f=e.length;return a<0&&(a=Ut(f+a,0)),la(e)?a<=f&&e.indexOf(i,a)>-1:!!f&&rn(e,i,a)>-1}var sy=_e(function(e,i,a){var c=-1,f=typeof i=="function",w=ur(e)?U(e.length):[];return wi(e,function(S){w[++c]=f?Lt(i,S,a):Dn(S,i,a)}),w}),ay=Ys(function(e,i,a){ti(e,a,i)});function aa(e,i){var a=me(e)?nt:Hu;return a(e,ue(i,3))}function oy(e,i,a,c){return e==null?[]:(me(i)||(i=i==null?[]:[i]),a=c?r:a,me(a)||(a=a==null?[]:[a]),Bu(e,i,a))}var cy=Ys(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function uy(e,i,a){var c=me(e)?lo:mu,f=arguments.length<3;return c(e,ue(i,4),a,f,wi)}function hy(e,i,a){var c=me(e)?Ed:mu,f=arguments.length<3;return c(e,ue(i,4),a,f,Du)}function ly(e,i){var a=me(e)?gi:Uu;return a(e,ua(ue(i,3)))}function fy(e){var i=me(e)?Cu:ng;return i(e)}function dy(e,i,a){(a?tr(e,i,a):i===r)?i=1:i=ye(i);var c=me(e)?Dp:sg;return c(e,i)}function py(e){var i=me(e)?Up:og;return i(e)}function gy(e){if(e==null)return 0;if(ur(e))return la(e)?sn(e):e.length;var i=Gt(e);return i==ve||i==De?e.size:Co(e).length}function my(e,i,a){var c=me(e)?fo:cg;return a&&tr(e,i,a)&&(i=r),c(e,ue(i,3))}var yy=_e(function(e,i){if(e==null)return[];var a=i.length;return a>1&&tr(e,i[0],i[1])?i=[]:a>2&&tr(i[0],i[1],i[2])&&(i=[i[0]]),Bu(e,kt(i,1),[])}),oa=Yd||function(){return Pe.Date.now()};function vy(e,i){if(typeof i!="function")throw new Sr(y);return e=ye(e),function(){if(--e<1)return i.apply(this,arguments)}}function Mh(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,ri(e,N,r,r,r,r,i)}function zh(e,i){var a;if(typeof i!="function")throw new Sr(y);return e=ye(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var tc=_e(function(e,i,a){var c=ie;if(a.length){var f=yi(a,dn(tc));c|=g}return ri(e,c,i,a,f)}),Hh=_e(function(e,i,a){var c=ie|ce;if(a.length){var f=yi(a,dn(Hh));c|=g}return ri(i,c,e,a,f)});function kh(e,i,a){i=a?r:i;var c=ri(e,d,r,r,r,r,r,i);return c.placeholder=kh.placeholder,c}function Kh(e,i,a){i=a?r:i;var c=ri(e,m,r,r,r,r,r,i);return c.placeholder=Kh.placeholder,c}function Vh(e,i,a){var c,f,w,S,A,$,k=0,K=!1,G=!1,X=!0;if(typeof e!="function")throw new Sr(y);i=Ar(i)||0,ut(a)&&(K=!!a.leading,G="maxWait"in a,w=G?Ut(Ar(a.maxWait)||0,i):w,X="trailing"in a?!!a.trailing:X);function oe(It){var jr=c,oi=f;return c=f=r,k=It,S=e.apply(oi,jr),S}function he(It){return k=It,A=Mn(Ie,i),K?oe(It):S}function we(It){var jr=It-$,oi=It-k,hl=i-jr;return G?Bt(hl,w-oi):hl}function le(It){var jr=It-$,oi=It-k;return $===r||jr>=i||jr<0||G&&oi>=w}function Ie(){var It=oa();if(le(It))return Oe(It);A=Mn(Ie,we(It))}function Oe(It){return A=r,X&&c?oe(It):(c=f=r,S)}function vr(){A!==r&&th(A),k=0,c=$=f=A=r}function rr(){return A===r?S:Oe(oa())}function wr(){var It=oa(),jr=le(It);if(c=arguments,f=this,$=It,jr){if(A===r)return he($);if(G)return th(A),A=Mn(Ie,i),oe($)}return A===r&&(A=Mn(Ie,i)),S}return wr.cancel=vr,wr.flush=rr,wr}var wy=_e(function(e,i){return Fu(e,1,i)}),by=_e(function(e,i,a){return Fu(e,Ar(i)||0,a)});function _y(e){return ri(e,Q)}function ca(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Sr(y);var a=function(){var c=arguments,f=i?i.apply(this,c):c[0],w=a.cache;if(w.has(f))return w.get(f);var S=e.apply(this,c);return a.cache=w.set(f,S)||w,S};return a.cache=new(ca.Cache||ei),a}ca.Cache=ei;function ua(e){if(typeof e!="function")throw new Sr(y);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Ey(e){return zh(2,e)}var Iy=ug(function(e,i){i=i.length==1&&me(i[0])?nt(i[0],gr(ue())):nt(kt(i,1),gr(ue()));var a=i.length;return _e(function(c){for(var f=-1,w=Bt(c.length,a);++f<w;)c[f]=i[f].call(this,c[f]);return Lt(e,this,c)})}),rc=_e(function(e,i){var a=yi(i,dn(rc));return ri(e,g,r,i,a)}),Bh=_e(function(e,i){var a=yi(i,dn(Bh));return ri(e,p,r,i,a)}),Sy=ii(function(e,i){return ri(e,x,r,r,r,i)});function xy(e,i){if(typeof e!="function")throw new Sr(y);return i=i===r?i:ye(i),_e(e,i)}function Py(e,i){if(typeof e!="function")throw new Sr(y);return i=i==null?0:Ut(ye(i),0),_e(function(a){var c=a[i],f=Ei(a,0,i);return c&&mi(f,c),Lt(e,this,f)})}function Oy(e,i,a){var c=!0,f=!0;if(typeof e!="function")throw new Sr(y);return ut(a)&&(c="leading"in a?!!a.leading:c,f="trailing"in a?!!a.trailing:f),Vh(e,i,{leading:c,maxWait:i,trailing:f})}function Ny(e){return Mh(e,1)}function Ay(e,i){return rc(Mo(i),e)}function Ty(){if(!arguments.length)return[];var e=arguments[0];return me(e)?e:[e]}function Cy(e){return Pr(e,H)}function Ry(e,i){return i=typeof i=="function"?i:r,Pr(e,H,i)}function $y(e){return Pr(e,O|H)}function Fy(e,i){return i=typeof i=="function"?i:r,Pr(e,O|H,i)}function Dy(e,i){return i==null||$u(e,i,qt(i))}function Ur(e,i){return e===i||e!==e&&i!==i}var Uy=ta(No),jy=ta(function(e,i){return e>=i}),zi=qu(function(){return arguments}())?qu:function(e){return vt(e)&&Le.call(e,"callee")&&!xu.call(e,"callee")},me=U.isArray,Ly=Xt?gr(Xt):Bp;function ur(e){return e!=null&&ha(e.length)&&!si(e)}function Et(e){return vt(e)&&ur(e)}function qy(e){return e===!0||e===!1||vt(e)&&er(e)==L}var Ii=Xd||dc,My=$r?gr($r):Gp;function zy(e){return vt(e)&&e.nodeType===1&&!zn(e)}function Hy(e){if(e==null)return!0;if(ur(e)&&(me(e)||typeof e=="string"||typeof e.splice=="function"||Ii(e)||pn(e)||zi(e)))return!e.length;var i=Gt(e);if(i==ve||i==De)return!e.size;if(qn(e))return!Co(e).length;for(var a in e)if(Le.call(e,a))return!1;return!0}function ky(e,i){return Un(e,i)}function Ky(e,i,a){a=typeof a=="function"?a:r;var c=a?a(e,i):r;return c===r?Un(e,i,r,a):!!c}function ic(e){if(!vt(e))return!1;var i=er(e);return i==T||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!zn(e)}function Vy(e){return typeof e=="number"&&Ou(e)}function si(e){if(!ut(e))return!1;var i=er(e);return i==ae||i==de||i==M||i==wt}function Gh(e){return typeof e=="number"&&e==ye(e)}function ha(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ut(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function vt(e){return e!=null&&typeof e=="object"}var Wh=Er?gr(Er):Qp;function By(e,i){return e===i||To(e,i,Go(i))}function Gy(e,i,a){return a=typeof a=="function"?a:r,To(e,i,Go(i),a)}function Wy(e){return Qh(e)&&e!=+e}function Qy(e){if(Rg(e))throw new pe(l);return Mu(e)}function Jy(e){return e===null}function Yy(e){return e==null}function Qh(e){return typeof e=="number"||vt(e)&&er(e)==Ce}function zn(e){if(!vt(e)||er(e)!=Se)return!1;var i=js(e);if(i===null)return!0;var a=Le.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&$s.call(a)==Gd}var nc=Kr?gr(Kr):Jp;function Zy(e){return Gh(e)&&e>=-ee&&e<=ee}var Jh=Pn?gr(Pn):Yp;function la(e){return typeof e=="string"||!me(e)&&vt(e)&&er(e)==Je}function yr(e){return typeof e=="symbol"||vt(e)&&er(e)==Ye}var pn=$i?gr($i):Zp;function Xy(e){return e===r}function e0(e){return vt(e)&&Gt(e)==Me}function t0(e){return vt(e)&&er(e)==Ze}var r0=ta(Ro),i0=ta(function(e,i){return e<=i});function Yh(e){if(!e)return[];if(ur(e))return la(e)?Fr(e):cr(e);if(Nn&&e[Nn])return Dd(e[Nn]());var i=Gt(e),a=i==ve?wo:i==De?Ts:gn;return a(e)}function ai(e){if(!e)return e===0?e:0;if(e=Ar(e),e===Te||e===-Te){var i=e<0?-1:1;return i*Y}return e===e?e:0}function ye(e){var i=ai(e),a=i%1;return i===i?a?i-a:i:0}function Zh(e){return e?ji(ye(e),0,Z):0}function Ar(e){if(typeof e=="number")return e;if(yr(e))return J;if(ut(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ut(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=yu(e);var a=Ga.test(e);return a||Qa.test(e)?ge(e.slice(2),a?2:8):Ba.test(e)?J:+e}function Xh(e){return Br(e,hr(e))}function n0(e){return e?ji(ye(e),-ee,ee):e===0?e:0}function Ue(e){return e==null?"":mr(e)}var s0=ln(function(e,i){if(qn(i)||ur(i)){Br(i,qt(i),e);return}for(var a in i)Le.call(i,a)&&$n(e,a,i[a])}),el=ln(function(e,i){Br(i,hr(i),e)}),fa=ln(function(e,i,a,c){Br(i,hr(i),e,c)}),a0=ln(function(e,i,a,c){Br(i,qt(i),e,c)}),o0=ii(xo);function c0(e,i){var a=hn(e);return i==null?a:Ru(a,i)}var u0=_e(function(e,i){e=We(e);var a=-1,c=i.length,f=c>2?i[2]:r;for(f&&tr(i[0],i[1],f)&&(c=1);++a<c;)for(var w=i[a],S=hr(w),A=-1,$=S.length;++A<$;){var k=S[A],K=e[k];(K===r||Ur(K,on[k])&&!Le.call(e,k))&&(e[k]=w[k])}return e}),h0=_e(function(e){return e.push(r,yh),Lt(tl,r,e)});function l0(e,i){return du(e,ue(i,3),Vr)}function f0(e,i){return du(e,ue(i,3),Oo)}function d0(e,i){return e==null?e:Po(e,ue(i,3),hr)}function p0(e,i){return e==null?e:ju(e,ue(i,3),hr)}function g0(e,i){return e&&Vr(e,ue(i,3))}function m0(e,i){return e&&Oo(e,ue(i,3))}function y0(e){return e==null?[]:Gs(e,qt(e))}function v0(e){return e==null?[]:Gs(e,hr(e))}function sc(e,i,a){var c=e==null?r:Li(e,i);return c===r?a:c}function w0(e,i){return e!=null&&bh(e,i,Hp)}function ac(e,i){return e!=null&&bh(e,i,kp)}var b0=fh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Fs.call(i)),e[i]=a},cc(lr)),_0=fh(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=Fs.call(i)),Le.call(e,i)?e[i].push(a):e[i]=[a]},ue),E0=_e(Dn);function qt(e){return ur(e)?Tu(e):Co(e)}function hr(e){return ur(e)?Tu(e,!0):Xp(e)}function I0(e,i){var a={};return i=ue(i,3),Vr(e,function(c,f,w){ti(a,i(c,f,w),c)}),a}function S0(e,i){var a={};return i=ue(i,3),Vr(e,function(c,f,w){ti(a,f,i(c,f,w))}),a}var x0=ln(function(e,i,a){Ws(e,i,a)}),tl=ln(function(e,i,a,c){Ws(e,i,a,c)}),P0=ii(function(e,i){var a={};if(e==null)return a;var c=!1;i=nt(i,function(w){return w=_i(w,e),c||(c=w.length>1),w}),Br(e,Vo(e),a),c&&(a=Pr(a,O|D|H,bg));for(var f=i.length;f--;)jo(a,i[f]);return a});function O0(e,i){return rl(e,ua(ue(i)))}var N0=ii(function(e,i){return e==null?{}:tg(e,i)});function rl(e,i){if(e==null)return{};var a=nt(Vo(e),function(c){return[c]});return i=ue(i),Gu(e,a,function(c,f){return i(c,f[0])})}function A0(e,i,a){i=_i(i,e);var c=-1,f=i.length;for(f||(f=1,e=r);++c<f;){var w=e==null?r:e[Gr(i[c])];w===r&&(c=f,w=a),e=si(w)?w.call(e):w}return e}function T0(e,i,a){return e==null?e:jn(e,i,a)}function C0(e,i,a,c){return c=typeof c=="function"?c:r,e==null?e:jn(e,i,a,c)}var il=gh(qt),nl=gh(hr);function R0(e,i,a){var c=me(e),f=c||Ii(e)||pn(e);if(i=ue(i,4),a==null){var w=e&&e.constructor;f?a=c?new w:[]:ut(e)?a=si(w)?hn(js(e)):{}:a={}}return(f?Ir:Vr)(e,function(S,A,$){return i(a,S,A,$)}),a}function $0(e,i){return e==null?!0:jo(e,i)}function F0(e,i,a){return e==null?e:Zu(e,i,Mo(a))}function D0(e,i,a,c){return c=typeof c=="function"?c:r,e==null?e:Zu(e,i,Mo(a),c)}function gn(e){return e==null?[]:vo(e,qt(e))}function U0(e){return e==null?[]:vo(e,hr(e))}function j0(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Ar(a),a=a===a?a:0),i!==r&&(i=Ar(i),i=i===i?i:0),ji(Ar(e),i,a)}function L0(e,i,a){return i=ai(i),a===r?(a=i,i=0):a=ai(a),e=Ar(e),Kp(e,i,a)}function q0(e,i,a){if(a&&typeof a!="boolean"&&tr(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ai(e),i===r?(i=e,e=0):i=ai(i)),e>i){var c=e;e=i,i=c}if(a||e%1||i%1){var f=Nu();return Bt(e+f*(i-e+Be("1e-"+((f+"").length-1))),i)}return Fo(e,i)}var M0=fn(function(e,i,a){return i=i.toLowerCase(),e+(a?sl(i):i)});function sl(e){return oc(Ue(e).toLowerCase())}function al(e){return e=Ue(e),e&&e.replace(Yr,Td).replace(co,"")}function z0(e,i,a){e=Ue(e),i=mr(i);var c=e.length;a=a===r?c:ji(ye(a),0,c);var f=a;return a-=i.length,a>=0&&e.slice(a,f)==i}function H0(e){return e=Ue(e),e&&rt.test(e)?e.replace(Ni,Cd):e}function k0(e){return e=Ue(e),e&&At.test(e)?e.replace(gt,"\\$&"):e}var K0=fn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),V0=fn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),B0=uh("toLowerCase");function G0(e,i,a){e=Ue(e),i=ye(i);var c=i?sn(e):0;if(!i||c>=i)return e;var f=(i-c)/2;return ea(zs(f),a)+e+ea(Ms(f),a)}function W0(e,i,a){e=Ue(e),i=ye(i);var c=i?sn(e):0;return i&&c<i?e+ea(i-c,a):e}function Q0(e,i,a){e=Ue(e),i=ye(i);var c=i?sn(e):0;return i&&c<i?ea(i-c,a)+e:e}function J0(e,i,a){return a||i==null?i=0:i&&(i=+i),ip(Ue(e).replace(mt,""),i||0)}function Y0(e,i,a){return(a?tr(e,i,a):i===r)?i=1:i=ye(i),Do(Ue(e),i)}function Z0(){var e=arguments,i=Ue(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var X0=fn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function e1(e,i,a){return a&&typeof a!="number"&&tr(e,i,a)&&(i=a=r),a=a===r?Z:a>>>0,a?(e=Ue(e),e&&(typeof i=="string"||i!=null&&!nc(i))&&(i=mr(i),!i&&nn(e))?Ei(Fr(e),0,a):e.split(i,a)):[]}var t1=fn(function(e,i,a){return e+(a?" ":"")+oc(i)});function r1(e,i,a){return e=Ue(e),a=a==null?0:ji(ye(a),0,e.length),i=mr(i),e.slice(a,a+i.length)==i}function i1(e,i,a){var c=v.templateSettings;a&&tr(e,i,a)&&(i=r),e=Ue(e),i=fa({},i,c,mh);var f=fa({},i.imports,c.imports,mh),w=qt(f),S=vo(f,w),A,$,k=0,K=i.interpolate||Qi,G="__p += '",X=bo((i.escape||Qi).source+"|"+K.source+"|"+(K===ct?Va:Qi).source+"|"+(i.evaluate||Qi).source+"|$","g"),oe="//# sourceURL="+(Le.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++uo+"]")+`
`;e.replace(X,function(le,Ie,Oe,vr,rr,wr){return Oe||(Oe=vr),G+=e.slice(k,wr).replace(Ya,Rd),Ie&&(A=!0,G+=`' +
__e(`+Ie+`) +
'`),rr&&($=!0,G+=`';
`+rr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),k=wr+le.length,le}),G+=`';
`;var he=Le.call(i,"variable")&&i.variable;if(!he)G=`with (obj) {
`+G+`
}
`;else if(ka.test(he))throw new pe(b);G=($?G.replace(Hr,""):G).replace(Zt,"$1").replace(Jr,"$1;"),G="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(A?", __e = _.escape":"")+($?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=cl(function(){return Fe(w,oe+"return "+G).apply(r,S)});if(we.source=G,ic(we))throw we;return we}function n1(e){return Ue(e).toLowerCase()}function s1(e){return Ue(e).toUpperCase()}function a1(e,i,a){if(e=Ue(e),e&&(a||i===r))return yu(e);if(!e||!(i=mr(i)))return e;var c=Fr(e),f=Fr(i),w=vu(c,f),S=wu(c,f)+1;return Ei(c,w,S).join("")}function o1(e,i,a){if(e=Ue(e),e&&(a||i===r))return e.slice(0,_u(e)+1);if(!e||!(i=mr(i)))return e;var c=Fr(e),f=wu(c,Fr(i))+1;return Ei(c,0,f).join("")}function c1(e,i,a){if(e=Ue(e),e&&(a||i===r))return e.replace(mt,"");if(!e||!(i=mr(i)))return e;var c=Fr(e),f=vu(c,Fr(i));return Ei(c,f).join("")}function u1(e,i){var a=se,c=Ee;if(ut(i)){var f="separator"in i?i.separator:f;a="length"in i?ye(i.length):a,c="omission"in i?mr(i.omission):c}e=Ue(e);var w=e.length;if(nn(e)){var S=Fr(e);w=S.length}if(a>=w)return e;var A=a-sn(c);if(A<1)return c;var $=S?Ei(S,0,A).join(""):e.slice(0,A);if(f===r)return $+c;if(S&&(A+=$.length-A),nc(f)){if(e.slice(A).search(f)){var k,K=$;for(f.global||(f=bo(f.source,Ue(_r.exec(f))+"g")),f.lastIndex=0;k=f.exec(K);)var G=k.index;$=$.slice(0,G===r?A:G)}}else if(e.indexOf(mr(f),A)!=A){var X=$.lastIndexOf(f);X>-1&&($=$.slice(0,X))}return $+c}function h1(e){return e=Ue(e),e&&ft.test(e)?e.replace(di,qd):e}var l1=fn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),oc=uh("toUpperCase");function ol(e,i,a){return e=Ue(e),i=a?r:i,i===r?Fd(e)?Hd(e):xd(e):e.match(i)||[]}var cl=_e(function(e,i){try{return Lt(e,r,i)}catch(a){return ic(a)?a:new pe(a)}}),f1=ii(function(e,i){return Ir(i,function(a){a=Gr(a),ti(e,a,tc(e[a],e))}),e});function d1(e){var i=e==null?0:e.length,a=ue();return e=i?nt(e,function(c){if(typeof c[1]!="function")throw new Sr(y);return[a(c[0]),c[1]]}):[],_e(function(c){for(var f=-1;++f<i;){var w=e[f];if(Lt(w[0],this,c))return Lt(w[1],this,c)}})}function p1(e){return qp(Pr(e,O))}function cc(e){return function(){return e}}function g1(e,i){return e==null||e!==e?i:e}var m1=lh(),y1=lh(!0);function lr(e){return e}function uc(e){return zu(typeof e=="function"?e:Pr(e,O))}function v1(e){return ku(Pr(e,O))}function w1(e,i){return Ku(e,Pr(i,O))}var b1=_e(function(e,i){return function(a){return Dn(a,e,i)}}),_1=_e(function(e,i){return function(a){return Dn(e,a,i)}});function hc(e,i,a){var c=qt(i),f=Gs(i,c);a==null&&!(ut(i)&&(f.length||!c.length))&&(a=i,i=e,e=this,f=Gs(i,qt(i)));var w=!(ut(a)&&"chain"in a)||!!a.chain,S=si(e);return Ir(f,function(A){var $=i[A];e[A]=$,S&&(e.prototype[A]=function(){var k=this.__chain__;if(w||k){var K=e(this.__wrapped__),G=K.__actions__=cr(this.__actions__);return G.push({func:$,args:arguments,thisArg:e}),K.__chain__=k,K}return $.apply(e,mi([this.value()],arguments))})}),e}function E1(){return Pe._===this&&(Pe._=Wd),this}function lc(){}function I1(e){return e=ye(e),_e(function(i){return Vu(i,e)})}var S1=Ho(nt),x1=Ho(fu),P1=Ho(fo);function ul(e){return Qo(e)?po(Gr(e)):rg(e)}function O1(e){return function(i){return e==null?r:Li(e,i)}}var N1=dh(),A1=dh(!0);function fc(){return[]}function dc(){return!1}function T1(){return{}}function C1(){return""}function R1(){return!0}function $1(e,i){if(e=ye(e),e<1||e>ee)return[];var a=Z,c=Bt(e,Z);i=ue(i),e-=Z;for(var f=yo(c,i);++a<e;)i(a);return f}function F1(e){return me(e)?nt(e,Gr):yr(e)?[e]:cr(Ah(Ue(e)))}function D1(e){var i=++Bd;return Ue(e)+i}var U1=Xs(function(e,i){return e+i},0),j1=ko("ceil"),L1=Xs(function(e,i){return e/i},1),q1=ko("floor");function M1(e){return e&&e.length?Bs(e,lr,No):r}function z1(e,i){return e&&e.length?Bs(e,ue(i,2),No):r}function H1(e){return gu(e,lr)}function k1(e,i){return gu(e,ue(i,2))}function K1(e){return e&&e.length?Bs(e,lr,Ro):r}function V1(e,i){return e&&e.length?Bs(e,ue(i,2),Ro):r}var B1=Xs(function(e,i){return e*i},1),G1=ko("round"),W1=Xs(function(e,i){return e-i},0);function Q1(e){return e&&e.length?mo(e,lr):0}function J1(e,i){return e&&e.length?mo(e,ue(i,2)):0}return v.after=vy,v.ary=Mh,v.assign=s0,v.assignIn=el,v.assignInWith=fa,v.assignWith=a0,v.at=o0,v.before=zh,v.bind=tc,v.bindAll=f1,v.bindKey=Hh,v.castArray=Ty,v.chain=jh,v.chunk=qg,v.compact=Mg,v.concat=zg,v.cond=d1,v.conforms=p1,v.constant=cc,v.countBy=Qm,v.create=c0,v.curry=kh,v.curryRight=Kh,v.debounce=Vh,v.defaults=u0,v.defaultsDeep=h0,v.defer=wy,v.delay=by,v.difference=Hg,v.differenceBy=kg,v.differenceWith=Kg,v.drop=Vg,v.dropRight=Bg,v.dropRightWhile=Gg,v.dropWhile=Wg,v.fill=Qg,v.filter=Ym,v.flatMap=ey,v.flatMapDeep=ty,v.flatMapDepth=ry,v.flatten=$h,v.flattenDeep=Jg,v.flattenDepth=Yg,v.flip=_y,v.flow=m1,v.flowRight=y1,v.fromPairs=Zg,v.functions=y0,v.functionsIn=v0,v.groupBy=iy,v.initial=em,v.intersection=tm,v.intersectionBy=rm,v.intersectionWith=im,v.invert=b0,v.invertBy=_0,v.invokeMap=sy,v.iteratee=uc,v.keyBy=ay,v.keys=qt,v.keysIn=hr,v.map=aa,v.mapKeys=I0,v.mapValues=S0,v.matches=v1,v.matchesProperty=w1,v.memoize=ca,v.merge=x0,v.mergeWith=tl,v.method=b1,v.methodOf=_1,v.mixin=hc,v.negate=ua,v.nthArg=I1,v.omit=P0,v.omitBy=O0,v.once=Ey,v.orderBy=oy,v.over=S1,v.overArgs=Iy,v.overEvery=x1,v.overSome=P1,v.partial=rc,v.partialRight=Bh,v.partition=cy,v.pick=N0,v.pickBy=rl,v.property=ul,v.propertyOf=O1,v.pull=om,v.pullAll=Dh,v.pullAllBy=cm,v.pullAllWith=um,v.pullAt=hm,v.range=N1,v.rangeRight=A1,v.rearg=Sy,v.reject=ly,v.remove=lm,v.rest=xy,v.reverse=Xo,v.sampleSize=dy,v.set=T0,v.setWith=C0,v.shuffle=py,v.slice=fm,v.sortBy=yy,v.sortedUniq=wm,v.sortedUniqBy=bm,v.split=e1,v.spread=Py,v.tail=_m,v.take=Em,v.takeRight=Im,v.takeRightWhile=Sm,v.takeWhile=xm,v.tap=Mm,v.throttle=Oy,v.thru=sa,v.toArray=Yh,v.toPairs=il,v.toPairsIn=nl,v.toPath=F1,v.toPlainObject=Xh,v.transform=R0,v.unary=Ny,v.union=Pm,v.unionBy=Om,v.unionWith=Nm,v.uniq=Am,v.uniqBy=Tm,v.uniqWith=Cm,v.unset=$0,v.unzip=ec,v.unzipWith=Uh,v.update=F0,v.updateWith=D0,v.values=gn,v.valuesIn=U0,v.without=Rm,v.words=ol,v.wrap=Ay,v.xor=$m,v.xorBy=Fm,v.xorWith=Dm,v.zip=Um,v.zipObject=jm,v.zipObjectDeep=Lm,v.zipWith=qm,v.entries=il,v.entriesIn=nl,v.extend=el,v.extendWith=fa,hc(v,v),v.add=U1,v.attempt=cl,v.camelCase=M0,v.capitalize=sl,v.ceil=j1,v.clamp=j0,v.clone=Cy,v.cloneDeep=$y,v.cloneDeepWith=Fy,v.cloneWith=Ry,v.conformsTo=Dy,v.deburr=al,v.defaultTo=g1,v.divide=L1,v.endsWith=z0,v.eq=Ur,v.escape=H0,v.escapeRegExp=k0,v.every=Jm,v.find=Zm,v.findIndex=Ch,v.findKey=l0,v.findLast=Xm,v.findLastIndex=Rh,v.findLastKey=f0,v.floor=q1,v.forEach=Lh,v.forEachRight=qh,v.forIn=d0,v.forInRight=p0,v.forOwn=g0,v.forOwnRight=m0,v.get=sc,v.gt=Uy,v.gte=jy,v.has=w0,v.hasIn=ac,v.head=Fh,v.identity=lr,v.includes=ny,v.indexOf=Xg,v.inRange=L0,v.invoke=E0,v.isArguments=zi,v.isArray=me,v.isArrayBuffer=Ly,v.isArrayLike=ur,v.isArrayLikeObject=Et,v.isBoolean=qy,v.isBuffer=Ii,v.isDate=My,v.isElement=zy,v.isEmpty=Hy,v.isEqual=ky,v.isEqualWith=Ky,v.isError=ic,v.isFinite=Vy,v.isFunction=si,v.isInteger=Gh,v.isLength=ha,v.isMap=Wh,v.isMatch=By,v.isMatchWith=Gy,v.isNaN=Wy,v.isNative=Qy,v.isNil=Yy,v.isNull=Jy,v.isNumber=Qh,v.isObject=ut,v.isObjectLike=vt,v.isPlainObject=zn,v.isRegExp=nc,v.isSafeInteger=Zy,v.isSet=Jh,v.isString=la,v.isSymbol=yr,v.isTypedArray=pn,v.isUndefined=Xy,v.isWeakMap=e0,v.isWeakSet=t0,v.join=nm,v.kebabCase=K0,v.last=Nr,v.lastIndexOf=sm,v.lowerCase=V0,v.lowerFirst=B0,v.lt=r0,v.lte=i0,v.max=M1,v.maxBy=z1,v.mean=H1,v.meanBy=k1,v.min=K1,v.minBy=V1,v.stubArray=fc,v.stubFalse=dc,v.stubObject=T1,v.stubString=C1,v.stubTrue=R1,v.multiply=B1,v.nth=am,v.noConflict=E1,v.noop=lc,v.now=oa,v.pad=G0,v.padEnd=W0,v.padStart=Q0,v.parseInt=J0,v.random=q0,v.reduce=uy,v.reduceRight=hy,v.repeat=Y0,v.replace=Z0,v.result=A0,v.round=G1,v.runInContext=R,v.sample=fy,v.size=gy,v.snakeCase=X0,v.some=my,v.sortedIndex=dm,v.sortedIndexBy=pm,v.sortedIndexOf=gm,v.sortedLastIndex=mm,v.sortedLastIndexBy=ym,v.sortedLastIndexOf=vm,v.startCase=t1,v.startsWith=r1,v.subtract=W1,v.sum=Q1,v.sumBy=J1,v.template=i1,v.times=$1,v.toFinite=ai,v.toInteger=ye,v.toLength=Zh,v.toLower=n1,v.toNumber=Ar,v.toSafeInteger=n0,v.toString=Ue,v.toUpper=s1,v.trim=a1,v.trimEnd=o1,v.trimStart=c1,v.truncate=u1,v.unescape=h1,v.uniqueId=D1,v.upperCase=l1,v.upperFirst=oc,v.each=Lh,v.eachRight=qh,v.first=Fh,hc(v,function(){var e={};return Vr(v,function(i,a){Le.call(v.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),v.VERSION=n,Ir(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){v[e].placeholder=v}),Ir(["drop","take"],function(e,i){xe.prototype[e]=function(a){a=a===r?1:Ut(ye(a),0);var c=this.__filtered__&&!i?new xe(this):this.clone();return c.__filtered__?c.__takeCount__=Bt(a,c.__takeCount__):c.__views__.push({size:Bt(a,Z),type:e+(c.__dir__<0?"Right":"")}),c},xe.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Ir(["filter","map","takeWhile"],function(e,i){var a=i+1,c=a==j||a==qe;xe.prototype[e]=function(f){var w=this.clone();return w.__iteratees__.push({iteratee:ue(f,3),type:a}),w.__filtered__=w.__filtered__||c,w}}),Ir(["head","last"],function(e,i){var a="take"+(i?"Right":"");xe.prototype[e]=function(){return this[a](1).value()[0]}}),Ir(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");xe.prototype[e]=function(){return this.__filtered__?new xe(this):this[a](1)}}),xe.prototype.compact=function(){return this.filter(lr)},xe.prototype.find=function(e){return this.filter(e).head()},xe.prototype.findLast=function(e){return this.reverse().find(e)},xe.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new xe(this):this.map(function(a){return Dn(a,e,i)})}),xe.prototype.reject=function(e){return this.filter(ua(ue(e)))},xe.prototype.slice=function(e,i){e=ye(e);var a=this;return a.__filtered__&&(e>0||i<0)?new xe(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=ye(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},xe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},xe.prototype.toArray=function(){return this.take(Z)},Vr(xe.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),f=v[c?"take"+(i=="last"?"Right":""):i],w=c||/^find/.test(i);f&&(v.prototype[i]=function(){var S=this.__wrapped__,A=c?[1]:arguments,$=S instanceof xe,k=A[0],K=$||me(S),G=function(Ie){var Oe=f.apply(v,mi([Ie],A));return c&&X?Oe[0]:Oe};K&&a&&typeof k=="function"&&k.length!=1&&($=K=!1);var X=this.__chain__,oe=!!this.__actions__.length,he=w&&!X,we=$&&!oe;if(!w&&K){S=we?S:new xe(this);var le=e.apply(S,A);return le.__actions__.push({func:sa,args:[G],thisArg:r}),new xr(le,X)}return he&&we?e.apply(this,A):(le=this.thru(G),he?c?le.value()[0]:le.value():le)})}),Ir(["pop","push","shift","sort","splice","unshift"],function(e){var i=Cs[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);v.prototype[e]=function(){var f=arguments;if(c&&!this.__chain__){var w=this.value();return i.apply(me(w)?w:[],f)}return this[a](function(S){return i.apply(me(S)?S:[],f)})}}),Vr(xe.prototype,function(e,i){var a=v[i];if(a){var c=a.name+"";Le.call(un,c)||(un[c]=[]),un[c].push({name:i,func:a})}}),un[Zs(r,ce).name]=[{name:"wrapper",func:r}],xe.prototype.clone=hp,xe.prototype.reverse=lp,xe.prototype.value=fp,v.prototype.at=zm,v.prototype.chain=Hm,v.prototype.commit=km,v.prototype.next=Km,v.prototype.plant=Bm,v.prototype.reverse=Gm,v.prototype.toJSON=v.prototype.valueOf=v.prototype.value=Wm,v.prototype.first=v.prototype.head,Nn&&(v.prototype[Nn]=Vm),v},an=kd();_t?((_t.exports=an)._=an,Ge._=an):Pe._=an}).call(Qn)})(Bc,Bc.exports);var gS=Object.defineProperty,mS=Object.defineProperties,yS=Object.getOwnPropertyDescriptors,yf=Object.getOwnPropertySymbols,vS=Object.prototype.hasOwnProperty,wS=Object.prototype.propertyIsEnumerable,vf=(s,t,r)=>t in s?gS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,va=(s,t)=>{for(var r in t||(t={}))vS.call(t,r)&&vf(s,r,t[r]);if(yf)for(var r of yf(t))wS.call(t,r)&&vf(s,r,t[r]);return s},bS=(s,t)=>mS(s,yS(t));function Pi(s,t,r){var n;const o=cS(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${pS}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Wi(s){return s.includes(":")?s.split(":")[1]:s}function vd(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function _S(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const l=t.namespaces[o].accounts;n.push(...l)}),n}function ES(s={},t={}){const r=wf(s),n=wf(t);return Bc.exports.merge(r,n)}function wf(s){var t,r,n,o;const l={};if(!hS(s))return l;for(const[y,b]of Object.entries(s)){const P=uu(y)?[y]:b.chains,_=b.methods||[],E=b.events||[],O=b.rpcMap||{},D=Zn(y);l[D]=bS(va(va({},l[D]),b),{chains:Tc(P,(t=l[D])==null?void 0:t.chains),methods:Tc(_,(r=l[D])==null?void 0:r.methods),events:Tc(E,(n=l[D])==null?void 0:n.events),rpcMap:va(va({},O),(o=l[D])==null?void 0:o.rpcMap)})}return l}function IS(s){return s.includes(":")?s.split(":")[2]:s}function SS(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],l=n.events||[],y=n.accounts||[],b=uu(r)?[r]:n.chains?n.chains:vd(n.accounts);t[r]={chains:b,methods:o,events:l,accounts:y}}return t}function Cc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const wd={},st=s=>wd[s],Rc=(s,t)=>{wd[s]=t};class xS{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class PS{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||Pi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(Wi(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const l=parseInt(o,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class OS{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class NS{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class AS{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=Wi(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class TS{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class CS{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Wi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new li(new Oi(n,st("disableProviderPing")))}}class RS{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||Pi(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(fi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||Pi(t,this.namespace);return typeof n>"u"?void 0:new li(new Oi(n,st("disableProviderPing")))}}var $S=Object.defineProperty,FS=Object.defineProperties,DS=Object.getOwnPropertyDescriptors,bf=Object.getOwnPropertySymbols,US=Object.prototype.hasOwnProperty,jS=Object.prototype.propertyIsEnumerable,_f=(s,t,r)=>t in s?$S(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,wa=(s,t)=>{for(var r in t||(t={}))US.call(t,r)&&_f(s,r,t[r]);if(bf)for(var r of bf(t))jS.call(t,r)&&_f(s,r,t[r]);return s},$c=(s,t)=>FS(s,DS(t));class hu{constructor(t){this.events=new Qc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ne.pino(Ne.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||gf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new hu(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:wa({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){this.request(t,n).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:df("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(l=>{this.session=l,this.namespaces||(this.namespaces=SS(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==md)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pf(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await nS.init({logger:this.providerOpts.logger||gf,relayUrl:this.providerOpts.relayUrl||lS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Zn(r)))];Rc("client",this.client),Rc("events",this.events),Rc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=_S(r,this.session),o=vd(n),l=ES(this.namespaces,this.optionalNamespaces),y=$c(wa({},l[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new PS({namespace:y});break;case"solana":this.rpcProviders[r]=new OS({namespace:y});break;case"cosmos":this.rpcProviders[r]=new NS({namespace:y});break;case"polkadot":this.rpcProviders[r]=new xS({namespace:y});break;case"cip34":this.rpcProviders[r]=new AS({namespace:y});break;case"elrond":this.rpcProviders[r]=new TS({namespace:y});break;case"multiversx":this.rpcProviders[r]=new CS({namespace:y});break;case"near":this.rpcProviders[r]=new RS({namespace:y});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&pf(o)&&this.events.emit("accountsChanged",o.map(IS))}else if(n.name==="chainChanged"){const o=r.chainId,l=r.event.data,y=Zn(o),b=Cc(o)!==Cc(l)?`${y}:${Cc(l)}`:o;this.onChainChanged(b)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,l=(n=this.client)==null?void 0:n.session.get(t);this.session=$c(wa({},l),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",$c(wa({},df("USER_DISCONNECTED")),{data:t.topic}))}),this.on(fi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(y=>Zn(y)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Zn(Object.keys(this.namespaces)[0]),l=this.rpcProviders[o].getDefaultChain();return[o,l]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,l]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(l),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${mf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${mf}/${t}`)}}const LS=hu,qS="wc",MS="ethereum_provider",zS=`${qS}@2:${MS}:`,HS="https://rpc.walletconnect.com/v1/",Gc=["eth_sendTransaction","personal_sign"],kS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Wc=["chainChanged","accountsChanged"],KS=["chainChanged","accountsChanged","message","disconnect","connect"];var VS=Object.defineProperty,BS=Object.defineProperties,GS=Object.getOwnPropertyDescriptors,Ef=Object.getOwnPropertySymbols,WS=Object.prototype.hasOwnProperty,QS=Object.prototype.propertyIsEnumerable,If=(s,t,r)=>t in s?VS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Xn=(s,t)=>{for(var r in t||(t={}))WS.call(t,r)&&If(s,r,t[r]);if(Ef)for(var r of Ef(t))QS.call(t,r)&&If(s,r,t[r]);return s},Sf=(s,t)=>BS(s,GS(t));function Ta(s){return Number(s[0].split(":")[1])}function Fc(s){return`0x${s.toString(16)}`}function JS(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:l,optionalEvents:y,rpcMap:b}=s;if(!Uc(t))throw new Error("Invalid chains");const P={chains:t,methods:n||Gc,events:l||Wc,rpcMap:Xn({},t.length?{[Ta(t)]:b[Ta(t)]}:{})},_=l==null?void 0:l.filter(H=>!Wc.includes(H)),E=n==null?void 0:n.filter(H=>!Gc.includes(H));if(!r&&!y&&!o&&!(_!=null&&_.length)&&!(E!=null&&E.length))return{required:t.length?P:void 0};const O=(_==null?void 0:_.length)&&(E==null?void 0:E.length)||!r,D={chains:[...new Set(O?P.chains.concat(r||[]):r)],methods:[...new Set(P.methods.concat(o!=null&&o.length?o:kS))],events:[...new Set(P.events.concat(y!=null&&y.length?y:KS))],rpcMap:b};return{required:t.length?P:void 0,optional:r.length?D:void 0}}class lu{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=zS,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new lu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=JS(this.rpc);try{const o=await new Promise(async(y,b)=>{var P;this.rpc.showQrModal&&((P=this.modal)==null||P.subscribeModal(_=>{!_.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),b(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Sf(Xn({namespaces:Xn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(_=>{y(_)}).catch(_=>{b(new Error(_.message))})});if(!o)return;const l=Iv(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:Fc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Fc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Sf(Xn({},xv("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Fc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],l=(n=t==null?void 0:t.optionalChains)!=null?n:[],y=o.concat(l);if(!y.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const b=o.length?(t==null?void 0:t.methods)||Gc:[],P=o.length?(t==null?void 0:t.events)||Wc:[],_=(t==null?void 0:t.optionalMethods)||[],E=(t==null?void 0:t.optionalEvents)||[],O=(t==null?void 0:t.rpcMap)||this.buildRpcMap(y,t.projectId),D=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(H=>this.formatChainId(H)),optionalChains:l.map(H=>this.formatChainId(H)),methods:b,events:P,optionalMethods:_,optionalEvents:E,rpcMap:O,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:D,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ta(this.rpc.chains):Ta(this.rpc.optionalChains),this.signer=await LS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await dv(()=>import("./index-8ef5fd3f.js").then(o=>o.i),["assets/index-8ef5fd3f.js","assets/index-d7870e89.js","assets/index-578d101c.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&Uc(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)})),n&&Uc(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(o==null?void 0:o[l])||this.getRpcUrl(l)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${HS}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const mx=lu;export{mx as EthereumProvider,KS as OPTIONAL_EVENTS,kS as OPTIONAL_METHODS,Wc as REQUIRED_EVENTS,Gc as REQUIRED_METHODS,lu as default};
